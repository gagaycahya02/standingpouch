(window.webpackJsonp__wix_chat_widget=window.webpackJsonp__wix_chat_widget||[]).push([[1],[,,,,,,,,,,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"Types",(function(){return a})),r.d(e,"IMessageTypes",(function(){return o})),r.d(e,"OfflineChannelId",(function(){return i})),r.d(e,"DomainTypes",(function(){return s})),r.d(e,"Constants",(function(){return c})),r.d(e,"MessageIndicationsService",(function(){return n})),r.d(e,"Message",(function(){return p.a})),r.d(e,"MessagePart",(function(){return d.a})),r.d(e,"StandardTemplateData",(function(){return v.a})),r.d(e,"CustomTemplateData",(function(){return m.a})),r.d(e,"ChatSdkError",(function(){return g.a})),r.d(e,"MessageGroupingService",(function(){return y.a})),r.d(e,"ChatRoom",(function(){return _.a})),r.d(e,"chatSdk",(function(){return b.a})),r.d(e,"chatEventEmitter",(function(){return O.d}));var n={};r.r(n),r.d(n,"getSummarizedIndicationsForPrivateChat",(function(){return f}));var o,i,a=r(249);!function(t){t.message="message",t.template_standard_event="template/standard-event",t.template_minimal="template/minimal",t.template_form="template/form",t.template_custom="template/custom"}(o||(o={})),function(t){t.Email="Email",t.Facebook="Facebook",t.SMS="SMS",t.Whatsapp="Whatsapp",t.Phone="Phone"}(i||(i={}));var s=r(566),c=r(8),u=r(120),h=r(14),f=function(t){if(!t)return null;var e=u(t.details,(function(t,e){return l(e,t)?{event:c.IndicationEvent.SEEN,method:e.method}:t}),{});return h(e)?null:e},l=function(t,e){return t.event===c.IndicationEvent.SEEN&&e.event!==c.IndicationEvent.SEEN},p=r(66),d=r(154),v=r(567),m=r(568),g=r(267),y=r(569),_=r(88),b=r(165),O=r(17)},,,,function(t,e,r){"use strict";r.d(e,"d",(function(){return f})),r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return c})),r.d(e,"e",(function(){return u})),r.d(e,"f",(function(){return h}));var n=r(412),o=r(58),i=new n.EventEmitter,a={MESSAGES_READ:"crm.events.messagesRead",MESSAGE_SENT:"crm.events.messageSent",NEW_REALTIME_MESSAGE:"crm.events.newRealtimeMessage",BI:"biEvent",BI_ERROR:"biDebugErrorEvent",MONITORING_BI:"monitoringBi",EXTERNAL_HOST:o.a.EXTERNAL_HOST},s={FETCH_ENRICHED_CHATROOM_COMPLETED:"chat.internal.events.fetchEnrichedChatroomCompleted",FETCH_DRILL_IN_MESSAGE_INDICATIONS_COMPLETED:"chat.internal.events.fetchDrillInMessageIndicationsCompleted"},c=function(t,e){i.on(t,e)},u=function(t,e){i.emit(t,e)},h=function(t,e){i.removeListener(t,e)},f={addListener:c,removeListener:h,CHAT_EVENTS:a,emit:u}},,,,,,,,function(t,e,r){"use strict";r.d(e,"c",(function(){return n})),r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return i}));var n=function(t){return t+"_FULFILLED"},o=function(t){return t+"_PENDING"},i=function(t){return t+"_REJECTED"}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";e.a={MESSAGE_SENT:"MessageSent",CHATROOM_DELETED:"ChatroomDeleted",CHATROOM_CREATED:"ChatroomCreated",TYPING_STARTED:"TypingStarted",TYPING_STOPPED:"TypingStopped",CHATROOOM_DISPLAY_DATA_UPDATED:"ChatroomDisplayDataUpdated",CHATROOM_ARCHIVED:"ChatroomArchived",CHATROOM_UNARCHIVED:"ChatroomUnarchived",CHATROOM_READ:"ChatroomRead",MESSAGE_INDICATION_UPDATE:"MessageIndicationUpdate",PRESENCE_EVENT:"Presence",EXTERNAL_HOST:"ExternalHost"}},,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(162);t.exports=function(t,e){return n(t,e)}},function(t,e,r){"use strict";r.d(e,"d",(function(){return o})),r.d(e,"a",(function(){return i})),r.d(e,"c",(function(){return a})),r.d(e,"b",(function(){return s}));var n=r(1);function o(t,e,r){var n={};return t.forEach((function(o){o?n[o[e]]=Object.assign({},o,r):console.warn("toStateObj: array contained an undefined",t)})),n}function i(t){return Object.keys(t).map((function(e){return Object(n.__assign)({id:e},t[e])}))}var a=function(t){console.warn("DEPRECATED (chat-sdk): "+t)},s=function(t){var e="DEPRECATED (chat-sdk): "+t;throw console.warn(e),new Error(e)}},,,,function(t,e,r){"use strict";r.d(e,"a",(function(){return a}));var n=r(84),o=r(66),i=r(5),a=function(){function t(t,e){this._chatroom=t,this._lastMessage=(null==t?void 0:t.lastMessage)?new o.a(t.lastMessage):null,this._online=!!e}return Object.defineProperty(t.prototype,"id",{get:function(){return this._chatroom.id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participantId",{get:function(){return this._chatroom.participantId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._chatroom.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"initials",{get:function(){return this._chatroom.initials},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timestamp",{get:function(){return this._lastMessage&&this._lastMessage.age||void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){if(!this.lastMessage)return"";var t=this.lastMessage.summary||"",e=i(this.lastMessage,"senderDisplayData.name"),r=e?e+": ":"";return this.isPrivate?t:""+r+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lastMessage",{get:function(){return this._lastMessage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"thumbnail",{get:function(){return this._chatroom.image&&this._chatroom.image.url},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"count",{get:function(){return this._chatroom.unreadCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"online",{get:function(){return this._online},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPrivate",{get:function(){return this._chatroom.isPrivate},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"otherParticipantId",{get:function(){return this._chatroom.otherParticipantId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientReference",{get:function(){return this._chatroom.clientReference},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"clientReferenceType",{get:function(){return this._chatroom.clientReferenceType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"siteUserType",{get:function(){return this._chatroom.siteUserType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participantCount",{get:function(){return this._chatroom.participantCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"createdBy",{get:function(){return this._chatroom.createdBy},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"createdAt",{get:function(){return this._chatroom.createdAt},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"error",{get:function(){return this._chatroom.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"messageDeliveryError",{get:function(){return this._chatroom.messageDeliveryError},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"archived",{get:function(){Object(n.b)("archive property on chatroom is deprecated, use isArchived instead")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isArchived",{get:function(){return this._chatroom.isArchived},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isTemporary",{get:function(){return this._chatroom.isTemporary},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offlineChannels",{get:function(){return i(this._chatroom,"offlineChannels.channels")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offlineChannel",{get:function(){var t=this._chatroom.offlineChannels;return t&&t.channels.some((function(t){return!!t.type}))?t.channels[0].type:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"siteName",{get:function(){return this._chatroom.businessContext&&this._chatroom.businessContext.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"businessContext",{get:function(){return this._chatroom.businessContext},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"labelIds",{get:function(){return this._chatroom.labelIds},enumerable:!0,configurable:!0}),t}()},,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(250),o=r(160);t.exports=function(t,e,r,i){var a=!r;r||(r={});for(var s=-1,c=e.length;++s<c;){var u=e[s],h=i?i(r[u],t[u],u,r,t):void 0;void 0===h&&(h=t[u]),a?o(r,u,h):n(r,u,h)}return r}},,,,,,,,,,,,function(t,e,r){var n=r(658),o=r(469),i=r(79),a=r(659),s=r(30);t.exports=function(t,e,r){var c=s(t)?n:a,u=arguments.length<3;return c(t,i(e,4),r,u,o)}},,,,,,function(t,e,r){var n=r(498),o=r(501)((function(t,e,r){n(t,e,r)}));t.exports=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(269);t.exports=function(t,e,r){"__proto__"==e&&n?n(t,e,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[e]=r}},function(t,e,r){var n=r(213),o=r(478),i=r(80);t.exports=function(t){return i(t)?n(t,!0):o(t)}},,,,function(t,e,r){"use strict";r.d(e,"a",(function(){return io}));var n={};r.r(n),r.d(n,"getFilteredUnseenChatrooms",(function(){return ie})),r.d(n,"getLastKnownMessageSequence",(function(){return ae})),r.d(n,"getLastMessageSequence",(function(){return se})),r.d(n,"getChatrooms",(function(){return te})),r.d(n,"createGetChatroomsSelector",(function(){return ee})),r.d(n,"chatroomHasUnreads",(function(){return Wt})),r.d(n,"getAllUnreadChatrooms",(function(){return oe}));var o=r(1),i=r(66),a=r(14),s=r(579),c=r(5),u=r(580),h={},f=function(t,e){return function(t,e){return{value:h[t],dontUpdate:!e}}(e,function(t,e){var r=void 0===h[e]&&void 0!==t[e];return r&&(h[e]=t[e]),r}(t,e))},l=r(17);function p(t,e){return t===e}function d(t,e,r){if(null===e||null===r||e.length!==r.length)return!1;for(var n=e.length,o=0;o<n;o++)if(!t(e[o],r[o]))return!1;return!0}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p,r=null,n=null;return function(){return d(e,r,arguments)||(n=t.apply(null,arguments)),r=arguments,n}}function m(t){var e=Array.isArray(t[0])?t[0]:t;if(!e.every((function(t){return"function"==typeof t}))){var r=e.map((function(t){return typeof t})).join(", ");throw new Error("Selector creators expect all input-selectors to be functions, instead received the following types: ["+r+"]")}return e}function g(t){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];var i=0,a=n.pop(),s=m(n),c=t.apply(void 0,[function(){return i++,a.apply(null,arguments)}].concat(r)),u=t((function(){for(var t=[],e=s.length,r=0;r<e;r++)t.push(s[r].apply(null,arguments));return c.apply(null,t)}));return u.resultFunc=a,u.dependencies=s,u.recomputations=function(){return i},u.resetRecomputations=function(){return i=0},u}}var y=g(v);var _=r(439),b=r(268),O=r(83),E=r(120),S=r(280),A=r(111),I=r(252),C=r.n(I),T=function(t){return t.messages},R=function(t){return t.messagesIndications},j=function(t){return t.participants},w=function(t){return t.chatrooms},M=function(t){return D(w,(function(e){var r=e.byId[t];return null==r?void 0:r.enrichedChatroomLoaded}))},x=function(t){return new i.a(t,t.transit)};function P(t){return t.sort((function(t,e){return t.createdAt-e.createdAt}))}x=C()(500)(x);var D=g(v,O),N=function(t){return D(T,(function(e){return function(t,e){return _(t.byId,(function(t){return t.chatroomId===e}))}(e,t)}))},U=function(t){return D(R,T,(function(e,r){return function(t,e,r){return b(t.byId,(function(t,n){return e.byId[n]&&e.byId[n].chatroomId===r}))}(e,r,t)}))},k=function(t,e){return E(t,(function(t,r,n){var o=L(r),i=e.byId[n];return i?S(t,{participant:{id:n,displayData:i.displayData},details:o}):t}),[])},L=function(t){return E(t,(function(t,e){return S(t,{event:e.event,method:e.method,formattedTimestamp:A.b(e.timestamp)})}),[])},F=function(t,e,r,n){return t.map((function(t){var i=e[t.id];if(!i)return x(r?Object(o.__assign)(Object(o.__assign)({},t),{indications:[]}):t);var a=k(i,n);return x(Object(o.__assign)(Object(o.__assign)({},t),{indications:a}))}))},H=function(t){return D(function(t){return D(N(t),P)}(t),U(t),M(t),j,F)},G=function(t,e){return D(function(t){return D(R,(function(e){return function(t,e){return t.byId[e]}(e,t)}))}(e),M(t),function(t){return D(T,(function(e){return e.byId[t]}))}(e),j,(function(t,e,r,n){return r?t?{indications:k(t,n)}:e?{indications:[]}:{indications:null}:{indications:null}}))},q=function(t,e){return t.chatrooms.byId[e]||{}},z=r(88),$=function(t,e){var r=q(t,e),n=H(e)(t),o=f(t.messageDraft.byId,e),i=r.cursor,a=r.typingStatus,s=void 0===a?[]:a,c=r.unreadCount,u=void 0===c?0:c,h=r.lastReadMessageSequence,l=t.chatrooms?t.chatrooms.status:{isFetchingRoom:!1},p={messages:n,initialMessageDraft:o.value,status:l,cursor:i,typingStatus:s,unreadCount:u,lastReadMessageSequence:h};return B(r,p)},B=function(t,e){var r=new V(t,e);return{id:r.id,name:r.name,thumbnail:r.thumbnail,initials:r.initials,isPrivate:r.isPrivate,isArchived:r.isArchived,otherParticipantId:r.otherParticipantId,participantId:r.participantId,participantCount:r.participantCount,clientReferenceType:r.clientReferenceType,createdBy:r.createdBy,createdAt:r.createdAt,messages:r.messages,error:r.error,cursor:r.cursor,typingStatus:r.typingStatus,unreadCount:r.unreadCount,lastReadMessageSequence:r.lastReadMessageSequence,status:r.status,initialMessageDraft:r.initialMessageDraft,offlineChannels:r.offlineChannels,participants:t.participants||[],labelIds:t.labelIds||[],siteUserType:r.siteUserType}},V=function(t){function e(e,r){var n=t.call(this,e)||this;return n._messages=r.messages,n._initialMessageDraft=r.initialMessageDraft,n._status=r.status,n._cursor=r.cursor,n._typingStatus=r.typingStatus,n._unreadCount=r.unreadCount,n._lastReadMessageSequence=r.lastReadMessageSequence,n._participants=e.participants||[],n}return Object(o.__extends)(e,t),Object.defineProperty(e.prototype,"messages",{get:function(){return this._messages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"initialMessageDraft",{get:function(){return this._initialMessageDraft},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{get:function(){return this._cursor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typingStatus",{get:function(){return this._typingStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"unreadCount",{get:function(){return this._unreadCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastReadMessageSequence",{get:function(){return this._lastReadMessageSequence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"participants",{get:function(){return this._participants},enumerable:!0,configurable:!0}),e}(z.a),K=r(84),Y=function(t){var e,r,n=H(t);return function(o){var i=o.store,s=o.onChange,c=o.onNewMessage,u=o.onError,h=i.getState(),l=q(h,t),p=n(h),d=f(h.messageDraft.byId,t);if(!(l&&p&&e===l&&r===p&&d.dontUpdate)){var v=function(t,e){var r=t?Math.max.apply(Math,t.map((function(t){return t.sequence||-2}))):-1,n=e?Math.max.apply(Math,e.map((function(t){return t.sequence||-2}))):-1;return!a(e)&&r>n}(p,r);e=l,r=p;var m=$(h,t);m.error&&u&&(Object(K.c)("Instead of onError callback in subscribeToChatroom, rely on the error field in the Chatroom object"),u(m.error)),s(m),v&&c&&c(m)}}},Q=function(t){var e=io.store.getState();return _(t,(function(t){return!e.participants.byId[t]}))},W=r(8),J=r(219),X=r(576),Z=function(t,e){return b(t,(function(t){return tt(t,e)}))};function tt(t,e){return a(e)?!t.isArchived:[et,rt,nt,ot].every((function(r){return r(t,e)}))}function et(t,e){return e.isArchived?!!t.isArchived:!t.isArchived}function rt(t,e){var r;return!(null===(r=e.participantIds)||void 0===r?void 0:r.length)||e.participantIds.some((function(e){return e===t.participantId}))}function nt(t,e){if("business"===e.participantType)return t.participantId===c(t,"businessContext.id")&&"Engage"===t.pluginName;if("siteMember"===e.participantType){var r=t.participantId!==c(t,"businessContext.id");return"Social"===t.pluginName||"Engage"===t.pluginName&&r}return!0}function ot(t,e){var r;return!(null===(r=e.labelIds)||void 0===r?void 0:r.length)||e.labelIds.some((function(e){return t.labelIds.includes(e)}))}var it={maxUnreadsCount:50,maxTrackableUnreads:60},at=r(575),st="object"==typeof self&&self&&self.Object===Object&&self,ct=(at.a||st||Function("return this")()).Symbol,ut=Object.prototype,ht=ut.hasOwnProperty,ft=ut.toString,lt=ct?ct.toStringTag:void 0;var pt=function(t){var e=ht.call(t,lt),r=t[lt];try{t[lt]=void 0;var n=!0}catch(t){}var o=ft.call(t);return n&&(e?t[lt]=r:delete t[lt]),o},dt=Object.prototype.toString;var vt=function(t){return dt.call(t)},mt=ct?ct.toStringTag:void 0;var gt=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":mt&&mt in Object(t)?pt(t):vt(t)};var yt=function(t,e){return function(r){return t(e(r))}}(Object.getPrototypeOf,Object);var _t=function(t){return null!=t&&"object"==typeof t},bt=Function.prototype,Ot=Object.prototype,Et=bt.toString,St=Ot.hasOwnProperty,At=Et.call(Object);var It=function(t){if(!_t(t)||"[object Object]"!=gt(t))return!1;var e=yt(t);if(null===e)return!0;var r=St.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&Et.call(r)==At},Ct=r(101),Tt="@@redux/INIT";function Rt(t,e,r){var n;if("function"==typeof e&&void 0===r&&(r=e,e=void 0),void 0!==r){if("function"!=typeof r)throw new Error("Expected the enhancer to be a function.");return r(Rt)(t,e)}if("function"!=typeof t)throw new Error("Expected the reducer to be a function.");var o=t,i=e,a=[],s=a,c=!1;function u(){s===a&&(s=a.slice())}function h(){return i}function f(t){if("function"!=typeof t)throw new Error("Expected listener to be a function.");var e=!0;return u(),s.push(t),function(){if(e){e=!1,u();var r=s.indexOf(t);s.splice(r,1)}}}function l(t){if(!It(t))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===t.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(c)throw new Error("Reducers may not dispatch actions.");try{c=!0,i=o(i,t)}finally{c=!1}for(var e=a=s,r=0;r<e.length;r++){(0,e[r])()}return t}return l({type:Tt}),(n={dispatch:l,subscribe:f,getState:h,replaceReducer:function(t){if("function"!=typeof t)throw new Error("Expected the nextReducer to be a function.");o=t,l({type:Tt})}})[Ct.a]=function(){var t,e=f;return(t={subscribe:function(t){if("object"!=typeof t)throw new TypeError("Expected the observer to be an object.");function r(){t.next&&t.next(h())}return r(),{unsubscribe:e(r)}}})[Ct.a]=function(){return this},t},n}function jt(t,e){var r=e&&e.type;return"Given action "+(r&&'"'+r.toString()+'"'||"an action")+', reducer "'+t+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function wt(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++){var o=e[n];0,"function"==typeof t[o]&&(r[o]=t[o])}var i=Object.keys(r);var a=void 0;try{!function(t){Object.keys(t).forEach((function(e){var r=t[e];if(void 0===r(void 0,{type:Tt}))throw new Error('Reducer "'+e+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");if(void 0===r(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+e+"\" returned undefined when probed with a random type. Don't try to handle "+Tt+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.')}))}(r)}catch(t){a=t}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments[1];if(a)throw a;for(var n=!1,o={},s=0;s<i.length;s++){var c=i[s],u=r[c],h=t[c],f=u(h,e);if(void 0===f){var l=jt(c,e);throw new Error(l)}o[c]=f,n=n||f!==h}return n?o:t}}function Mt(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return 0===e.length?function(t){return t}:1===e.length?e[0]:e.reduce((function(t,e){return function(){return t(e.apply(void 0,arguments))}}))}var xt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};function Pt(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(t){return function(r,n,o){var i,a=t(r,n,o),s=a.dispatch,c={getState:a.getState,dispatch:function(t){return s(t)}};return i=e.map((function(t){return t(c)})),s=Mt.apply(void 0,i)(a.dispatch),xt({},a,{dispatch:s})}}}var Dt={RESET_STORE:"RESET_STORE",FETCH_ROOMS:"FETCH_ROOMS",FETCH_ROOM:"FETCH_ROOM",FETCH_ENRICHED_ROOM:"FETCH_ENRICHED_ROOM",FETCH_UNREAD_CHATROOM_IDS:"FETCH_UNREAD_CHATROOM_IDS",DELETE_ROOM:"DELETE_ROOM",DELETE_ROOMS:"DELETE_ROOMS",ARCHIVE_ROOM:"ARCHIVE_ROOM",ARCHIVE_ROOMS:"ARCHIVE_ROOMS",UNARCHIVE_ROOMS:"UNARCHIVE_ROOMS",HANDLE_ROOM_ARCHIVED:"HANDLE_ROOM_ARCHIVED",UNARCHIVE_ROOM:"UNARCHIVE_ROOM",HANDLE_ROOM_UNARCHIVED:"HANDLE_ROOM_UNARCHIVED",FETCH_ROOM_MESSAGES:"FETCH_ROOM_MESSAGES",ADD_ROOMS:"ADD_ROOMS",REMOVE_ROOM:"REMOVE_ROOM",ADD_MESSAGE:"ADD_MESSAGE",SEND_MESSAGE:"SEND_MESSAGE",DELETE_MESSAGE:"DELETE_MESSAGE",TYPING:"TYPING",FETCH_MESSAGE_DRAFTS:"FETCH_MESSAGE_DRAFTS",TYPING_STATUS_CHANGE:"TYPING_STATUS_CHANGE",SET_PARTICIPANTS_PRESENCE:"SET_PARTICIPANTS_PRESENCE",UPDATE_PARTICIPANTS_PRESENCE:"UPDATE_PARTICIPANTS_PRESENCE",SET_MESSAGES_READ:"SET_MESSAGES_READ",SET_MESSAGES_READ_FOR_SELF:"SET_MESSAGES_READ_FOR_SELF",SET_ROOMS_MESSAGES_READ:"SET_ROOMS_MESSAGES_READ",SET_LAST_MESSAGE_UNREAD:"SET_LAST_MESSAGE_UNREAD",MARK_ROOMS_AS_READ:"MARK_ROOMS_AS_READ",UPDATE_MESSAGES_INDICATIONS:"UPDATE_MESSAGES_INDICATIONS",FETCH_PARTICIPANTS_DISPLAY_DATA:"FETCH_PARTICIPANTS_DISPLAY_DATA",FETCH_DRILL_IN_MESSAGE_INDICATIONS:"FETCH_DRILL_IN_MESSAGE_INDICATIONS",SET_UNSEEN_CHATROOMS:"SET_UNSEEN_CHATROOMS",MARK_CHATROOM_SEEN:"MARK_CHATROOM_SEEN",MARK_CHATROOMS_SEEN:"MARK_CHATROOMS_SEEN",UPDATE_PRESENCE:"UPDATE_PRESENCE",PRESENCE_CLEAR_STALE:"PRESENCE_CLEAR_STALE"},Nt=r(25),Ut=function(t){return"participantType"in t?t.participantType:t.participantId},kt=function(t){return"business"===t||"siteMember"===t?{participantType:t}:{participantId:t}},Lt=function(t,e){return Object.keys(t).map(kt).filter((function(t){return tt(e,"participantId"in t?{participantIds:[t.participantId]}:{participantType:t.participantType})})).map(Ut)},Ft=function(t){return"resyncCountdown"in t},Ht=function(t,e){if(!e)return t;var r=Lt(t,e),n=Object(o.__assign)({},t);return r.forEach((function(r){n[r]=function(t,e){var r;return Ft(t)?t:Object.keys(t.chatrooms).length===it.maxTrackableUnreads?{resyncCountdown:it.maxTrackableUnreads-it.maxUnreadsCount}:{chatrooms:Object(o.__assign)(Object(o.__assign)({},t.chatrooms),(r={},r[e]=!0,r))}}(t[r],e.id)})),n},Gt=function(t,e){if(Ft(t))return{resyncCountdown:Math.max(0,t.resyncCountdown-1)};if(t.chatrooms[e]){var r=Object(o.__assign)({},t.chatrooms);return delete r[e],{chatrooms:r}}return t},qt=function(t,e){if(!e)return t;var r=Lt(t,e),n=Object(o.__assign)({},t);return r.forEach((function(r){n[r]=Gt(t[r],e.id)})),n},zt=wt({byFilter:function(t,e){var r;switch(void 0===t&&(t={}),e.type){case Object(Nt.c)(Dt.SET_UNSEEN_CHATROOMS):return function(t,e){var r,n,i=e.payload;return Object(o.__assign)(Object(o.__assign)({},t),((r={})[Ut(e.meta.filter)]=i.length>it.maxTrackableUnreads?{resyncCountdown:it.maxTrackableUnreads-it.maxUnreadsCount}:{chatrooms:(n=i,n.reduce((function(t,e){return t[e.chatroomId]=!0,t}),{}))},r))}(t,e);case Dt.ADD_MESSAGE:var n=e.meta.chatroom,i=void 0===n?{}:n,a=i.lastSeenMessageSequence,s=void 0===a?0:a,c=i.lastReadMessageSequence,u=void 0===c?0:c,h=Math.max(s,u);return e.messageSentByCurrentUser||e.message.isSilent||e.message.sequence<=h?t:Ht(t,e.meta.chatroom);case Dt.HANDLE_ROOM_UNARCHIVED:case Dt.UNARCHIVE_ROOM:case Dt.SET_LAST_MESSAGE_UNREAD:return Ht(t,e.meta.chatroom);case Dt.UNARCHIVE_ROOMS:return e.meta.chatrooms.reduce((function(t,e){return Ht(t,e)}),t);case Dt.MARK_CHATROOM_SEEN:return qt(t,e.meta.chatroom);case Object(Nt.b)(Dt.MARK_CHATROOMS_SEEN):var f=e.meta,l=f.filter,p=f.filteredChatrooms,d=Ut(l),v=t[d],m=Ft(v)?[]:Object.keys(v.chatrooms);return Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},p.reduce((function(t,e){return qt(t,e)}),t)),m.reduce((function(t,e){return function(t,e){var r=Object.keys(t),n=Object(o.__assign)({},t);return r.forEach((function(r){n[r]=Gt(t[r],e)})),n}(t,e)}),t)),((r={})[d]={chatrooms:{}},r));default:return t}}}),$t=function(t){var e=t.lastMessage,r=t.lastReadMessageSequence,n=void 0===r?0:r,o=t.lastSeenMessageSequence,i=void 0===o?0:o;return!!e&&Math.max(n,i)<e.sequence},Bt=function(t){return t.chatroomsPresence.byId},Vt=function(t){return t.presence.participantsById},Kt=function(t){return t.chatrooms.byId},Yt=function(t){var e=t.stateRoom,r=t.roomsById,n=t.stateRoomIsOnline;return new z.a(r[e.id],n)};function Qt(t,e,r){var n=[];return Object.keys(r).sort((function(t,e){var n=c(r[t],"lastMessage.createdAt"),o=c(r[e],"lastMessage.createdAt");return n===o?0:n>o||!o?-1:1})).forEach((function(o){var i,s,c=t[o];if(a(e))s=Zt(c);else{var u=r[o].otherParticipantId;s=null===(i=e[u])||void 0===i?void 0:i.online}var h=Yt({stateRoom:r[o],roomsById:r,stateRoomIsOnline:s});h.lastMessage&&!h.isTemporary&&n.push(h)})),n}function Wt(t,e){var r=t.chatrooms.byId[e];if(r)return Jt(r)}function Jt(t){var e=t.lastMessage,r=t.lastReadMessageSequence;if(e)return(void 0===r?0:r)<e.sequence}function Xt(t){return!t.isArchived&&!t.isTemporary}Yt=C()(500,(function(t,e){return t.stateRoom===e.stateRoom&&t.stateRoomIsOnline===e.stateRoomIsOnline}))(Yt);var Zt=function(t){return!!(null==t?void 0:t[Object.keys(t)[0]].online)},te=y(Bt,Vt,Kt,Qt),ee=function(t){return re(Bt,Vt,ne(t),(function(t,e,r){return Qt(t,e,r)}))},re=g(v,O),ne=function(t){return y(Kt,(function(e){return Z(e,t)}))},oe=y(Kt,(function(t){return Object.values(t).filter(Jt).filter(Xt).map((function(t){return t.id}))})),ie=function(t,e){return Object.values(Z(t.chatrooms.byId,"participantId"in e?{participantIds:[e.participantId]}:{participantType:e.participantType})).filter($t).map((function(t){var e=t.id,r=t.lastSeenMessageSequence;return r?{chatroomId:e,lastSeenMessageSequence:r}:{chatroomId:e,lastSeenMessageSequence:0}}))},ae=function(t){var e=c(t,"chatrooms.byId",{}),r=Math.max.apply(Math,X(J(e,(function(t){return c(t,"lastMessage.sequence")}))));if(isNaN(r))return r},se=function(t,e){var r=H(e)(t);if(r.length){var n=t.chatrooms.byId[e]||{},o=n.lastMessage,i=Math.max(null==o?void 0:o.sequence,r[r.length-1].sequence);if(i!==n.lastReadMessageSequence)return i}},ce=function(){function t(t){var e=t.store,r=t.chatroomsActions,n=t.subscriptionService,o=t.currentUser,i=t.enrichedChatroom;this.store=e,this.chatroomsActions=r,this.subscriptionService=n,this.currentUser=o,this.enrichedChatroom=i}return t.prototype.subscribeToChatRoom=function(t){var e=t.chatroomId,r=t.onChange,n=t.onNewMessage,o=t.onInitialFetchDone,i=t.onError,s=this.store,c=this.chatroomsActions;!function(t){delete h[t]}(e);var f=Y(e);f({store:s,onChange:r,onNewMessage:n,onError:i});var p=s.subscribe((function(){return f({store:s,onChange:r,onNewMessage:n,onError:i})})),d=this._createDataFetcher(e,o);setTimeout((function(){return d()}));var v=this._registerSubscription(e,d),m=function(t){var r=t.indications.lastMessageIndications.map((function(t){return t.participantId})),n=t.participants.items.map((function(t){return t.id}));if(!a(u(r,n))){var o=Q(r);a(o)||s.dispatch(c.action$fetchRoomParticipantsDisplayData(e,o))}};return l.c(l.b.FETCH_ENRICHED_CHATROOM_COMPLETED,m),{fetchMore:function(t){s.dispatch(c.fetchRoomMessages(e,t))},unsubscribe:function(){p(),v(),l.f(l.b.FETCH_ENRICHED_CHATROOM_COMPLETED,m)}}},t.prototype._registerSubscription=function(t,e){var r={chatroomId:t};return this.subscriptionService.registerSubscription(r,e)},t.prototype._createDataFetcher=function(t,e){var r=this;return function(){return Object(o.__awaiter)(r,void 0,void 0,(function(){var r,n;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.all([this.store.dispatch(this.chatroomsActions.action$fetchRoom(t,this.enrichedChatroom)),this.store.dispatch(this.chatroomsActions.fetchRoomMessages(t))])];case 1:return o.sent(),e&&(r=this.store.getState(),n=$(r,t),e(n)),[2]}}))}))}},t.prototype.getChatroom=function(t){var e=t.chatroomId;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return t=q(this.store.getState(),e),a(t)?[4,this.store.dispatch(this.chatroomsActions.action$fetchRoom(e,this.enrichedChatroom))]:[2,t];case 1:return r.sent(),[2,q(this.store.getState(),e)]}}))}))},t.prototype.setMessagesRead=function(t){var e=t.chatroomId,r=se(this.store.getState(),e);if(r)return this.store.dispatch(this.chatroomsActions.action$setMessagesRead(e,r))},t.prototype.setRoomsMessagesRead=function(t){var e=this.store.getState(),r=s(t,(function(t){return c(q(e,t),"lastMessage.sequence")})),n=c(q(e,r),"lastMessage.sequence");n&&this.store.dispatch(this.chatroomsActions.action$setRoomsMessagesRead(t,n))},t.prototype.setLastMessageUnread=function(t){var e=t.chatroomId,r=this.store.getState(),n=H(e)(r),o=q(r,e),i=n.length>0&&o.lastReadMessageSequence?o.lastReadMessageSequence-1:0;return this.store.dispatch(this.chatroomsActions.action$setLastMessageUnread(e,i))},t.prototype.sendMessage=function(t){var e=this.currentUser,r=this.store,n=this.chatroomsActions,a=t.dto,s=Object(o.__assign)(Object(o.__assign)({},a),{sender:a.sender||{userId:e.userId,type:e.type},senderDisplayData:e.displayData}),c=new i.a(s),u=n.action$sendMessage(c);return r.dispatch(u)},t.prototype.addMessage=function(t){var e,r=t.dto,n=t.transit;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,i,a,s,c,u,h,f,l,p;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return i=(t=this).currentUser,a=t.store,s=t.chatroomsActions,c=!(null===(e=r.sender)||void 0===e?void 0:e.userId)||r.sender.userId==i.userId,u=Object.assign(r,{transit:n},c?{senderDisplayData:i.displayData,sender:{userId:i.userId}}:{}),h=r.chatroomId,(f=a.getState().chatrooms.byId[h])&&f.id?[3,2]:(l=io.isExperimentOn(W.experiments.EnrichedChatroom),p=a.dispatch(s.action$fetchRoom(h,l)),io.isExperimentOn(W.experiments.UnseenChatroomCount)?[4,p]:[3,2]);case 1:o.sent(),o.label=2;case 2:return[2,a.dispatch(s.action$addMessage(u,!0,a.getState().chatrooms.byId[h]))]}}))}))},t.prototype.deleteMessage=function(t){var e=this.store,r=this.chatroomsActions.action$deleteMessage(t);return e.dispatch(r)},t}(),ue=function(){function t(t){var e=t.store,r=t.selector,n=t.chatroomsActions,o=t.globalUnreadsCountActions;this.store=e,this.selector=r,this.chatroomsActions=n,this.globalUnreadsCountActions=o}return t.prototype.subscribeToGlobalUnreadsCount=function(t){var e=t.callback,r=t.filter,n=this._createStoreCallbackForUnreadsCount(e);return this.selector.isUnreadCountLoaded(this.store.getState())||(this.store.dispatch(this.globalUnreadsCountActions.enable()),this.store.dispatch(this.chatroomsActions.fetchUnreadsChatroomIds({unreadChatroomLimit:it.maxTrackableUnreads+1,filter:r}))),n(),{unsubscribe:this.store.subscribe(n)}},t.prototype._createStoreCallbackForUnreadsCount=function(t){var e,r=this;return function(){var n=r.store.getState(),o=r.selector.getCount(n);r.selector.isUnreadCountLoaded(n)&&(void 0!==e&&e.count===o.count&&e.overflow===o.overflow||t(e=o))}},t}(),he=r(578),fe=function(t,e){var r=t[e];return"string"==typeof r?"true"===r:!!r},le=function(){function t(t,e,r,n,o,i,a,s,c){this.serverApi=t,this.persistence=e,this.dbStorageService=c,this.eventHooks=r,this.chatroomsSelector=n,this.globalUnreadsCountSelector=o,this.globalUnreadsCountActions=i,this.unseenChatroomCountActions=a,this.experiments=s}return t.prototype.action$resetStore=function(){return{type:Dt.RESET_STORE}},t.prototype.fetchRoomMessages=function(t,e){var r=this;return function(n){return Object(o.__awaiter)(r,void 0,void 0,(function(){var r,i,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return r={chatroomId:t,cursor:e,pageSize:W.FetchRoomMessagesPageSize},i=this.dbStorageService?{load:this.dbStorageService.loadMessages(r),save:this.dbStorageService.saveMessages,hydrationKey:"fetchRoomMessages-chatroomId:"+t}:void 0,a={type:Dt.FETCH_ROOM_MESSAGES,payload:this.serverApi.http$fetchRoomMessages(r),dbPayload:i,meta:{chatroomId:t,isFetchMore:!!e}},[4,n(a)];case 1:return o.sent(),[2]}}))}))}},t.prototype.action$fetchRoom=function(t,e){if(void 0===e&&(e=!1),!t){var r={tag:"error",description:"Attempting to fetch chatroom with undefined chatroomId."};l.e(l.a.MONITORING_BI,r),this.eventHooks.reportMonitoringBi(r),console.error("[Troubleshoot] called fetchRoom w/o chatroomId")}return e?{type:Dt.FETCH_ENRICHED_ROOM,payload:this.serverApi.http$fetchEnrichedChatroom({chatroomId:t}).then((function(t){return l.e(l.b.FETCH_ENRICHED_CHATROOM_COMPLETED,t),t}))}:{type:Dt.FETCH_ROOM,payload:this.serverApi.http$fetchRoom({chatroomId:t})}},t.prototype.action$deleteRoom=function(t){var e=this;return function(r){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,r({type:Dt.DELETE_ROOM,payload:this.serverApi.http$deleteChatroom({chatroomId:t}),meta:{chatroomId:t}})];case 1:return e.sent(),[4,this.decrementCounters(r,t)];case 2:return e.sent(),[2]}}))}))}},t.prototype.action$removeRoom=function(t){var e=this;return function(r){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.decrementCounters(r,t)];case 1:return e.sent(),[2,r({type:Dt.REMOVE_ROOM,meta:{chatroomId:t}})]}}))}))}},t.prototype.action$handleRoomArchived=function(t){var e=this;return function(r){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.decrementCounters(r,t)];case 1:return e.sent(),r({type:Dt.HANDLE_ROOM_ARCHIVED,meta:{chatroomId:t}}),[2]}}))}))}},t.prototype.action$handleRoomUnarchived=function(t){var e=this;return function(r,n){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return r({type:Dt.HANDLE_ROOM_UNARCHIVED,meta:{chatroomId:t,chatroom:n().chatrooms.byId[t]}}),this.chatroomsSelector.chatroomHasUnreads(n(),t)&&r(this.globalUnreadsCountActions.markAsUnread(t)),[2]}))}))}},t.prototype.archiveRoom=function(t){var e=this;return function(r){return Promise.all([e.decrementCounters(r,t),r({type:Dt.ARCHIVE_ROOM,payload:e.serverApi.http$archiveChatroom({chatroomId:t}),meta:{chatroomId:t}})])}},t.prototype.unarchiveRoom=function(t){var e=this;return function(r,n){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,r({type:Dt.UNARCHIVE_ROOM,payload:this.serverApi.http$unarchiveChatroom({chatroomId:t}),meta:{chatroomId:t,chatroom:n().chatrooms.byId[t]}})];case 1:return e.sent(),this.chatroomsSelector.chatroomHasUnreads(n(),t)&&r(this.globalUnreadsCountActions.markAsUnread(t)),[2]}}))}))}},t.prototype.fetchRooms=function(t){var e=this,r=void 0===t?{filter:{},cursor:void 0,isSilent:!1}:t,n=r.filter,i=r.cursor,a=r.isSilent,s=void 0!==a&&a;return function(t,r){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e,a,c,u;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e=this.getPageSize(this.experiments,W.experiments.FetchChatroomsPageSize,W.FetchChatroomsPageSizeDefaultValue),a={nextPointer:i,filter:n,pageSize:e},c=this.dbStorageService?{load:this.dbStorageService.loadChatrooms(a),save:this.dbStorageService.saveChatrooms,hydrationKey:"fetchRooms"}:void 0,u={type:Dt.FETCH_ROOMS,payload:this.serverApi.http$fetchChatrooms(a),dbPayload:c,meta:{filter:n,isSilent:s,isFetchMore:!!i}},[4,t(u)];case 1:return o.sent(),this.globalUnreadsCountActions.isEnabled()&&this.updateUnreadChatroomIdsAfterFetchDone(t,r),[2]}}))}))}},t.prototype.fetchUnreadsChatroomIds=function(t){var e=this,r=void 0===t?{}:t,n=r.unreadChatroomLimit,i=r.filter;return function(t,r){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,t({type:Dt.FETCH_UNREAD_CHATROOM_IDS,payload:this.serverApi.http$fetchUnreadChatroomIds({unreadChatroomLimit:n,filter:i})})];case 1:return e=o.sent(),a=e.value.chatroomIds,[4,this.mergeAndUpdateChatroomIds(t,r,a)];case 2:return o.sent(),[2]}}))}))}},t.prototype.addRooms=function(t){return{type:Dt.ADD_ROOMS,rooms:t}},t.prototype.action$addMessage=function(t,e,r){var n=this;return function(o){o({type:Dt.ADD_MESSAGE,message:t,messageSentByCurrentUser:e,meta:{chatroom:r}}),e||t.isSilent||o(n.globalUnreadsCountActions.markAsUnread(t.chatroomId))}},t.prototype.action$sendMessage=function(t){return this.serverApi.http$notifyTyping(t.chatroomId,"stop"),{type:Dt.SEND_MESSAGE,payload:this.serverApi.http$sendMessage(t.chatroomId,t),meta:{message:t.dto}}},t.prototype.action$deleteMessage=function(t){return{type:Dt.DELETE_MESSAGE,meta:{messageId:t}}},t.prototype.action$setMessagesRead=function(t,e){var r=this;return function(n,i){return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,n({type:Dt.SET_MESSAGES_READ,payload:this.serverApi.http$setMessagesRead({chatroomId:t,lastReadMessageSequence:e}),meta:{chatroomId:t,lastReadMessageSequence:e}})];case 1:return r.sent(),[4,this.decrementUnseenCounter(n,t)];case 2:return r.sent(),this.chatroomsSelector.chatroomHasUnreads(i(),t)?[3,4]:[4,this.markAsReadInGlobalUnreadsCount(n,t)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}},t.prototype.action$setMessagesReadForSelf=function(t){var e=this;return function(r,n){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return(e=se(n(),t))?[4,r({type:Dt.SET_MESSAGES_READ_FOR_SELF,meta:{chatroomId:t,lastReadMessageSequence:e}})]:[3,3];case 1:return o.sent(),[4,this.decrementCounters(r,t)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}},t.prototype.action$setRoomsMessagesRead=function(t,e){var r=this;return function(n,i){return Object(o.__awaiter)(r,void 0,void 0,(function(){var r=this;return Object(o.__generator)(this,(function(a){return[2,Promise.all(Object(o.__spreadArrays)([n({type:Dt.SET_ROOMS_MESSAGES_READ,payload:this.serverApi.http$markRoomsAsRead(t,e),meta:{chatroomIds:t}})],t.map((function(t){return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.decrementUnseenCounter(n,t)];case 1:return e.sent(),this.chatroomsSelector.chatroomHasUnreads(i(),t)?[3,3]:[4,this.markAsReadInGlobalUnreadsCount(n,t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}))))]}))}))}},t.prototype.action$setLastMessageUnread=function(t,e){var r=this;return function(n,i){return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,n({type:Dt.SET_LAST_MESSAGE_UNREAD,payload:this.serverApi.http$setMessagesUnread({chatroomId:t,lastReadMessageSequence:e}),meta:{chatroomId:t,lastReadMessageSequence:e,chatroom:i().chatrooms.byId[t]}})];case 1:return r.sent(),[4,this.markAsUnreadInGlobalUnreadsCount(n,t)];case 2:return r.sent(),[2]}}))}))}},t.prototype.typing=function(t,e){return{type:Dt.TYPING,text:e,meta:{chatroomId:t}}},t.prototype.fetchMessageDrafts=function(){return{type:Dt.FETCH_MESSAGE_DRAFTS,payload:this.persistence.loadMessageDrafts()}},t.prototype.action$changeTypingStatus=function(t){return{type:Dt.TYPING_STATUS_CHANGE,payload:t}},t.prototype.action$fetchRoomParticipantsDisplayData=function(t,e){return{type:Dt.FETCH_PARTICIPANTS_DISPLAY_DATA,payload:this.serverApi.http$fetchParticipantsDisplayData({chatroomId:t,participantIds:e})}},t.prototype.setParticipantsPresence=function(t){return{type:Dt.SET_PARTICIPANTS_PRESENCE,chatroomsParticipants:t}},t.prototype.updateParticipantsPresence=function(t){return{type:Dt.UPDATE_PARTICIPANTS_PRESENCE,chatroomsParticipants:t}},t.prototype.updateUnreadChatroomIdsAfterFetchDone=function(t,e){var r=e();if(!this.globalUnreadsCountSelector.getCount(r).overflow){var n=this.globalUnreadsCountSelector.getUnreadChatroomIds(r);this.mergeAndUpdateChatroomIds(t,e,n)}},t.prototype.mergeAndUpdateChatroomIds=function(t,e,r){return void 0===r&&(r=[]),Object(o.__awaiter)(this,void 0,void 0,(function(){var n,i,a,s;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return n=e(),i=this.filterOutPotentialUnreadsKnownAsReads(n,r),a=this.getAllKnownUnreads(n),s=he(a,i),[4,t(this.globalUnreadsCountActions.updateChatroomIds(s))];case 1:return o.sent(),[2]}}))}))},t.prototype.filterOutPotentialUnreadsKnownAsReads=function(t,e){var r=this;return e.filter((function(e){var n=r.chatroomsSelector.chatroomHasUnreads(t,e);return void 0===n||n}))},t.prototype.getAllKnownUnreads=function(t){return this.chatroomsSelector.getAllUnreadChatrooms(t)},t.prototype.decrementCounters=function(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.decrementUnseenCounter(t,e)];case 1:return r.sent(),[2,this.markAsReadInGlobalUnreadsCount(t,e)]}}))}))},t.prototype.decrementUnseenCounter=function(t,e){if(fe(this.experiments,W.experiments.UnseenChatroomCount))return t(this.unseenChatroomCountActions.markChatroomAsSeen(e))},t.prototype.markAsReadInGlobalUnreadsCount=function(t,e){var r=this;return t(this.globalUnreadsCountActions.markAsRead(e,(function(e){var n=e.unreadChatroomLimit;return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,t(this.fetchUnreadsChatroomIds({unreadChatroomLimit:n}))];case 1:return[2,e.sent()]}}))}))})))},t.prototype.markAsUnreadInGlobalUnreadsCount=function(t,e){return t(this.globalUnreadsCountActions.markAsUnread(e))},t.prototype.action$deleteRooms=function(t){var e=this;return function(r){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e=this;return Object(o.__generator)(this,(function(n){return[2,Promise.all(Object(o.__spreadArrays)([r({type:Dt.DELETE_ROOMS,payload:this.serverApi.http$deleteChatrooms(t),meta:{chatroomIds:t}})],t.map((function(t){return e.decrementCounters(r,t)}))))]}))}))}},t.prototype.archiveRooms=function(t){var e=this;return function(r){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e=this;return Object(o.__generator)(this,(function(n){return[2,Promise.all(Object(o.__spreadArrays)([r({type:Dt.ARCHIVE_ROOMS,payload:this.serverApi.http$archiveChatrooms(t),meta:{chatroomIds:t}})],t.map((function(t){return e.decrementCounters(r,t)}))))]}))}))}},t.prototype.unarchiveRooms=function(t){var e=this;return function(r,n){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e,i=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,r({type:Dt.UNARCHIVE_ROOMS,payload:this.serverApi.http$unarchiveChatrooms(t),meta:{chatroomIds:t,chatrooms:t.map((function(t){return n().chatrooms.byId[t]}))}})];case 1:return o.sent(),e=[],t.forEach((function(t){return e.push(i.markAsUnreadInGlobalUnreadsCount(r,t))})),[4,Promise.all(e)];case 2:return o.sent(),[2]}}))}))}},t.prototype.getPageSize=function(t,e,r){var n=parseInt(function(t,e,r){var n=t[e];return void 0===n?r:n}(t,e,r));return isNaN(n)?parseInt(r):n},t}(),pe=function(t,e,r,n,o,i,a,s,c){return new le(t,e,r,n,o,i,a,s,c)},de=function(){function t(t){this.serverApi=t}return t.prototype.action$fetchDrillInMessageIndications=function(t,e){return{type:Dt.FETCH_DRILL_IN_MESSAGE_INDICATIONS,payload:this.serverApi.http$fetchDrillInMessageIndications(t,e).then((function(t){return l.e(l.b.FETCH_DRILL_IN_MESSAGE_INDICATIONS_COMPLETED,t),t}))}},t.prototype.action$updateMessagesIndications=function(t){return{type:Dt.UPDATE_MESSAGES_INDICATIONS,payload:t}},t.prototype.action$fetchRoomParticipantsDisplayData=function(t,e){return{type:Dt.FETCH_PARTICIPANTS_DISPLAY_DATA,payload:this.serverApi.http$fetchParticipantsDisplayData({chatroomId:t,participantIds:e})}},t}(),ve=function(t){return new de(t)},me="GlobalUnreadsCount.UPDATE_UNREAD_CHATROOMS",ge="GlobalUnreadsCount.MARK_CHATROOM_READ",ye="GlobalUnreadsCount.MARK_CHATROOM_UNREAD",_e="GlobalUnreadsCount.FETCH_UNREAD_CHATROOM_IDS",be={type:"GlobalUnreadsCount.NO_OP"},Oe=function(){function t(){}return t.prototype.isEnabled=function(){return!1},t.prototype.enable=function(){return be},t.prototype.updateChatroomIds=function(){return be},t.prototype.markAsRead=function(){return be},t.prototype.markAsUnread=function(){return be},t}(),Ee=function(){function t(t){this.unreadChatroomsToFetch=t.maxTrackableUnreads+1}return t.prototype.enable=function(){return be},t.prototype.isEnabled=function(){return!0},t.prototype.updateChatroomIds=function(t){return{type:me,data:{chatroomIds:t}}},t.prototype.markAsRead=function(t,e){var r=this;return function(n,i){return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,n({type:ge,data:{chatroomId:t}})];case 1:return r.sent(),0!==i().globalUnreadsCount.resyncCountdown?[3,3]:[4,e({unreadChatroomLimit:this.unreadChatroomsToFetch})];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}},t.prototype.markAsUnread=function(t){return{type:ye,data:{chatroomId:t}}},t}(),Se=function(){function t(t){this.instance=new Oe,this.config=t}return t.prototype.enable=function(){return this.instance=new Ee(this.config),be},t.prototype.isEnabled=function(){return this.instance.isEnabled()},t.prototype.updateChatroomIds=function(t){return this.instance.updateChatroomIds(t)},t.prototype.markAsRead=function(t,e){return this.instance.markAsRead(t,e)},t.prototype.markAsUnread=function(t){return this.instance.markAsUnread(t)},t}(),Ae=function(){function t(t){this.config=t}return t.prototype.getCount=function(t){if(void 0!==t.globalUnreadsCount.resyncCountdown)return{count:this.config.maxUnreadsCount,overflow:!0};var e=t.globalUnreadsCount.chatroomsCount;return{count:Math.min(e,this.config.maxUnreadsCount),overflow:e>this.config.maxUnreadsCount}},t.prototype.isMarkedUnread=function(t,e){return Boolean((t.globalUnreadsCount.chatroomIds||{})[e])},t.prototype.isUnreadCountLoaded=function(t){return Boolean(void 0!==t.globalUnreadsCount.resyncCountdown||t.globalUnreadsCount.chatroomIds)},t.prototype.getUnreadChatroomIds=function(t){var e;return Object.keys((null===(e=t.globalUnreadsCount)||void 0===e?void 0:e.chatroomIds)||{})},t}(),Ie={evid:1101},Ce=new(function(){function t(){}return t.prototype.setAppName=function(t){this._appName=t},Object.defineProperty(t.prototype,"appName",{get:function(){return this._appName},enumerable:!0,configurable:!0}),t}()),Te=function(){function t(t){this.chatAgent=t}return t.prototype.http$fetchChatrooms=function(e){var r=e.nextPointer,n=e.filter,o=void 0===n?{}:n,i=e.pageSize,a=void 0===i?100:i,s=e.unreadChatroomLimit,c={nextPointer:r,pageSize:a,archived:o.isArchived,lastMessageLimit:t.LAST_MESSAGES_COUNT_LIMIT,unreadChatroomLimit:s||t.DEFAULT_UNREAD_CHATROOM_IDS_COUNT_LIMIT},u=io.isExperimentOn(W.experiments.PostOnChatroomsList),h=u?{participantIds:o.participantIds||[],labelIds:o.labelIds||[]}:void 0;return u||(c.participantId=o.participantIds,c.participantType=o.participantType,c.labelId=o.labelIds),u?this.chatAgent.post({urlSuffix:"chatrooms-for-list-view"+(o.participantType?"/"+o.participantType:""),data:h,query:c}).then((function(t){return t.data})):this.chatAgent.get({urlSuffix:"chatrooms-for-list-view",query:c}).then((function(t){return t.data}))},t.prototype.http$search=function(e){var r=e.searchTerm,n=e.participantIds,o=e.chatroomsPageSize,i=e.chatroomsNextPointer,a=e.messagesPageSize,s=e.messagesNextPointer,c={query:r,participantIds:n,chatroomsPaginator:{pageSize:o,lastMessageLimit:t.LAST_MESSAGES_COUNT_LIMIT,nextPointer:i},messagesPaginator:{pageSize:a,nextPointer:s}};return this.chatAgent.post({urlPrefix:"_serverless/",urlSuffix:"chat-search/search",data:c}).then((function(t){return t.data}))},t.prototype.http$fetchRoomMessages=function(t){var e=t.chatroomId,r=t.cursor,n=t.pageSize,o=void 0===n?50:n;return this.chatAgent.get({urlSuffix:"chatrooms/"+e+"/messages",query:{pageSize:o,nextPointer:r}}).then((function(t){return t.data}))},t.prototype.http$fetchRoomMessagesPage=function(t){var e=t.chatroomId,r=t.messageSequence,n=t.pageSize,o=void 0===n?30:n;return this.chatAgent.get({urlSuffix:"chatrooms/"+e+"/messages/page",query:{pageSize:o,pointer:r}}).then((function(t){return t.data.items}))},t.prototype.http$fetchRoom=function(t){var e=t.chatroomId;return this.chatAgent.get({urlSuffix:"chatrooms/"+e}).then((function(t){return t.data}))},t.prototype.http$fetchEnrichedChatroom=function(t){var e=t.chatroomId;return this.chatAgent.get({urlSuffix:"chatrooms/"+e+"/enriched"}).then((function(t){return t.data}))},t.prototype.http$fetchUnreadChatroomIds=function(e){var r=void 0===e?{}:e,n=r.unreadChatroomLimit,o=void 0===n?t.DEFAULT_UNREAD_CHATROOM_IDS_COUNT_LIMIT:n,i=r.filter;if(i){var a=i.participantIds;return this.chatAgent.post({urlSuffix:"unread-chatrooms",data:{participantIds:a},query:{unreadChatroomLimit:o}}).then((function(t){return t.data}))}return this.chatAgent.get({urlSuffix:"unread-chatrooms",query:{unreadChatroomLimit:o}}).then((function(t){return t.data}))},t.prototype.http$setMessagesRead=function(t){var e=t.chatroomId,r=t.lastReadMessageSequence;return l.e(l.a.MESSAGES_READ,e),this.chatAgent.put({urlSuffix:"chatrooms/"+e+"/users",data:{lastReadMessageSequence:r}}).then((function(t){return t.data}))},t.prototype.http$setMessagesUnread=function(t){var e=t.chatroomId,r=t.lastReadMessageSequence;return this.chatAgent.put({urlSuffix:"chatrooms/"+e+"/unread",data:{lastReadMessageSequence:r}}).then((function(t){return t.data}))},t.prototype.http$deleteChatroom=function(t){var e=t.chatroomId;return this.chatAgent.zdelete({urlSuffix:"chatrooms/"+e}).then((function(t){return t.data}))},t.prototype.http$deleteChatrooms=function(t){return this.chatAgent.zdelete({urlSuffix:"chatrooms",data:{chatroomIds:t}}).then((function(t){return t.data}))},t.prototype.http$archiveChatroom=function(t){var e=t.chatroomId;return this.chatAgent.put({urlSuffix:"chatrooms/"+e+"/archive"}).then((function(t){return t.data}))},t.prototype.http$archiveChatrooms=function(t){return this.chatAgent.put({urlSuffix:"chatrooms/archive",data:{chatroomIds:t}}).then((function(t){return t.data}))},t.prototype.http$unarchiveChatrooms=function(t){return this.chatAgent.put({urlSuffix:"chatrooms/unarchive",data:{chatroomIds:t}}).then((function(t){return t.data}))},t.prototype.http$unarchiveChatroom=function(t){var e=t.chatroomId;return this.chatAgent.put({urlSuffix:"chatrooms/"+e+"/unarchive"}).then((function(t){return t.data}))},t.prototype.http$initRealtimeToken=function(t){return this.chatAgent.post({urlSuffix:"real-time-tokens",data:{token:t}}).then((function(t){return t.data}))},t.prototype.http$sendMessage=function(t,e){e.createdAt=e.createdAt||Date.now();var r=e.type,n=e.sender,i=e.id;return l.e(l.a.MESSAGE_SENT,e),l.e(l.a.BI,Object(o.__assign)(Object(o.__assign)({},Ie),{messageId:i,chatRoomId:t,messageType:r,uuid:n.userId,mimeType:e.mimeTypes,hostName:Ce.appName})),this.chatAgent.post({urlSuffix:"chatrooms/"+t+"/messages",data:e.dto}).then((function(t){return t.data})).catch((function(t){throw l.e(l.a.BI_ERROR,{tag:"send-message",description:"failed to send message",errorName:t}),t}))},t.prototype.http$fetchCurrentUserDisplayData=function(){return this.chatAgent.get({urlSuffix:"display-data/current-user"}).then((function(t){return t.data?t.data.content:void 0}))},t.prototype.http$notifyTyping=function(t,e,r){return this.chatAgent.post({urlSuffix:"chatrooms/"+t+"/typing-events",data:{type:e,expiryDuration:r}}).then((function(t){return t.data}))},t.prototype.http$markRoomsAsRead=function(t,e){return this.chatAgent.put({urlSuffix:"chatrooms/read",data:{chatroomIds:t,lastMessageSequence:e}}).then((function(t){return t.data}))},t.prototype.http$markAllRoomsAsRead=function(t){var e={participantId:t.participantIds,participantType:t.participantType};return this.chatAgent.put({urlSuffix:"chatrooms/mark-all-read",query:e}).then((function(t){return t.data}))},t.prototype.http$fetchParticipantsDisplayData=function(t){var e=t.chatroomId,r=t.participantIds;return this.chatAgent.post({urlSuffix:"display-data/"+e,data:{participantIds:r}}).then((function(t){return t.data}))},t.prototype.http$fetchDrillInMessageIndications=function(t,e){return this.chatAgent.get({urlSuffix:"indications/"+t+"/detailed",query:{sequence:e}}).then((function(t){return t.data}))},t.prototype.http$fetchUnseenChatroomCount=function(e,r){return void 0===r&&(r=t.DEFAULT_UNREAD_CHATROOM_IDS_COUNT_LIMIT),this.chatAgent.get({urlSuffix:"unseen-chatrooms",query:Object(o.__assign)(Object(o.__assign)({},e),{limit:r})}).then((function(t){return t.data}))},t.prototype.http$markChatroomsAsSeen=function(t,e){return this.chatAgent.put({urlSuffix:"chatrooms/seen",data:{lastSeenMessageSequence:e},query:t}).then((function(t){return t.data}))},t.prototype.http$watch=function(){return this.chatAgent.put({urlSuffix:"chat-presence/watch/group"}).then((function(t){return t.data}))},t.prototype.http$setPresence=function(t,e){return this.chatAgent.post({urlPrefix:"_api/chat-presence-server/v1/",urlSuffix:"presence/user-presence",data:{userPresence:t,token:e,context:{operation:"UPDATE"}}}).then((function(t){return t.data}))},t.LAST_MESSAGES_COUNT_LIMIT=10,t.DEFAULT_UNREAD_CHATROOM_IDS_COUNT_LIMIT=100,t}(),Re=r(279),je=function(){function t(){this._decodedToken={}}return t.prototype.loadJwtChatToken=function(t){try{var e=t.split(".")[1];this._decodedToken=JSON.parse(Re.decode(e)||"{}")}catch(t){this._decodedToken={}}},Object.defineProperty(t.prototype,"token",{get:function(){return this._token},set:function(t){this._token=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayData",{get:function(){return this._displayData},set:function(t){this._displayData=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._decodedToken.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"participantIds",{get:function(){return this._decodedToken.participantIds},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userId",{get:function(){return this._decodedToken.userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tokenExpirationTime",{get:function(){return this._decodedToken.exp},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isExpiredToken",{get:function(){return 1e3*(this.tokenExpirationTime||0)-(new Date).getTime()<1e3},enumerable:!0,configurable:!0}),t}(),we=r(281),Me={serverApiThrottlingTimout:2e3,localStateThrottlingTimout:1e3},xe=function(){function t(t,e,r,n,i){var a=this;void 0===i&&(i=Me),this.store=t,this.chatroomsActions=e,this.serverApi=r,this.persistenceService=n,this.config=i,this.sendTypingEventToServerThrottled=we((function(t){return Object(o.__awaiter)(a,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return[2,this.serverApi.http$notifyTyping(t,"start",5e3)]}))}))}),this.config.serverApiThrottlingTimout,{leading:!0,trailing:!1}),this.sendTypingEventThrottled=we((function(t){var e=t.chatroomId,r=t.text;return Object(o.__awaiter)(a,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return this.store.dispatch(this.chatroomsActions.typing(e,r)),this.persistMessageDraft({chatroomId:e,text:r}),[2]}))}))}),this.config.localStateThrottlingTimout,{leading:!0,trailing:!0})}return t.prototype.notifyTextChange=function(t,e,r){void 0===r&&(r=!1),void 0!==e&&this.sendTypingEventThrottled({chatroomId:t,text:e}),r&&this.sendTypingEventToServerThrottled(t)},t.prototype.notifyTyping=function(t,e){this.notifyTextChange(t,e,!0)},t.prototype.persistMessageDraft=function(t){var e=t.chatroomId,r=t.text;this.canPersist()&&this.sendMessageDraftToPersistence({chatroomId:e,text:r})},t.prototype.canPersist=function(){return!this.store.getState().messageDraft.isFetching},t.prototype.sendMessageDraftToPersistence=function(t){var e,r=t.chatroomId,n=t.text,i=this.store.getState().messageDraft.byId,a=Object(o.__assign)(Object(o.__assign)({},i),((e={})[r]=n,e));this.persistenceService.saveMessageDrafts(a)},t}(),Pe={setItem:function(){return Promise.resolve()},getItem:function(){return Promise.resolve(JSON.stringify({}))},removeItem:function(){return Promise.resolve("remove")}},De=function(t){return t?JSON.parse(t):t},Ne=function(){function t(t,e,r){void 0===t&&(t=Pe),void 0===e&&(e=""),void 0===r&&(r=[]),this.persistenceEngine=t,this.userBasedPrefix=e+"_"+r.join("_")}return t.prototype.saveMessageDrafts=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return[2,this.setItemForUserId("crm.chat.MESSAGE_DRAFT_PERSISTENCE_KEY",JSON.stringify(t))]}))}))},t.prototype.loadMessageDrafts=function(){return this.getItemForUserId("crm.chat.MESSAGE_DRAFT_PERSISTENCE_KEY").then(De).catch((function(t){return console.warn("Error while loading message draft data from persistence "+t),{}}))},t.prototype.clearMessageDrafts=function(){return this.removeItemForUserId("crm.chat.MESSAGE_DRAFT_PERSISTENCE_KEY").catch((function(t){return console.warn("Error while removing message draft from persistence "+t),{}}))},t.prototype.saveToken=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){return[2,this.persistenceEngine.setItem("crm.chat.CHAT_TOKEN_PERSISTENCE_KEY",t)]}))}))},t.prototype.getChatToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return[2,this.persistenceEngine.getItem("crm.chat.CHAT_TOKEN_PERSISTENCE_KEY")]}))}))},t.prototype.removeItemForUserId=function(t){return this.persistenceEngine.removeItem(this.userBasedPrefix+"_"+t)},t.prototype.getItemForUserId=function(t){return this.persistenceEngine.getItem(this.userBasedPrefix+"_"+t)},t.prototype.setItemForUserId=function(t,e){return this.persistenceEngine.setItem(this.userBasedPrefix+"_"+t,e)},t}(),Ue=r(31),ke=r(570),Le=function(){function t(){this.reset()}return t.prototype.registerSubscription=function(t,e,r){var n=this;a(t)&&(t={isArchived:!1});var o=Ue(),i=ke(Object.values(this.refreshDataCallbacks),(function(e){return O(t,e.identifier)}));return i?function(){return i}:(r&&r(),this.refreshDataCallbacks[o]={identifier:t,refreshDataCallback:e},function(){delete n.refreshDataCallbacks[o]})},t.prototype.refreshSubscribedData=function(){var t=Object.values(this.refreshDataCallbacks,(function(t){return t.identifier})).map((function(t){return(0,t.refreshDataCallback)()}));return Promise.all(t)},t.prototype.reset=function(){this.refreshDataCallbacks={}},t}(),Fe=r(435),He=function(t){function e(e){var r=e.baseUrl,n=e.authorization,o=t.call(this,{baseUrl:r,retryOnAllErrors:!0})||this;return o.authorization=n,o}return Object(o.__extends)(e,t),e.prototype._getHeaders=function(){var t={Accept:"application/json","Content-Type":"application/json"};return this.authorization&&(t.Authorization=this.authorization),t},e.prototype._getRelativeUrl=function(t){return"/wix-chat-tokens-server/v1/"+t+"?isForUnifiedList=true"},e}(Fe.a);function Ge(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(i){switch(i.label){case 0:return e=t.url,r=t.authorization,n=new He({baseUrl:e,authorization:r}),[4,function(t){var e=t.handshakeAgent;return{http$getToken:function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,r;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,e.post("chat-tokens")];case 1:if(t=n.sent(),r=c(t,["data","chatToken"]))return[2,r];throw Error("no token: "+t)}}))}))}}}({handshakeAgent:n}).http$getToken()];case 1:return[2,i.sent()]}}))}))}function qe(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return t?[4,new Ne(t).getChatToken()]:[3,2];case 1:if((e=r.sent())&&!function(t){var e=new je;return e.loadJwtChatToken(t),e.isExpiredToken}(e))return[2,e];r.label=2;case 2:return[2]}}))}))}function ze(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return e?[4,new Ne(e).saveToken(t)]:[3,2];case 1:return[2,r.sent()];case 2:return[2]}}))}))}var $e=r(574),Be=function(t){function e(e){var r=this,n=e.baseUrl,o=e.currentUser,i=e.httpHeaders,a=e.tokenServer,s=e.throttleThreshold;return(r=t.call(this,{baseUrl:n,throttleThreshold:s})||this).currentUser=o,r.headers=i,r.tokenServer=a,r}return Object(o.__extends)(e,t),e.prototype._getRelativeUrl=function(t,e){return"/"+t+"?"+$e.stringify(Object.assign({chatToken:this.currentUser.token},e),{indices:!1})},e.prototype._getHeaders=function(){return this.headers},e.prototype._issueNewTokenIfNeeded=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return this.tokenServer&&this.currentUser.isExpiredToken?[4,Ge(this.tokenServer)]:[3,2];case 1:t=e.sent(),this.currentUser=new je,this.currentUser.loadJwtChatToken(t),this.currentUser.token=t,e.label=2;case 2:return[2]}}))}))},e.prototype.post=function(e){var r=e.urlPrefix,n=void 0===r?"_api/chat-web/v1/":r,i=e.urlSuffix,a=e.data,s=e.query,c=void 0===s?{}:s;return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._issueNewTokenIfNeeded()];case 1:return r.sent(),e=""+n+i,[2,t.prototype.post.call(this,e,a,c)]}}))}))},e.prototype.get=function(e){var r=e.urlPrefix,n=void 0===r?"_api/chat-web/v1/":r,i=e.urlSuffix,a=e.query,s=void 0===a?{}:a;return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._issueNewTokenIfNeeded()];case 1:return r.sent(),e=""+n+i,[2,t.prototype.get.call(this,e,s)]}}))}))},e.prototype.put=function(e){var r=e.urlPrefix,n=void 0===r?"_api/chat-web/v1/":r,i=e.urlSuffix,a=e.data,s=e.query,c=void 0===s?{}:s;return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._issueNewTokenIfNeeded()];case 1:return r.sent(),e=""+n+i,[2,t.prototype.put.call(this,e,a,c)]}}))}))},e.prototype.zdelete=function(e){var r=e.urlPrefix,n=void 0===r?"_api/chat-web/v1/":r,i=e.urlSuffix,a=e.data;return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._issueNewTokenIfNeeded()];case 1:return r.sent(),e=""+n+i,[2,t.prototype.zdelete.call(this,e,a)]}}))}))},e}(Fe.a),Ve=function(){function t(t){this.config=t}return t.prototype.isChatroomUnread=function(t,e){return(t.chatroomIds||{})[e]},t.prototype.parseUnreadChatroomIdsArray=function(t){return{chatroomIds:E(t,(function(t,e){return t[e]=!0,t}),{}),chatroomsCount:t.length}},t.prototype.reduceToTrackingOverflowState=function(){return{chatroomIds:void 0,chatroomsCount:void 0,resyncCountdown:this.config.maxTrackableUnreads-this.config.maxUnreadsCount}},t.prototype.isInTrackingOverflowState=function(t){return void 0!==t.resyncCountdown},t}(),Ke=function(t){function e(e){return t.call(this,e)||this}return Object(o.__extends)(e,t),e.prototype.reduce=function(t,e){var r=this.extractUnreadChatroomIds(e);return r.length>this.config.maxTrackableUnreads?this.reduceToTrackingOverflowState():this.reduceUnreadsIdsModification(t,r)},e.prototype.extractUnreadChatroomIds=function(t){return c(t,["data","chatroomIds"],[])},e.prototype.reduceUnreadsIdsModification=function(t,e){var r=this.parseUnreadChatroomIdsArray(e);return Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},t),r),{resyncCountdown:void 0})},e}(Ve),Ye=Ke,Qe=function(t){function e(e){return t.call(this,e)||this}return Object(o.__extends)(e,t),e.prototype.extractUnreadChatroomIds=function(t){return c(t,["payload","chatroomIds"],[])},e}(Ke),We=function(t){function e(e){return t.call(this,e)||this}return Object(o.__extends)(e,t),e.prototype.reduce=function(t,e){var r=c(e,["data","chatroomId"]);return this.isInTrackingOverflowState(t)?Object(o.__assign)(Object(o.__assign)({},t),{resyncCountdown:Math.max(t.resyncCountdown-1,0)}):this.isChatroomUnread(t,r)?this.removeFromUnreads(t,r):t},e.prototype.removeFromUnreads=function(t,e){var r=t.chatroomsCount-1,n=Object(o.__assign)({},t.chatroomIds);return delete n[e],Object(o.__assign)(Object(o.__assign)({},t),{chatroomIds:n,chatroomsCount:r,resyncCountdown:void 0})},e}(Ve),Je=function(t){function e(e){return t.call(this,e)||this}return Object(o.__extends)(e,t),e.prototype.reduce=function(t,e){var r=c(e,["data","chatroomId"]);return this.isInTrackingOverflowState(t)||this.isChatroomUnread(t,r)?t:t.chatroomsCount===this.config.maxTrackableUnreads?this.reduceToTrackingOverflowState():this.reduceUnreadIdsModification(t,r)},e.prototype.reduceUnreadIdsModification=function(t,e){var r=this.addToUnreads(t,e);return Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},t),r),{resyncCountdown:void 0})},e.prototype.addToUnreads=function(t,e){var r,n=t.chatroomsCount+1;return{chatroomIds:Object(o.__assign)(Object(o.__assign)({},t.chatroomIds),((r={})[e]=!0,r)),chatroomsCount:n}},e}(Ve),Xe=function(){function t(t){var e;this.subReducers=((e={})[me]=new Ye(t),e[ge]=new We(t),e[ye]=new Je(t),e[Object(Nt.c)(_e)]=new Qe(t),e)}return t.prototype.reduce=function(t,e){void 0===t&&(t=Ze);var r=this.subReducers[e.type];return r?r.reduce(t,e):t},t}(),Ze={chatroomIds:void 0,chatroomsCount:0},tr=r(227),er=r(58),rr=function(t){var e,r=(e=io.store.getState(),e.messages||{}).byId;return t.every((function(t){return void 0===r[t.id]}))},nr={},or=[],ir=function(t,e,r){return void 0===r&&(r=!1),r?t:Math.max(t||0,e||0)},ar=function(t,e,r,n){return t[e]?void 0===t[e][r]?n:t[e][r]:n},sr=function(t,e,r,n){var i;void 0===r&&(r=[]);var a,s,u,h,f,l=void 0===n?{}:n,p=l.shouldRemoveExistingImage,d=void 0!==p&&p,v=l.enrichedChatroomLoaded,m=void 0!==v&&v,g=l.typingEvent,y=void 0===g?{}:g,_=l.overrideRegardlessOfSequenceComparison,b=void 0!==_&&_,O=e.chatroomId||e.id,E=e.participantId,S=e.cursor,A=e.lastMessage,I=e.unreadCount,C=void 0===I?ar(t,O,"unreadCount",0):I,T=e.lastReadMessageSequence,R=void 0===T?ar(t,O,"lastReadMessageSequence",0):T,j=e.lastSeenMessageSequence,w=void 0===j?ar(t,O,"lastSeenMessageSequence",0):j,M=e.displayData,x=void 0===M?{}:M,P=e.isPrivate,D=e.offlineChannels,N=e.clientReferenceType,U=e.clientReference,k=e.participantCount,L=e.isArchived,F=e.isTemporary,H=e.createdBy,G=e.createdAt,q=e.businessContext,z=e.pluginName,$=e.sortRank,B=e.name,V=e.initials,K=e.image,Y=e.siteUserType,Q=e.otherParticipantId,W=e.labelIds,J=t,X=J[O]||{unreadCount:C,lastReadMessageSequence:R,lastSeenMessageSequence:w},Z=X.typingStatus||or,tt=gr(Z,y),et=r&&r.length>0,rt=void 0!==X.participants,nt={id:O,cursor:void 0!==S?S:X.cursor,lastMessage:A||X.lastMessage,lastReadMessageSequence:ir(R,X.lastReadMessageSequence,b),lastSeenMessageSequence:ir(w,X.lastSeenMessageSequence),unreadCount:(a=C,s=X.unreadCount,u=R,h=X.lastReadMessageSequence,f=b,void 0===f&&(f=!1),f?a:(h||0)>(u||0)?s:a),name:c(x,"name")||B||X.name,initials:c(x,"initials")||V||X.initials,image:d&&x?x.image:K||X.image||c(x,"image"),typingStatus:tt,isPrivate:void 0!==P?P:X.isPrivate,otherParticipantId:Q||((null==x?void 0:x.id)?x.id:X.otherParticipantId),clientReferenceType:N||X.clientReferenceType,clientReference:U||X.clientReference,offlineChannels:D||X.offlineChannels,siteUserType:c(x,"type")||Y||X.siteUserType,participantCount:void 0!==k?k:X.participantCount,isArchived:void 0!==L?L:X.isArchived,participantId:void 0!==E?E:X.participantId,isTemporary:void 0!==F?F:X.isTemporary,createdBy:void 0!==H?H:X.createdBy,createdAt:void 0!==G?G:X.createdAt,businessContext:q||X.businessContext,enrichedChatroomLoaded:m||X.enrichedChatroomLoaded,pluginName:z||X.pluginName,sortRank:$||X.sortRank,participants:et||!rt?r:X.participants,labelIds:W||X.labelIds},ot=Object(o.__assign)(Object(o.__assign)({},J),((i={})[O]=Object(o.__assign)(Object(o.__assign)({},X),nt),i));return Object(o.__assign)(Object(o.__assign)({},t),ot)},cr=function(t,e,r,n){return void 0===r&&(r=[]),sr(t,e,r,Object(o.__assign)({shouldRemoveExistingImage:!0},n))},ur=function(t,e){return fr(t,e,!1)},hr=function(t,e){return fr(t,e,!0)},fr=function(t,e,r){return sr(t,{chatroomId:e,isArchived:r})},lr=function(t,e){return sr(t,{chatroomId:e,unreadCount:(t[e].unreadCount||0)+1,lastReadMessageSequence:t[e].lastReadMessageSequence})},pr=function(t,e){return sr(t,{chatroomId:e.chatroomId,lastMessage:e})};function dr(t,e){var r=e[t.id];return c(t,"lastMessages.0.sequence")<c(r,"lastMessages.0.sequence")}var vr=function(t,e,r){var n;return Object(o.__assign)(Object(o.__assign)({},t),((n={})[r]=Object(o.__assign)(Object(o.__assign)({},t[r]||{}),{cursor:e,error:void 0}),n))},mr=function(t,e){var r;return Object(o.__assign)(Object(o.__assign)({},t),((r={})[e]=Object(o.__assign)(Object(o.__assign)({},t[e]),{error:void 0}),r))},gr=function(t,e){return e.type===er.a.TYPING_STARTED?_r(t,e):yr(t,e)},yr=function(t,e){return a(t)?or:t.filter((function(t){return t.userId!==e.userId}))},_r=function(t,e){var r;return e.isCurrentUser||br(t,e)?r=t:(r=Object(o.__spreadArrays)(t)).push({userId:e.userId,displayData:e.displayData}),r},br=function(t,e){return t.some((function(t){return t.userId===e.userId}))};function Or(t,e){var r,n=null===(r=t[e].lastMessage)||void 0===r?void 0:r.sequence;return sr(t,{unreadCount:0,chatroomId:e,lastReadMessageSequence:n})}function Er(t,e){return Object(o.__assign)({},tr(t,e))}var Sr={isFetchingRooms:!1,isFetchingFromStorage:!1,isFetchingMoreRooms:!1,isFetchingRoom:!1};var Ar=wt({status:function(t,e){void 0===t&&(t=Sr);var r=c(e,"meta.fromStorage",!1);switch(e.type){case Object(Nt.c)(Dt.FETCH_ROOM):case Object(Nt.a)(Dt.FETCH_ROOM):return Object(o.__assign)(Object(o.__assign)({},t),{isFetchingRoom:!1});case Object(Nt.b)(Dt.FETCH_ROOM):return Object(o.__assign)(Object(o.__assign)({},t),{isFetchingRoom:!0});case Object(Nt.c)(Dt.FETCH_ROOMS):return r?Object(o.__assign)(Object(o.__assign)({},t),{isFetchingFromStorage:!1}):Object(o.__assign)(Object(o.__assign)({},t),{isFetchingRooms:!1,isFetchingMoreRooms:!1,error:null});case Object(Nt.a)(Dt.FETCH_ROOMS):var n=e.payload.is401Error?null:e.payload;return Object(o.__assign)(Object(o.__assign)({},t),{isFetchingRooms:!1,isFetchingMoreRooms:!1,error:n,isFetchingFromStorage:r});case Object(Nt.b)(Dt.FETCH_ROOMS):if(r)return Object(o.__assign)(Object(o.__assign)({},t),{isFetchingFromStorage:!0});var i=c(e,"meta.isSilent"),a=c(e,"meta.isFetchMore")&&!i;return r?Object(o.__assign)(Object(o.__assign)({},t),{isFetchingFromStorage:!i,isFetchingMoreRooms:a,error:null}):Object(o.__assign)(Object(o.__assign)({},t),{isFetchingRooms:!i,isFetchingMoreRooms:a,error:null});default:return t}},byId:function(t,e){var r,n,i,s;switch(void 0===t&&(t=nr),e.type){case Dt.TYPING_STATUS_CHANGE:return sr(t,{chatroomId:e.payload.chatroomId},[],{typingEvent:e.payload});case Object(Nt.c)(Dt.FETCH_ROOM):return dr(e.payload,t)?t:cr(t,e.payload);case Object(Nt.c)(Dt.FETCH_ENRICHED_ROOM):return dr(e.payload.chatroom,t)?t:cr(t,e.payload.chatroom,e.payload.participants.items,{enrichedChatroomLoaded:!0});case Object(Nt.c)(Dt.FETCH_ROOMS):return function(t,e,r){if(void 0===r&&(r=!1),a(e.payload))return t;var n=e.payload.chatrooms.items,o=t;return n.forEach((function(e){!!t[e.id]&&!r||(o=sr(o,e))})),o}(t,e,!0);case Dt.ADD_ROOMS:return function(t,e){var r=t;return e.forEach((function(t){r=sr(r,t)})),r}(t,e.rooms);case Object(Nt.b)(Dt.SEND_MESSAGE):var u=e.meta.message;return pr(t,u);case Dt.ADD_MESSAGE:return function(t,e){var r=e.message,n=r.isSilent,o=t[r.chatroomId];if(!o||n)return t;var i=r.sequence>c(o,"lastMessage.sequence",0),a=pr(t,r);return e.messageSentByCurrentUser?i?Or(a,r.chatroomId):a:i?lr(a,r.chatroomId):t}(t,e);case Dt.HANDLE_ROOM_ARCHIVED:case Object(Nt.b)(Dt.ARCHIVE_ROOM):return hr(t,e.meta.chatroomId);case Object(Nt.c)(Dt.ARCHIVE_ROOMS):return function(t,e){var r=Object(o.__assign)({},t);return e.meta.chatroomIds.forEach((function(t){return r=hr(r,t)})),r}(t,e);case Object(Nt.c)(Dt.UNARCHIVE_ROOMS):return function(t,e){var r=Object(o.__assign)({},t);return e.meta.chatroomIds.forEach((function(t){return r=ur(r,t)})),r}(t,e);case Object(Nt.c)(Dt.DELETE_ROOMS):return function(t,e){var r=Object(o.__assign)({},t);return e.meta.chatroomIds.forEach((function(t){return r=Er(r,t)})),r}(t,e);case Dt.HANDLE_ROOM_UNARCHIVED:case Object(Nt.b)(Dt.UNARCHIVE_ROOM):return ur(t,e.meta.chatroomId);case Object(Nt.b)(Dt.DELETE_ROOM):case Dt.REMOVE_ROOM:return Er(t,e.meta.chatroomId);case Dt.SET_MESSAGES_READ_FOR_SELF:case Object(Nt.b)(Dt.SET_MESSAGES_READ):var h=e.meta,f=h.lastReadMessageSequence,l=h.chatroomId;return sr(t,{unreadCount:0,lastReadMessageSequence:f,chatroomId:l});case Object(Nt.b)(Dt.SET_ROOMS_MESSAGES_READ):var p=Object(o.__assign)({},t);return e.meta.chatroomIds.forEach((function(t){p=Or(p,t)})),p;case Object(Nt.b)(Dt.SET_LAST_MESSAGE_UNREAD):var d=e.meta;f=d.lastReadMessageSequence,l=d.chatroomId;return sr(t,{unreadCount:1,lastReadMessageSequence:f,chatroomId:l},[],{overrideRegardlessOfSequenceComparison:!0});case Object(Nt.c)(Dt.FETCH_ROOM_MESSAGES):return e.meta.isFetchMore?function(t,e){var r=e.payload.next?e.payload.next.before:null,n=e.meta.chatroomId;return vr(t,r,n)}(t,e):function(t,e){if(a(e.payload))return t;var r=e.payload.next?e.payload.next.before:null,n=e.meta.chatroomId,o=rr(e.payload.items),i=(t[n]||{}).cursor;return o||!(null!=i)?vr(t,r,n):mr(t,n)}(t,e);case Object(Nt.a)(Dt.FETCH_ROOM_MESSAGES):return e.payload.is401Error?t:(s=e.meta.chatroomId,Object(o.__assign)(Object(o.__assign)({},t),((r={})[s]=Object(o.__assign)(Object(o.__assign)({},t[s]),{error:e.payload}),r)));case Object(Nt.a)(Dt.SEND_MESSAGE):return s=e.meta.message.chatroomId,Object(o.__assign)(Object(o.__assign)({},t),((n={})[s]=Object(o.__assign)(Object(o.__assign)({},t[s]),{messageDeliveryError:!0}),n));case Object(Nt.c)(Dt.SEND_MESSAGE):return s=e.meta.message.chatroomId,Object(o.__assign)(Object(o.__assign)({},t),((i={})[s]=Object(o.__assign)(Object(o.__assign)({},t[s]),{messageDeliveryError:void 0}),i));case Object(Nt.c)(Dt.SET_UNSEEN_CHATROOMS):return e.payload.reduce((function(e,r){var n=r.chatroomId,o=r.lastSeenMessageSequence,i=t[n];return i?sr(e,{chatroomId:n,lastSeenMessageSequence:Math.max(o,i.lastSeenMessageSequence||0)}):e}),t);case Object(Nt.b)(Dt.MARK_CHATROOMS_SEEN):return e.meta.filteredChatrooms.reduce((function(t,e){return function(t,e){var r=c(t[e],"lastMessage.sequence");return sr(t,{chatroomId:e,lastSeenMessageSequence:r})}(t,e.id)}),t);default:return t}}}),Ir=function(t){var e,r=function(t){t.participantIds&&t.participantIds.sort();return t}(function(t){if(void 0===c(t,"isArchived"))return Object(o.__assign)(Object(o.__assign)({},t),{isArchived:!1});return t}(t)),n=(e=r,Object.keys(e).sort().map((function(t){return[t,e[t]]})));return JSON.stringify(n)};var Cr={},Tr={byId:{}};var Rr={},jr=function(t,e,r){var n=Object(o.__assign)({},t);return n[e]=r,n},wr=wt({byId:function(t,e){switch(void 0===t&&(t=Rr),e.type){case Dt.TYPING:return jr(t,e.meta.chatroomId,e.text);case Object(Nt.c)(Dt.FETCH_MESSAGE_DRAFTS):return Object(o.__assign)(Object(o.__assign)({},e.payload),t);default:return t}},isFetching:function(t,e){switch(void 0===t&&(t=!1),e.type){case Object(Nt.b)(Dt.FETCH_MESSAGE_DRAFTS):return!0;case Object(Nt.c)(Dt.FETCH_MESSAGE_DRAFTS):case Object(Nt.a)(Dt.FETCH_MESSAGE_DRAFTS):return!1;default:return t}}}),Mr={};var xr=function(t,e,r){if(a(e.payload))return t;var n=e.payload.items,i=!e.meta.fromStorage?{transit:{sendStatus:W.MessageSendStatus.SENT}}:{},s=Object(K.d)(n,"id",i),c=!r&&Object.keys(s).length&&rr(n);return Object(o.__assign)(Object(o.__assign)({},Pr(t,e.meta.chatroomId,c)),s)},Pr=function(t,e,r){return r?Dr(t,e):t},Dr=function(t,e){return Object.values(t).reduce((function(t,r){return r.chatroomId!==e&&(t[r.id]=r),t}),[])},Nr=function(t,e){return Hr(t,e)},Ur=function(t,e){var r={sendStatus:W.MessageSendStatus.SENT},n=Fr(t,e,r);return Hr(t,e,{transit:n})},kr=function(t,e){var r={sendStatus:W.MessageSendStatus.SENDING},n=Fr(t,e,r);return Hr(t,e,{transit:n})},Lr=function(t,e){var r={sendStatus:W.MessageSendStatus.FAILED},n=Fr(t,e,r);return Hr(t,e,{transit:n})},Fr=function(t,e,r){var n=e?e.transit:{},i=e&&t[e.id]?t[e.id].transit:{};return Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},i),n),r)},Hr=function(t,e,r){void 0===r&&(r={});var n=Object(o.__assign)({},t),i=n[e.id]||{};return n[e.id]=Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},i),e),r),n},Gr=function(t,e){var r=Object(o.__assign)({},t);return delete r[e],r},qr=function(t,e){if(!e)return t;var r=e.chatrooms.items.reduce((function(t,e){return Object.assign(t,Object(K.d)(e.lastMessages||[],"id",{transit:{sendStatus:W.MessageSendStatus.SENT}}))}),{});return Object(o.__assign)(Object(o.__assign)({},t),r)};function zr(t,e){var r={};return Object.keys(t).forEach((function(n){t[n].chatroomId!==e&&(r[n]=t[n])})),r}var $r=wt({byId:function(t,e){switch(void 0===t&&(t=Mr),e.type){case Object(Nt.c)(Dt.FETCH_ROOM_MESSAGES):return xr(t,e,e.meta.isFetchMore);case Dt.ADD_MESSAGE:return Nr(t,e.message);case Object(Nt.c)(Dt.SEND_MESSAGE):return Ur(t,e.meta.message);case Object(Nt.b)(Dt.SEND_MESSAGE):return kr(t,e.meta.message);case Object(Nt.a)(Dt.SEND_MESSAGE):return Lr(t,e.meta.message);case Dt.DELETE_MESSAGE:return Gr(t,e.meta.messageId);case Object(Nt.c)(Dt.DELETE_ROOM):return zr(t,e.meta.chatroomId);case Object(Nt.c)(Dt.DELETE_ROOMS):return function(t,e){var r=Object(o.__assign)({},t);return e.meta.chatroomIds.forEach((function(t){r=zr(r,t)})),r}(t,e);case Object(Nt.c)(Dt.FETCH_ROOMS):return qr(t,e.payload);default:return t}}}),Br={},Vr=function(t,e){var r;return Object(o.__assign)(Object(o.__assign)({},t),((r={})[e.id]=e,r))},Kr=function(t,e){return e.items.reduce(Vr,t)},Yr=wt({byId:function(t,e){switch(void 0===t&&(t=Br),e.type){case Object(Nt.c)(Dt.FETCH_ENRICHED_ROOM):return Kr(t,e.payload.participants);case Object(Nt.c)(Dt.FETCH_PARTICIPANTS_DISPLAY_DATA):return Kr(t,e.payload);default:return t}}}),Qr=r(126),Wr=r(585),Jr={},Xr=function(t,e,r){return E(t,(function(t,n){var i,s=function(t,e,r){return E(t.indications,(function(n,i){var a,s=e[r]?e[r][t.participantId]:{};return en(i,s)?n:Object(o.__assign)(Object(o.__assign)({},n),((a={})[rn(i)]=i,a))}),{})}(n,e,r);return a(s)?t:Qr({},t,((i={})[n.participantId]=s,i))}),{})},Zr=function(t,e,r){return E(t,(function(t,n){var o,i=function(t,e,r){var n,o=e[r]?e[r][t.participantId]:{},i=t.indication;return en(i,o)?{}:((n={})[rn(i)]=i,n)}(n,e,r);return a(i)?t:Qr({},t,((o={})[n.participantId]=i,o))}),{})},tn=function(t,e,r,n){return E(t,(function(t,i){var a,s,c,u=n[i]?n[i][e]:{};return en(r,u)?{}:Qr({},t,((a={})[i]=Object(o.__assign)(Object(o.__assign)({},n[i]),((s={})[e]=((c={})[rn(r)]=r,c),s)),a))}),{})},en=function(t,e){return void 0!==e&&!!e[rn(t)]},rn=function(t){return t.event+"-"+t.method},nn=wt({byId:function(t,e){switch(void 0===t&&(t=Jr),e.type){case Object(Nt.c)(Dt.FETCH_ENRICHED_ROOM):return a(e.payload.indications.lastMessageIndications)?t:function(t,e,r){var n,i=Zr(e.lastMessageIndications,t,r);return a(i)?t:Object(o.__assign)(Object(o.__assign)({},t),((n={})[r]=Qr({},t[r],i),n))}(t,e.payload.indications,Wr(e.payload.chatroom.lastMessages).id);case Object(Nt.c)(Dt.FETCH_DRILL_IN_MESSAGE_INDICATIONS):return a(e.payload.indications)?t:function(t,e){var r,n=e.messageId,i=Xr(e.indications,t,n);return a(i)?t:Object(o.__assign)(Object(o.__assign)({},t),((r={})[n]=Qr({},t[n],i),r))}(t,e.payload);case Dt.UPDATE_MESSAGES_INDICATIONS:return a(e.payload.messageIds)?t:function(t,e){var r=tn(e.messageIds,e.participantId,e.indication,t);return a(r)?t:Qr({},t,r)}(t,e.payload);default:return t}}}),on=r(249),an=r(586),sn=r(587);var cn,un,hn,fn=wt({participantsById:function(t,e){var r;if(void 0===t&&(t={}),e.type===Dt.UPDATE_PRESENCE){var n=e.meta.data,i=function(t,e,r){return r===on.PresenceStatus.ONLINE?t.indexOf(e)<0?Object(o.__spreadArrays)(t,[e]):t:an(t,(function(t){return t!==e}))}(t[n.userId]?t[n.userId].onlineSessions:[],n.sessionId,n.status);return Object(o.__assign)(Object(o.__assign)({},t),((r={})[n.userId]={onlineSessions:i,online:i.length>0,groupId:n.group,data:n.data,clientSideReceivedAtTimestamp:(new Date).getTime()},r))}if(e.type===Dt.PRESENCE_CLEAR_STALE){var a=(new Date).getTime();return sn(t,(function(t){return a-t.clientSideReceivedAtTimestamp>3e4}))}return t}}),ln=wt({chatrooms:Ar,chatroomsPresence:function(t,e){switch(void 0===t&&(t=Tr),e.type){case Dt.SET_PARTICIPANTS_PRESENCE:if(!O(t.byId,e.chatroomsParticipants))return{byId:Object(o.__assign)({},e.chatroomsParticipants)};break;case Dt.UPDATE_PARTICIPANTS_PRESENCE:var r=Object.keys(e.chatroomsParticipants).reduce((function(r,n){var i;return Object(o.__assign)(Object(o.__assign)(Object(o.__assign)({},t.byId),r),((i={})[n]=Object(o.__assign)(Object(o.__assign)({},t.byId[n]),e.chatroomsParticipants[n]),i))}),{});return{byId:Object(o.__assign)(Object(o.__assign)({},t.byId),r)}}return t},chatroomsLists:function(t,e){var r;void 0===t&&(t=Cr);var n=e.payload;if(a(n))return t;switch(e.type){case Object(Nt.c)(Dt.FETCH_ROOMS):var i=n.chatrooms,s=i.next?i.next.before:null,u=Ir(e.meta.filter);return a(c(t[u],"cursor"))||e.meta.isFetchMore?Object(o.__assign)(Object(o.__assign)({},t),((r={})[u]={cursor:s},r)):t;default:return t}},messages:$r,messageDraft:wr,globalUnreadsCount:(cn=new Xe(it),function(t,e){return void 0===t&&(t=Ze),cn.reduce(t,e)}),participants:Yr,messagesIndications:nn,unseenChatroomCount:zt,presence:fn}),pn=function(t,e){return e.type===Dt.RESET_STORE?ln(void 0,e):ln(t,e)},dn=r(581),vn=r.n(dn),mn=r(582),gn=r(583),yn=r(584);!function(t){t[t.Hyderated=1]="Hyderated",t[t.OriginalActionResolved=2]="OriginalActionResolved"}(un||(un={}));var _n=function(t,e){console.warn("Error while state to db '"+e+"': "+t),l.e(l.a.BI_ERROR,{tag:"db-storage",description:e,errorName:t})},bn=function(t){var e=t.hydrationKey&&hn.get(t.hydrationKey);return e===un.Hyderated||e===un.OriginalActionResolved},On=function(t){return(t.hydrationKey&&hn.get(t.hydrationKey))===un.OriginalActionResolved},En=function(t){hn.set(t.hydrationKey,un.Hyderated)},Sn=function(t){hn.set(t.hydrationKey,un.OriginalActionResolved)},An=function(t,e){if(null==t?void 0:t.dbPayload){var r=gn(t);r.payload=(n=t.dbPayload,Object(o.__awaiter)(void 0,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return[2,n.load().then((function(t){return On(n)?void 0:t})).catch((function(t){_n(t,"loading from db")}))]}))}))),yn(r,"meta.fromStorage",!0),e(r)}var n},In=function(t,e){return e.save(t).catch((function(t){return _n(t,"saving to db")})),t},Cn=function(){return hn=new Map,function(){return function(t){return function(e){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){return!e.dbPayload||bn(e.dbPayload)?[2,t(e)]:(An(e,t),En(e.dbPayload),[2,t(e).then((function(t){return Sn(e.dbPayload),In(t,e.dbPayload)}))])}))}))}}}},Tn=function(t,e,r,n){void 0===n&&(n=[]);var i=Object(o.__spreadArrays)([mn.a,vn.a],n);return r&&i.unshift(Cn()),Rt(t,e,("object"==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({name:"chat-sdk"}):Mt)(Pt.apply(void 0,i)))},Rn=function(t){var e=void 0===t?{}:t,r=e.initialState,n=e.shouldUseDBStorage;return Tn(pn,r,n)},jn=r(438);var wn=function(){function t(t){var e=t.store,r=t.chatroomsActions,n=t.subscriptionService,o=t.serverApi;this.store=e,this.chatroomsActions=r,this.subscriptionService=n,this.serverApi=o}return t.prototype.subscribeToChatRoomsList=function(t){var e,r,n=t.callback,o=t.filter,i=void 0===o?{}:o,a=this.store,s=ee(i),u=this._registerSubscriptionV2(i),h=function(){var t=a.getState(),o=s(t),u=t.chatrooms.status,h=function(t,e){return t.chatroomsLists[e]}(t,Ir(i)),f=c(h,"cursor");if(o!==e||u!==r){e=o,r=u;try{n({rooms:o,status:u,cursor:f})}catch(t){console.error("Error in subscribe callback",t)}}},f=a.subscribe((function(){return h()}));return h(),this._activeSubscription(f,u,i)},t.prototype._registerSubscriptionV2=function(t){var e=this;return this.subscriptionService.registerSubscription(t,(function(){return e.fetchRooms({isSilent:!0,filter:t})}),(function(){return e.fetchRooms({isSilent:!1,filter:t})}))},t.prototype._activeSubscription=function(t,e,r){var n=this;return{unsubscribe:function(){t(),e()},fetchMore:function(t){n.fetchRooms({cursor:t,filter:r})}}},t.prototype.deleteChatroom=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,[2,r.dispatch(n.action$deleteRoom(t))]}))}))},t.prototype.archiveChatroom=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,[2,r.dispatch(n.archiveRoom(t))]}))}))},t.prototype.unarchiveChatroom=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,[2,r.dispatch(n.unarchiveRoom(t))]}))}))},t.prototype.setParticipantsPresence=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,this.isPresenceWatchFT()&&console.warn("setParticipantsPresence is deprecated. Please use subscribeToPresenceChanges"),[2,r.dispatch(n.setParticipantsPresence(t))]}))}))},t.prototype.updateParticipantsPresence=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,this.isPresenceWatchFT()&&console.warn("updateParticipantsPresence is deprecated. Please use subscribeToPresenceChanges"),[2,r.dispatch(n.updateParticipantsPresence(t))]}))}))},t.prototype.isPresenceWatchFT=function(){return io.isExperimentOn(W.experiments.PresenceWatch)},t.prototype.fetchRooms=function(t){var e=t.filter,r=void 0===e?{}:e,n=t.cursor,i=void 0===n?void 0:n,a=t.isSilent,s=void 0!==a&&a;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e,n;return Object(o.__generator)(this,(function(o){return e=(t=this).store,n=t.chatroomsActions,[2,e.dispatch(n.fetchRooms({filter:r,cursor:i,isSilent:s}))]}))}))},t.prototype.addRooms=function(t){var e=t.rooms,r=this.store,n=this.chatroomsActions;return r.dispatch(n.addRooms(e))},t.prototype.getUnreadCountForRoom=function(t){var e=q(this.store.getState(),t);return new z.a(e).count},t.prototype.getUnreadCountForRooms=function(t){var e=this;return t.reduce((function(t,r){return t[r]=e.getUnreadCountForRoom(r),t}),{})},t.prototype.fetchMessageDrafts=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,e,r;return Object(o.__generator)(this,(function(n){return e=(t=this).store,r=t.chatroomsActions,e.dispatch(r.fetchMessageDrafts()),[2]}))}))},t.prototype.markAllRoomsAsRead=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n,i;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return r=(e=this).store,n=e.chatroomsActions,[4,e.serverApi.http$markAllRoomsAsRead(t)];case 1:return i=o.sent(),[4,r.dispatch(n.fetchRooms({filter:t}))];case 2:return o.sent(),[2,i]}}))}))},t.prototype.deleteChatrooms=function(t){var e=this.store,r=this.chatroomsActions;return e.dispatch(r.action$deleteRooms(t))},t.prototype.archiveChatrooms=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,[2,r.dispatch(n.archiveRooms(t))]}))}))},t.prototype.unarchiveChatrooms=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n;return Object(o.__generator)(this,(function(o){return r=(e=this).store,n=e.chatroomsActions,[2,r.dispatch(n.unarchiveRooms(t))]}))}))},t.prototype.search=function(t){var e=t.searchTerm,r=t.participantIds,n=t.chatroomsPageSize,s=t.chatroomsNextPointer,c=t.messagesPageSize,u=t.messagesNextPointer;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,h,f,l,p=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.serverApi.http$search({searchTerm:e,participantIds:r,chatroomsPageSize:n,chatroomsNextPointer:s,messagesPageSize:c,messagesNextPointer:u})];case 1:return t=o.sent(),h=function(t){var e=t.chatroomsPage.chatrooms,r=t.messagesPage.messages.map((function(t){return t.chatroom})),n=e.concat(r);return jn(n,"id")}(t),this.addRooms({rooms:h}),f=[],t.chatroomsPage.chatrooms.forEach((function(t){var e=q(p.store.getState(),t.id);if(!a(e)){var r=new z.a(e);f.push(r)}})),l=[],t.messagesPage.messages.forEach((function(t){var e=q(p.store.getState(),t.chatroom.id);if(!a(e)){var r=new z.a(e),n=new i.a(t.message);l.push({chatroom:r,message:n})}})),[2,{chatroomsPage:{chatrooms:f,nextPointer:t.chatroomsPage.nextPage.nextPointer,total:t.chatroomsPage.nextPage.total},messagesPage:{messages:l,nextPointer:t.messagesPage.nextPage.nextPointer,total:t.messagesPage.nextPage.total}}]}}))}))},t}(),Mn=function(t,e){var r,n=G(t,e);return function(t,e){var o=t.getState(),i=n(o);i&&O(r,i)||(r=i,e(i))}},xn=function(){function t(t){var e=t.store,r=t.messagesActions,n=t.subscriptionService,o=t.drillInMessageIndications;this.store=e,this.messagesActions=r,this.subscriptionService=n,this.drillInMessageIndications=o}return t.prototype.subscribeToDrillInMessageIndications=function(t){var e=t.chatroomId,r=t.messageId,n=t.sequence,o=t.callback,i=this.store,s=this.messagesActions,c=Mn(e,r);c(i,o);var u=i.subscribe((function(){return c(i,o)})),h=this._createIndicationsDataFetcher(e,n);h();var f=this._registerIndicationsSubscription(e,n,h),p=function(t){var r=t.indications.map((function(t){return t.participantId})),n=Q(r);a(n)||i.dispatch(s.action$fetchRoomParticipantsDisplayData(e,n))};return l.c(l.b.FETCH_DRILL_IN_MESSAGE_INDICATIONS_COMPLETED,p),{unsubscribe:function(){u(),f(),l.f(l.b.FETCH_DRILL_IN_MESSAGE_INDICATIONS_COMPLETED,p)}}},t.prototype._registerIndicationsSubscription=function(t,e,r){var n={chatroomId:t,sequence:e};return this.subscriptionService.registerSubscription(n,r)},t.prototype._createIndicationsDataFetcher=function(t,e){var r=this;return function(){return Object(o.__awaiter)(r,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.store.dispatch(this.messagesActions.action$fetchDrillInMessageIndications(t,e))];case 1:return r.sent(),[2]}}))}))}},t}(),Pn=r(572),Dn=new(function(){function t(){}return t.prototype.action$updatePresence=function(t){return{type:Dt.UPDATE_PRESENCE,meta:{data:t}}},t.prototype.action$clearStalePresenceSessions=function(){return{type:Dt.PRESENCE_CLEAR_STALE}},t}()),Nn=function(t,e){var r;return null===(r=t[e])||void 0===r?void 0:r.name},Un=function(t){var e=t.store,r=t.chatroomsActions,n=t.chatroomId,o=t.dataForDebug;n||console.error("[Troubleshoot] refreshChatroom: "+JSON.stringify(o));var i=io.isExperimentOn(W.experiments.EnrichedChatroom);return e.dispatch(r.action$fetchRoom(n,i))},kn={},Ln=function(t){var e=t.store,r=t.chatroomsActions,n=t.chatroomId,o=t.isArchived,i=e.getState().chatrooms.byId;if(Nn(i,n))e.dispatch(o?r.action$handleRoomArchived(n):r.action$handleRoomUnarchived(n));else{var a=io.isExperimentOn(W.experiments.EnrichedChatroom);e.dispatch(r.action$fetchRoom(n,a))}};function Fn(t){var e=t.store,r=t.chatroomsActions,n=t.messagesActions,i=t.data,a=t.currentUser;switch(i.type){case er.a.MESSAGE_SENT:return function(t){var e=t.store,r=t.chatroomsActions,n=t.data,i=t.currentUser;return Object(o.__awaiter)(void 0,void 0,void 0,(function(){var t,a,s,c,u,h,f,l,p,d,v;return Object(o.__generator)(this,(function(m){switch(m.label){case 0:return t=n.chatroomId,a=n.message,s=n.connectionEstablishedTimestamp,c=n.timestamp,u=e.getState().chatrooms,h=u.byId,Nn(h,t)?[3,2]:(t||console.error("[Troubleshoot] onAddRealtimeMessage calling fetchRoom w/o chatroomId"+JSON.stringify(n)),f=io.isExperimentOn(W.experiments.EnrichedChatroom),l=e.dispatch(r.action$fetchRoom(t,f)),io.isExperimentOn(W.experiments.UnseenChatroomCount)?[4,l]:[3,2]);case 1:m.sent(),m.label=2;case 2:return h=e.getState().chatrooms.byId,p=i.userId===a.sender.userId,d=Object(o.__assign)(Object(o.__assign)({},a),{transit:Object(o.__assign)(Object(o.__assign)({},a.transit),{sendStatus:W.MessageSendStatus.SENT})}),e.dispatch(r.action$addMessage(d,p,h[t])),v=c+W.HistorySinceRealtimeConnectionWasEstablished>=s,!p&&v&&Hn(a),[2]}}))}))}({store:e,chatroomsActions:r,data:i,currentUser:a});case er.a.CHATROOM_DELETED:return function(t){var e=t.store,r=t.chatroomsActions,n=t.data;return e.dispatch(r.action$removeRoom(n.chatroomId))}({store:e,chatroomsActions:r,data:i});case er.a.CHATROOOM_DISPLAY_DATA_UPDATED:return function(t){var e=t.store,r=t.chatroomsActions,n=t.data;return n.chatroomIds.forEach((function(t){return Un({store:e,chatroomsActions:r,chatroomId:t,dataForDebug:n})}))}({store:e,chatroomsActions:r,data:i});case er.a.CHATROOM_CREATED:return Un({store:e,chatroomsActions:r,chatroomId:i.chatroomId,dataForDebug:i});case er.a.TYPING_STARTED:!function(t){var e=t.data,r=t.store,n=t.chatroomsActions,o=e.userId,i=e.chatroomId,a=e.expiryDuration;if(a){var s=o+"|"+i;kn[s]&&clearTimeout(kn[s]),kn[s]=setTimeout((function(){r.dispatch(n.action$changeTypingStatus({chatroomId:i,userId:o,type:er.a.TYPING_STOPPED}))}),a)}}({store:e,chatroomsActions:r,data:i});case er.a.TYPING_STOPPED:return function(t){var e=t.store,r=t.chatroomsActions,n=t.data,o=t.currentUser,i=n.chatroomId,a=n.userId,s=n.type,c=n.displayData,u=n.timestamp;if(!(n.connectionEstablishedTimestamp>u)){var h=null;s===er.a.TYPING_STARTED&&c&&(h={imageUrl:c.content.image?c.content.image.url:void 0,initials:c.content.initials});var f=a===o.userId;e.dispatch(r.action$changeTypingStatus({chatroomId:i,userId:a,type:s,displayData:h,isCurrentUser:f}))}}({store:e,chatroomsActions:r,data:i,currentUser:a});case er.a.CHATROOM_ARCHIVED:return Ln({store:e,chatroomsActions:r,chatroomId:i.chatroomId,isArchived:!0});case er.a.CHATROOM_UNARCHIVED:return Ln({store:e,chatroomsActions:r,chatroomId:i.chatroomId,isArchived:!1});case er.a.CHATROOM_READ:return function(t){var e=t.store,r=t.chatroomsActions,n=t.chatroomId,o=t.userId;io.isExperimentOn(W.experiments.PublishReadToSelf)&&io.getUserId()===o&&e.dispatch(r.action$setMessagesReadForSelf(n))}({store:e,chatroomsActions:r,chatroomId:i.chatroomId,userId:i.userId});case er.a.MESSAGE_INDICATION_UPDATE:if(io.isExperimentOn(W.experiments.EnrichedChatroom))return function(t){var e=t.store,r=t.chatroomsActions,n=t.messagesActions,o=t.data;e.getState().participants.byId[o.participantId]||e.dispatch(r.action$fetchRoomParticipantsDisplayData(o.chatroomId,[o.participantId])),e.dispatch(n.action$updateMessagesIndications({chatroomId:o.chatroomId,messageIds:o.messageIds,participantId:o.participantId,indication:o.indication}))}({store:e,chatroomsActions:r,messagesActions:n,data:i});break;case er.a.PRESENCE_EVENT:return function(t,e){return t.dispatch(Dn.action$updatePresence(e))}(e,i);case er.a.EXTERNAL_HOST:l.e(l.a.EXTERNAL_HOST,i);break;default:return}}var Hn=function(t){l.e(l.a.NEW_REALTIME_MESSAGE,t)},Gn=r(577),qn=function(){function t(){this.queue=Promise.resolve(),this.setInitialState()}return t.prototype.setInitialState=function(){this.queue=Promise.resolve()},t.prototype.addToQueue=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(o.__generator)(this,(function(r){return this.queue=this.queue.then((function(){return Object(o.__awaiter)(e,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,t()];case 1:return[2,e.sent()]}}))}))})),[2,this.queue]}))}))},t.prototype.reset=function(){this.setInitialState()},t}(),zn=function(t,e){return Object(o.__awaiter)(void 0,void 0,void 0,(function(){var r;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t];case 1:return[2,n.sent()];case 2:return r=n.sent(),console.warn("Error while DB Storage "+e+": '"+r+"'"),l.e(l.a.BI_ERROR,{tag:"db-storage",description:e,errorName:r}),[3,3];case 3:return[2]}}))}))},$n=function(){function t(){}return Object.defineProperty(t.prototype,"_ormModelWrapper",{get:function(){return this.getDBModel()._ormModelWrapper},enumerable:!0,configurable:!0}),t.prototype.getSource=function(t){return this.constructor.name+"."+t},t.prototype.clear=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,zn(this.getDBModel().clear(),this.getSource("clear"))];case 1:return t.sent(),[2]}}))}))},t.prototype.delete=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,zn(this.getDBModel().delete(t),this.getSource("delete"))];case 1:return e.sent(),[2]}}))}))},t.prototype.loadAll=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,zn(this.getDBModel().loadAll(),this.getSource("loadAll"))];case 1:return[2,t.sent()]}}))}))},t.prototype.query=function(){return this.getDBModel().query()},t.prototype.rawQuery=function(t,e){return this.getDBModel().rawQuery(t,e)},t.prototype.serializeNonRelationalValues=function(t){return this.getDBModel().serializeNonRelationalValues(t)},t.prototype._typeormQuery=function(){return this.getDBModel()._typeormQuery()},t.prototype.splitToBatches=function(t){var e=Object.keys(this.getDBModel()._ormModelWrapper.columns).length;if(t.length*e>=999){for(var r=[],n=Math.floor(998/e),o=Math.floor(t.length/n)+1,i=0;i<o;i++){var a=i*n,s=a+n,c=t.slice(a,s);r.push(c)}return r}return[t]},t.prototype.save=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r=this;return Object(o.__generator)(this,(function(n){return e=this.splitToBatches(t),[2,zn(Promise.all(e.map((function(t){return r.saveBatch(t)}))),this.getSource("save"))]}))}))},t.prototype.saveBatch=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n,i,a;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e=this.getDBModel().serializeNonRelationalValues(t),r=this.getDBModel()._typeormQuery().insert().values(e).getQueryAndParameters(),n=r[0],i=r[1],a=n.replace(/INSERT/,"INSERT OR REPLACE"),[4,this.getDBModel().rawQuery(a,i)];case 1:return o.sent(),[2]}}))}))},t.prototype.update=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,zn(this.getDBModel().update(t),this.getSource("update"))];case 1:return e.sent(),[2]}}))}))},t}(),Bn=function(t){function e(e){var r=t.call(this)||this;return r.model=e.Storage.model("message",{id:{type:"varchar",primary:!0},chatroomId:{type:"varchar",nullable:!1},messageType:{type:"varchar",nullable:!0},messageTypeVersion:{type:"int",nullable:!0},sender:{type:"blob",nullable:!0},createdAt:{type:"int",nullable:!0},sequence:{type:"int",nullable:!0},pluginName:{type:"blob",nullable:!0},data:{type:"blob",nullable:!0},templateData:{type:"blob",nullable:!0},summary:{type:"varchar",nullable:!0},senderDisplayData:{type:"blob",nullable:!0},isEphemeral:{type:"boolean",nullable:!0},isSilent:{type:"boolean",nullable:!0},badges:{type:"blob",nullable:!0},distribution:{type:"blob",nullable:!0},transit:{type:"blob",nullable:!0}}),r}return Object(o.__extends)(e,t),e.prototype.getDBModel=function(){return this.model},e}($n),Vn=function(t){function e(e){var r=t.call(this)||this;return r.id={type:"varchar",primary:!0},r.isArchived={type:"boolean",nullable:!0},r.isTemporary={type:"boolean",nullable:!0},r.participantId={type:"varchar",nullable:!0},r.isPrivate={type:"boolean",nullable:!0},r.cursor={type:"int",nullable:!0},r.lastMessage={type:"blob",nullable:!0},r.lastMessages={type:"blob",nullable:!0},r.lastReadMessageSequence={type:"int",nullable:!0},r.lastSeenMessageSequence={type:"int",nullable:!0},r.unreadCount={type:"int",nullable:!0},r.offlineChannels={type:"blob",nullable:!0},r.displayData={type:"blob",nullable:!0},r.status={type:"blob",nullable:!0},r.name={type:"varchar",nullable:!0},r.initials={type:"varchar",nullable:!0},r.image={type:"blob",nullable:!0},r.sortRank={type:"int",nullable:!0},r.participantCount={type:"int",nullable:!0},r.clientReference={type:"varchar",nullable:!0},r.clientReferenceType={type:"varchar",nullable:!0},r.createdAt={type:"int",nullable:!0},r.createdBy={type:"varchar",nullable:!0},r.otherParticipantId={type:"varchar",nullable:!0},r.businessContext={type:"blob",nullable:!0},r.pluginName={type:"varchar",nullable:!0},r.siteUserType={type:"varchar",nullable:!0},r.enrichedChatroomLoaded={type:"boolean",nullable:!0},r.labelIds={type:"blob",nullable:!0},r.model=e.Storage.model("chatroom",{id:r.id,isArchived:r.isArchived,isTemporary:r.isTemporary,participantId:r.participantId,isPrivate:r.isPrivate,cursor:r.cursor,lastMessage:r.lastMessage,lastMessages:r.lastMessages,lastReadMessageSequence:r.lastReadMessageSequence,lastSeenMessageSequence:r.lastSeenMessageSequence,unreadCount:r.unreadCount,offlineChannels:r.offlineChannels,displayData:r.displayData,status:r.status,name:r.name,initials:r.initials,image:r.image,sortRank:r.sortRank,participantCount:r.participantCount,clientReference:r.clientReference,clientReferenceType:r.clientReferenceType,createdAt:r.createdAt,createdBy:r.createdBy,otherParticipantId:r.otherParticipantId,businessContext:r.businessContext,pluginName:r.pluginName,siteUserType:r.siteUserType,enrichedChatroomLoaded:r.enrichedChatroomLoaded,labelIds:r.labelIds}),r}return Object(o.__extends)(e,t),e.prototype.getDBModel=function(){return this.model},e}($n),Kn=function(){function t(t){this.previousState=void 0,this.initStore=this.initStore.bind(this),this.loadChatrooms=this.loadChatrooms.bind(this),this.saveChatrooms=this.saveChatrooms.bind(this),this.loadMessages=this.loadMessages.bind(this),this.saveMessages=this.saveMessages.bind(this),this.updateModel=this.updateModel.bind(this),this.updateChatroomsInDB=this.updateChatroomsInDB.bind(this),this.updateMessagesInDB=this.updateMessagesInDB.bind(this),this.clearAll=this.clearAll.bind(this),this.dbStorageEngine=t,this.asyncLock=new qn,this.initModel()}return t.prototype.initModel=function(){this.messageModel=new Bn(this.dbStorageEngine),this.chatroomModel=new Vn(this.dbStorageEngine),this.models=[this.messageModel.getDBModel(),this.chatroomModel.getDBModel()],this.dbStorageEngine.Storage.connect({models:this.models,version:1,shouldPurgeOnNewVersion:!0,shouldLog:!1}),this.stateListeners=[{onStateChange:this.updateChatroomsInDB,path:"chatrooms.byId"},{onStateChange:this.updateMessagesInDB,path:"messages.byId"}]},t.prototype.initStore=function(t){var e=this;t.subscribe((function(){return Object(o.__awaiter)(e,void 0,void 0,(function(){var e,r=this;return Object(o.__generator)(this,(function(n){return e=t.getState(),this.stateListeners.forEach((function(t){var n=c(e,t.path),o=c(r.previousState,t.path);O(n,o)||t.onStateChange(n,o)})),this.previousState=e,[2]}))}))}))},t.prototype.loadChatrooms=function(t){var e=this,r=t.filter,n=t.pageSize;return function(){return Object(o.__awaiter)(e,void 0,void 0,(function(){var t,e,i,a=this;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:return t=this.chatroomModel.query().orderBy("sortRank","DESC"),r&&void 0!==r.isArchived&&t.where({param:"isArchived",value:r.isArchived,operator:"="}),n&&n>0&&t.limit(n),[4,this.asyncLock.addToQueue((function(){return Object(o.__awaiter)(a,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,t.fetch()];case 1:return[2,e.sent()]}}))}))}))];case 1:return e=s.sent(),i=Object(K.a)(e),[2,{chatrooms:{items:i},unreadChatroomCount:0,unreadChatroomIds:[]}]}}))}))}},t.prototype.saveChatrooms=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n=this;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e=t.value.chatrooms.items,[4,this.asyncLock.addToQueue((function(){return n.chatroomModel.clear()}))];case 1:return o.sent(),e&&e.length>0?(r=Gn(e,(function(t,e){return t.id===e.id})),[4,this.asyncLock.addToQueue((function(){return n.chatroomModel.save(r)}))]):[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))},t.prototype.loadMessages=function(t){var e=this,r=t.chatroomId,n=t.pageSize;return function(){return Object(o.__awaiter)(e,void 0,void 0,(function(){var t,e;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return t=this.messageModel.query().orderBy("sequence","DESC"),r&&t.where({param:"chatroomId",value:r,operator:"="}),n&&n>0&&t.limit(n),[4,t.fetch()];case 1:return e=o.sent(),[2,{items:Object(K.a)(e)}]}}))}))}},t.prototype.saveMessages=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n,i,a=this;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:return(e=t.value.items)&&0!==e.length?(r=e[0].chatroomId,[4,this.asyncLock.addToQueue((function(){return Object(o.__awaiter)(a,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.messageModel.query().where({param:"chatroomId",value:r,operator:"="}).fetch()];case 1:return[2,t.sent()]}}))}))}))]):[2];case 1:return n=s.sent(),(i=Object(K.a)(n))&&i.length>0?[4,this.asyncLock.addToQueue((function(){return a.messageModel._typeormQuery().delete().whereInIds(i.map((function(t){return t.id}))).execute()}))]:[3,3];case 2:s.sent(),s.label=3;case 3:return e&&e.length>0?[4,this.asyncLock.addToQueue((function(){return a.messageModel.save(e)}))]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2]}}))}))},t.prototype.updateModel=function(t,e,r){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,i,a=this;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:return r&&r!=={}?(n=this.getDeleted(r,e)).length>0?[4,this.asyncLock.addToQueue((function(){return Object(o.__awaiter)(a,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:return[4,t._typeormQuery().delete().whereInIds(n.map((function(t){return t.id}))).execute()];case 1:return[2,e.sent()]}}))}))}))]:[3,2]:[2];case 1:s.sent(),s.label=2;case 2:return(i=Object(K.a)(e)).length>0?[4,this.asyncLock.addToQueue((function(){return t.save(i)}))]:[3,4];case 3:s.sent(),s.label=4;case 4:return[2]}}))}))},t.prototype.updateChatroomsInDB=function(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.updateModel(this.chatroomModel,t,e)];case 1:return r.sent(),[2]}}))}))},t.prototype.updateMessagesInDB=function(t,e){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.updateModel(this.messageModel,t,e)];case 1:return r.sent(),[2]}}))}))},t.prototype.getDeleted=function(t,e){var r=[];return t&&e&&Object.keys(t).forEach((function(n){e[n]||r.push(t[n])})),r},t.prototype.clearAll=function(){this.models&&this.models.forEach((function(t){return t.clear()}))},t}(),Yn=function(){function t(t){var e=t.store,r=t.actions;this.store=e,this.actions=r}return t.prototype.subscribe=function(t,e){var r,n=this,o=function(){var o=function(t,e){var r=c(t,["unseenChatroomCount","byFilter",Ut(e)]);return!r||a(r)?null:"resyncCountdown"in r?{count:it.maxUnreadsCount,overflow:!0}:{count:Math.min(it.maxUnreadsCount,Object.keys(r.chatrooms).length),overflow:Object.keys(r.chatrooms).length>it.maxUnreadsCount}}(n.store.getState(),e);o&&!O(r,o)&&(r=o,t(o))};return o(),this.store.dispatch(this.actions.updateUnseenChatrooms(e)),{unsubscribe:this.store.subscribe(o)}},t.prototype.markChatroomsAsSeen=function(t){return this.store.dispatch(this.actions.markChatroomsAsSeen(t))},t}(),Qn=function(t,e,r){return jn(e.chatrooms.filter((function(t){var e=t.chatroomId,n=r.chatrooms.byId[e];return!n||$t(n)})),ie(r,t),(function(t){return t.chatroomId}))},Wn=function(){function t(t){this.serverApi=t}return t.prototype.updateUnseenChatrooms=function(t){var e=this;return function(r,n){return r({type:Dt.SET_UNSEEN_CHATROOMS,payload:Object(o.__awaiter)(e,void 0,void 0,(function(){var e,r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return e=Qn,r=[t],[4,this.serverApi.http$fetchUnseenChatroomCount(t,it.maxTrackableUnreads+1)];case 1:return[2,e.apply(void 0,r.concat([o.sent(),n()]))]}}))})),meta:{filter:t}})}},t.prototype.markChatroomAsSeen=function(t){var e=this;return function(r,n){var o=n();return r({type:Dt.MARK_CHATROOM_SEEN,payload:t,meta:{chatroom:n().chatrooms.byId[t]}}),Promise.all(Object.keys(o.unseenChatroomCount.byFilter).filter((function(t){return function(t,e){return t&&e&&"resyncCountdown"in t&&"resyncCountdown"in e&&1===t.resyncCountdown&&0===e.resyncCountdown}(o.unseenChatroomCount.byFilter[t],n().unseenChatroomCount.byFilter[t])})).map((function(t){return r(e.updateUnseenChatrooms(kt(t)))})))}},t.prototype.markChatroomsAsSeen=function(t){var e=this;return function(r,n){return r({type:Dt.MARK_CHATROOMS_SEEN,payload:e.serverApi.http$markChatroomsAsSeen(t,ae(n())),meta:{filter:t,filteredChatrooms:Object.values(Z(n().chatrooms.byId,"participantId"in t?{participantIds:[t.participantId]}:{participantType:t.participantType}))}})}},t}(),Jn=r(443);var Xn=y([function(t){return t.presence.participantsById}],(function(t){var e={};return Jn(t,(function(t,r){t.online&&(e[t.groupId]=Object(o.__spreadArrays)(e[t.groupId]||[],[r]))})),e})),Zn=function(){function t(t,e,r){this.currentUser=t,this.serverApi=e,this.store=r}return t.prototype.watch=function(){return this.serverApi.http$watch()},t.prototype.subscribeToPresenceChanges=function(t){var e,r=this,n=t.callback,o=function(){var t=r.store.getState(),o=t.presence;if(o&&!O(e,o)){e=o;var i={participantsById:o.participantsById,participantsByGroupId:Xn(t)};n(i)}};return this.hasParticipants()&&o(),{unsubscribe:this.store.subscribe(o)}},t.prototype.set=function(t,e,r){var n={userId:this.currentUser.userId,sessionId:t,group:e,data:r,status:on.PresenceStatus.ONLINE};return this.serverApi.http$setPresence(n,this.currentUser.token)},t.prototype.hasParticipants=function(){return!a(this.store.getState().presence.participantsById)},t}(),to={reportMonitoringBi:function(){}};function eo(t){return io.isExperimentOn(W.experiments.NoHistoryOnRealtimeConnect)?t:t-W.HistorySinceRealtimeConnectionWasEstablished}var ro=function(){function t(){var t=this;this.unseenChatroom={subscribeToCount:function(e,r){return t._assertInitialized(),t.unseenChatroomCountApi.subscribe(e,r)},markChatroomsAsSeen:function(e){return t._assertInitialized(),t.unseenChatroomCountApi.markChatroomsAsSeen(e)}},this._initialized=!1,this._experiments={},this._onConnectCallbacks=[],this._onConnectingCallbacks=[],this._onConnectionEstablishedCallbacks=[],this._onDisconnectCallbacks=[],this._onInitCallbacks=[],this._connected=!1,this._currentUser=new je}return t.prototype.waitForInitialized=function(){var t=this;return new Promise((function(e){return function(e){return t._registerOnInit((function(){return e()}))}(e)}))},Object.defineProperty(t.prototype,"initialized",{get:function(){return this._initialized},enumerable:!0,configurable:!0}),t.prototype.initWithHandshake=function(t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,r,n,i,a;return Object(o.__generator)(this,(function(s){switch(s.label){case 0:if(e=t.tokenServer,r=t.handshakeServerUrl,n=e||(r?{url:r}:void 0),no(Object(o.__assign)(Object(o.__assign)({},t),{tokenServer:n})),this.clear(),!n)throw new Error("Trying to call init with handshake without passing the issue server url");return[4,qe(t.persistenceEngine)];case 1:return(i=s.sent())||!n?[3,3]:[4,Ge(n)];case 2:i=s.sent(),s.label=3;case 3:return a=io.init(Object.assign({},t,{chatToken:i})),i?[4,ze(i,t.persistenceEngine)]:[3,5];case 4:s.sent(),s.label=5;case 5:return[2,a]}}))}))},t.prototype.init=function(t){var e,r=this,i=t.chatServerUrl,a=t.chatToken,s=t.eventHooks,c=void 0===s?{}:s,u=t.experiments,h=void 0===u?{}:u,f=t.preFetch,p=void 0!==f&&f,d=t.appName,v=t.persistenceEngine,m=t.dbStorageEngine,g=t.httpHeaders,y=t.handshakeServerUrl,_=t.tokenServer,b=t.throttleThreshold,O=_||(y?{url:y}:void 0);no({chatServerUrl:i,chatToken:a,tokenServer:O}),this.clear(),this._currentUser.loadJwtChatToken(a),Ce.setAppName(d),this._currentUser.token=a,this._experiments=h,this._eventHooks=Object.assign(oo,c),this.realtimeClient=(e=new Pn(void 0,{atomicServerTime:this.isExperimentOn(W.experiments.FirebaseAtomicServerTime)}),{connect:function(t){var r=t.realtimeServiceSetup,n=t.onEvent,i=t.eventHooks,a=void 0===i?to:i;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,i,s,c,u,h,f,p,d,v;return Object(o.__generator)(this,(function(m){switch(m.label){case 0:if(t=function(){var t={tag:"realtime",description:"onConnect success"};return l.d.emit(l.a.MONITORING_BI,t),a.reportMonitoringBi(t)},i=function(t){var e={tag:"realtime",description:"onConnect failure "+t};return l.d.emit(l.a.MONITORING_BI,e),a.reportMonitoringBi(e)},s=r.options,c=r.authKey,!(u=r.eventsPath))throw h="chat-sdk.realtime.client: unexpected data received",console.error(h,r),new Error(h);f=function(t,e){var r=t.value;setTimeout((function(){try{var t=JSON.stringify(r);a.reportMonitoringBi({tag:"realtime",description:"RT Event: "+r.type,internal:t})}catch(t){console.error("Error parsing RT event value: "+r)}}),0),n(Object(o.__assign)(Object(o.__assign)({},r),{connectionEstablishedTimestamp:e}))},p=u.split("/").slice(0,-1).join("/")+"/timestamp",m.label=1;case 1:return m.trys.push([1,4,,5]),[4,e.connect(s,c)];case 2:return m.sent(),[4,e.getFirebaseServerTime(p)];case 3:return d=m.sent(),e.listenOnPath(u,{orderBy:"timestamp",startAt:eo(d)}).when("child_added").call((function(t){var e=t.value;return f({value:e},d)})),e.listenOnPath(u,{orderBy:"timestamp",startAt:eo(d)}).when("child_changed").call((function(t){var e=t.value;return f({value:e},d)})),t(),[3,5];case 4:throw v=m.sent(),i(v),v;case 5:return[2]}}))}))},disconnect:function(){e.disconnect()}});var E,S=new Le,A=this.isExperimentOn("specs.chat.ThrottleNetworkRequests")?b||W.DEFAULT_THROTTLE_THRESHOLD:0;E=new Be(O?{baseUrl:i,currentUser:this._currentUser,httpHeaders:g,tokenServer:O,throttleThreshold:A}:{baseUrl:i,currentUser:this._currentUser,httpHeaders:g,throttleThreshold:A}),this.serverApi=new Te(E),this.persistenceService=new Ne(v,this.getUserId(),this._currentUser.participantIds);var I=function(t){return new Se(t)}(it),C=function(t){return new Ae(t)}(it);this.unseenChatroomCountActions=new Wn(this.serverApi);var T=this.isExperimentOn(W.experiments.DBStorage);this.dbStorageService=T&&m?new Kn(m):void 0;var R=pe(this.serverApi,this.persistenceService,this._eventHooks,n,C,I,this.unseenChatroomCountActions,h,this.dbStorageService);this.unseenChatroomCountActions=new Wn(this.serverApi),this.store=this._setupStoreReuseIfNecessary(T,R),this.unseenChatroomCountApi=new Yn({store:this.store,actions:this.unseenChatroomCountActions});var j=new wn({store:this.store,chatroomsActions:R,subscriptionService:S,serverApi:this.serverApi}),w=new ce({store:this.store,chatroomsActions:R,subscriptionService:S,currentUser:this._currentUser,enrichedChatroom:this.isExperimentOn(W.experiments.EnrichedChatroom)});this.messagesActions=ve(this.serverApi);var M=new xn({store:this.store,messagesActions:this.messagesActions,subscriptionService:S,drillInMessageIndications:this.isExperimentOn(W.experiments.DrillInMessageIndications)}),x=function(t){var e=t.store,r=t.selector,n=t.chatroomsActions,o=t.globalUnreadsCountActions;return new ue({store:e,selector:r,chatroomsActions:n,globalUnreadsCountActions:o})}({store:this.store,selector:C,chatroomsActions:R,globalUnreadsCountActions:I}),P=new xe(this.store,R,this.serverApi,this.persistenceService);return this.presence=new Zn(this._currentUser,this.serverApi,this.store),Object.assign(this,{subscriptionService:S,chatroomsActions:R,chatroomsApi:j,chatroomApi:w,messagesApi:M,globalUnreadsCountApi:x,textTypingService:P}),p&&this._fetchRooms({isSilent:!1}),this.connectToRealtime({chatToken:a,eventHooks:this._eventHooks}),this.serverApi.http$fetchCurrentUserDisplayData().then((function(t){r._currentUser.displayData=t})),this._connected=!0,this._initialized=!0,this._onConnectCallbacks.forEach((function(t){return t()})),this.notifyOnInit(),j.fetchMessageDrafts(),this},t.prototype.clear=function(){this._initialized=!1,this._connected&&this.disconnect()},t.prototype.disconnect=function(){this._onDisconnectCallbacks.forEach((function(t){return t()})),this.realtimeClient.disconnect(),this._connected=!1},t.prototype.reconnect=function(t){var e=(void 0===t?{chatToken:void 0}:t).chatToken;if(this._assertInitialized(),!this._connected)return e&&(this._currentUser.token=e),this._onConnectCallbacks.forEach((function(t){return t()})),Promise.all([this.subscriptionService.refreshSubscribedData(),this.connectToRealtime({chatToken:e,eventHooks:this._eventHooks})])},t.prototype.reconnectWithHandshake=function(t){var e=t.handshakeServerUrl,r=t.tokenServer;return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:if(!r&&!e)throw new Error("Trying to reconnect chat-sdk without a `tokenServer`");return this._connected?[2]:[4,qe(this.persistenceService.persistenceEngine)];case 1:return t=n.sent(),[2,this.reconnect({chatToken:t})]}}))}))},t.prototype.onConnecting=function(t){this._onConnectingCallbacks.push(t)},t.prototype.onConnectionEstablished=function(t){this._onConnectionEstablishedCallbacks.push(t)},t.prototype.onDisconnect=function(t){this._onDisconnectCallbacks.push(t)},t.prototype.subscribeToChatRoomsList=function(t){var e=t.callback,r=t.filter;return this._assertInitialized(),this.chatroomsApi.subscribeToChatRoomsList({callback:e,filter:r})},t.prototype.subscribeToChatRoom=function(t){var e=t.chatroomId,r=t.onChange,n=t.onNewMessage,o=t.onInitialFetchDone,i=t.onError;return this._assertInitialized(),this.chatroomApi.subscribeToChatRoom({chatroomId:e,onChange:r,onNewMessage:n,onInitialFetchDone:o,onError:i})},t.prototype.subscribeToGlobalUnreadStatus=function(t){var e=t.callback,r=t.filter;if(this._assertInitialized(),this.globalUnreadsCountApi)return this.globalUnreadsCountApi.subscribeToGlobalUnreadsCount({callback:e,filter:r});throw new Error("Cannot subscribe to global unreads count: must init with prefetch")},t.prototype.subscribeToDrillInMessageIndications=function(t){var e=t.chatroomId,r=t.messageId,n=t.sequence,o=t.callback;if(this._assertInitialized(),this.isExperimentOn(W.experiments.DrillInMessageIndications))return this.messagesApi.subscribeToDrillInMessageIndications({chatroomId:e,messageId:r,sequence:n,callback:o})},t.prototype.getChatroom=function(t){var e=t.chatroomId;return this._assertInitialized(),this.chatroomApi.getChatroom({chatroomId:e})},t.prototype.getUnreadCountForRoom=function(t){return this.chatroomsApi.getUnreadCountForRoom(t)},t.prototype.getUnreadCountForRooms=function(t){return this.chatroomsApi.getUnreadCountForRooms(t)},t.prototype.fetchRooms=function(t){var e=t.filter,r=t.cursor,n=t.isSilent,o=void 0!==n&&n;return this._assertInitialized(),this._fetchRooms({filter:e,cursor:r,isSilent:o})},t.prototype.sendMessage=function(t){return this._assertInitialized(),this.chatroomApi.sendMessage(t)},t.prototype.addMessage=function(t){var e=t.dto,r=t.transit;return this._assertInitialized(),this.chatroomApi.addMessage({dto:e,transit:r})},t.prototype.addChatrooms=function(t){var e=t.rooms;return this._assertInitialized(),this.chatroomsApi.addRooms({rooms:e})},t.prototype.deleteMessage=function(t){return this._assertInitialized(),this.chatroomApi.deleteMessage(t)},t.prototype.notifyTyping=function(t,e){return this._assertInitialized(),this.textTypingService.notifyTyping(t,e)},t.prototype.notifyTypingTextChange=function(t,e,r){return void 0===r&&(r=!0),this._assertInitialized(),this.textTypingService.notifyTextChange(t,e,r)},t.prototype.deleteChatroom=function(t){return this._assertInitialized(),this.chatroomsApi.deleteChatroom(t)},t.prototype.deleteChatrooms=function(t){return this._assertInitialized(),this.chatroomsApi.deleteChatrooms(t)},t.prototype.archiveChatroom=function(t){return this._assertInitialized(),this.chatroomsApi.archiveChatroom(t)},t.prototype.archiveChatrooms=function(t){return this._assertInitialized(),this.chatroomsApi.archiveChatrooms(t)},t.prototype.unarchiveChatrooms=function(t){return this._assertInitialized(),this.chatroomsApi.unarchiveChatrooms(t)},t.prototype.unarchiveChatroom=function(t){return this._assertInitialized(),this.chatroomsApi.unarchiveChatroom(t)},t.prototype.setParticipantsPresence=function(t){return this._assertInitialized(),this.chatroomsApi.setParticipantsPresence(t)},t.prototype.updateParticipantsPresence=function(t){return this._assertInitialized(),this.chatroomsApi.updateParticipantsPresence(t)},t.prototype.setLastMessageUnread=function(t){var e=t.chatroomId;return this._assertInitialized(),this.chatroomApi.setLastMessageUnread({chatroomId:e})},t.prototype.isExperimentOn=function(t){return fe(this._experiments,t)},t.prototype.getUserId=function(){return this._currentUser.userId},t.prototype.clearPersistence=function(){this.persistenceService&&this.persistenceService.clearMessageDrafts(),this.dbStorageService&&this.dbStorageService.clearAll()},t.prototype.setAllRoomsAsRead=function(t){return this.chatroomsApi.markAllRoomsAsRead(t)},t.prototype.setMessagesRead=function(t){var e=t.chatroomId;return this._assertInitialized(),this.chatroomApi.setMessagesRead({chatroomId:e})},t.prototype.setRoomsMessagesRead=function(t){return this.chatroomApi.setRoomsMessagesRead(t)},t.prototype.search=function(t){var e=t.searchTerm,r=t.participantIds,n=t.chatroomsPageSize,i=void 0===n?10:n,a=t.chatroomsNextPointer,s=void 0===a?0:a,c=t.messagesPageSize,u=void 0===c?10:c,h=t.messagesNextPointer,f=void 0===h?0:h;return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){return[2,this.chatroomsApi.search({searchTerm:e,participantIds:r,chatroomsPageSize:i,chatroomsNextPointer:s,messagesPageSize:u,messagesNextPointer:f})]}))}))},t.prototype.getMessagesPage=function(t){var e=t.chatroomId,r=t.messageSequence,n=t.pageSize;return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.serverApi.http$fetchRoomMessagesPage({chatroomId:e,messageSequence:r,pageSize:n})];case 1:return[2,t.sent().reverse().map((function(t){return new i.a(t)}))]}}))}))},t.prototype.notifyOnInit=function(){this._onInitCallbacks.forEach((function(t){return t()}))},t.prototype._registerOnInit=function(t){this._initialized?t():this._onInitCallbacks.push(t)},t.prototype.connectToRealtime=function(t){var e=this,r=t.chatToken,n=t.eventHooks;return this.isExperimentOn(W.experiments.PresenceWatch)&&this.presence.watch(),this.isExperimentOn(W.experiments.ClearStaleSessions)&&this.store.dispatch(Dn.action$clearStalePresenceSessions()),this._onConnectingCallbacks.forEach((function(t){return t()})),this.serverApi.http$initRealtimeToken(r).then((function(t){return e.realtimeClient.connect({realtimeServiceSetup:t,onEvent:function(t){return Fn({store:e.store,chatroomsActions:e.chatroomsActions,messagesActions:e.messagesActions,data:t,currentUser:e._currentUser})},eventHooks:n})})).then((function(){return e._onConnectionEstablishedCallbacks.forEach((function(t){return t()}))}))},t.prototype._fetchRooms=function(t){var e=t.filter,r=void 0===e?void 0:e,n=t.cursor,o=void 0===n?void 0:n,i=t.isSilent,a=void 0!==i&&i;return this.chatroomsApi.fetchRooms({filter:r,cursor:o,isSilent:a})},t.prototype._assertInitialized=function(){if(!this.initialized)throw new Error("Trying to call chat-sdk without having it initialized")},t.prototype._setupStoreReuseIfNecessary=function(t,e){if(this.existingStore){var r=this.existingStore;return r.dispatch(e.action$resetStore()),r}return t&&this.dbStorageService?(this.existingStore=Rn({shouldUseDBStorage:t}),this.dbStorageService.initStore(this.existingStore)):this.existingStore=Rn(),this.existingStore},t}();function no(t){var e=t.chatServerUrl,r=t.chatToken,n=t.tokenServer;if(!r&&!n)throw new Error("Trying to initialize chat-sdk without chatToken or handshakeServerUrl");if(!e)throw new Error("Trying to initialize chat-sdk without chatServerUrl")}var oo={reportMonitoringBi:function(){return null}},io="object"==typeof window?(window.chatSdk||(window.chatSdk=new ro),window.chatSdk):new ro},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(152),o=r(473);t.exports=function t(e,r,i,a,s){var c=-1,u=e.length;for(i||(i=o),s||(s=[]);++c<u;){var h=e[c];r>0&&i(h)?r>1?t(h,r-1,i,a,s):n(s,h):a||(s[s.length]=h)}return s}},,,,function(t,e,r){var n=r(214)(Object.getPrototypeOf,Object);t.exports=n},function(t,e,r){var n=r(215);t.exports=function(t){var e=new t.constructor(t.byteLength);return new n(e).set(new n(t)),e}},,,,,,,,,function(t,e,r){var n=r(160),o=r(178),i=r(79);t.exports=function(t,e){var r={};return e=i(e,3),o(t,(function(t,o,i){n(r,o,e(t,o,i))})),r}},,,,,,,,function(t,e,r){var n=r(131),o=r(440),i=r(441),a=r(92),s=r(108),c=r(496),u=r(497),h=r(251),f=u((function(t,e){var r={};if(null==t)return r;var u=!1;e=n(e,(function(e){return e=a(e,t),u||(u=e.length>1),e})),s(t,h(t),r),u&&(r=o(r,7,c));for(var f=e.length;f--;)i(r,e[f]);return r}));t.exports=f},function(t,e,r){var n=r(205);t.exports=function(t){return(null==t?0:t.length)?n(t,1):[]}},,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(164),o=r(270),i=r(271);t.exports=function(t,e){return i(o(t,e,n),t+"")}},function(t,e,r){var n=r(80),o=r(45);t.exports=function(t){return o(t)&&n(t)}},function(t,e,r){"use strict";(function(e){t.exports=g;var n,o=r(634),i=r(636),a=r(639),s=(n="function"==typeof Symbol&&"1"!==e.env._nodeLRUCacheForceNoSymbol?function(t){return Symbol(t)}:function(t){return"_"+t})("max"),c=n("length"),u=n("lengthCalculator"),h=n("allowStale"),f=n("maxAge"),l=n("dispose"),p=n("noDisposeOnSet"),d=n("lruList"),v=n("cache");function m(){return 1}function g(t){if(!(this instanceof g))return new g(t);"number"==typeof t&&(t={max:t}),t||(t={});var e=this[s]=t.max;(!e||"number"!=typeof e||e<=0)&&(this[s]=1/0);var r=t.length||m;"function"!=typeof r&&(r=m),this[u]=r,this[h]=t.stale||!1,this[f]=t.maxAge||0,this[l]=t.dispose,this[p]=t.noDisposeOnSet||!1,this.reset()}function y(t,e,r,n){var o=r.value;b(t,o)&&(E(t,r),t[h]||(o=void 0)),o&&e.call(n,o.value,o.key,t)}function _(t,e,r){var n=t[v].get(e);if(n){var o=n.value;b(t,o)?(E(t,n),t[h]||(o=void 0)):r&&t[d].unshiftNode(n),o&&(o=o.value)}return o}function b(t,e){if(!e||!e.maxAge&&!t[f])return!1;var r=Date.now()-e.now;return e.maxAge?r>e.maxAge:t[f]&&r>t[f]}function O(t){if(t[c]>t[s])for(var e=t[d].tail;t[c]>t[s]&&null!==e;){var r=e.prev;E(t,e),e=r}}function E(t,e){if(e){var r=e.value;t[l]&&t[l](r.key,r.value),t[c]-=r.length,t[v].delete(r.key),t[d].removeNode(e)}}function S(t,e,r,n,o){this.key=t,this.value=e,this.length=r,this.now=n,this.maxAge=o||0}Object.defineProperty(g.prototype,"max",{set:function(t){(!t||"number"!=typeof t||t<=0)&&(t=1/0),this[s]=t,O(this)},get:function(){return this[s]},enumerable:!0}),Object.defineProperty(g.prototype,"allowStale",{set:function(t){this[h]=!!t},get:function(){return this[h]},enumerable:!0}),Object.defineProperty(g.prototype,"maxAge",{set:function(t){(!t||"number"!=typeof t||t<0)&&(t=0),this[f]=t,O(this)},get:function(){return this[f]},enumerable:!0}),Object.defineProperty(g.prototype,"lengthCalculator",{set:function(t){"function"!=typeof t&&(t=m),t!==this[u]&&(this[u]=t,this[c]=0,this[d].forEach((function(t){t.length=this[u](t.value,t.key),this[c]+=t.length}),this)),O(this)},get:function(){return this[u]},enumerable:!0}),Object.defineProperty(g.prototype,"length",{get:function(){return this[c]},enumerable:!0}),Object.defineProperty(g.prototype,"itemCount",{get:function(){return this[d].length},enumerable:!0}),g.prototype.rforEach=function(t,e){e=e||this;for(var r=this[d].tail;null!==r;){var n=r.prev;y(this,t,r,e),r=n}},g.prototype.forEach=function(t,e){e=e||this;for(var r=this[d].head;null!==r;){var n=r.next;y(this,t,r,e),r=n}},g.prototype.keys=function(){return this[d].toArray().map((function(t){return t.key}),this)},g.prototype.values=function(){return this[d].toArray().map((function(t){return t.value}),this)},g.prototype.reset=function(){this[l]&&this[d]&&this[d].length&&this[d].forEach((function(t){this[l](t.key,t.value)}),this),this[v]=new o,this[d]=new a,this[c]=0},g.prototype.dump=function(){return this[d].map((function(t){if(!b(this,t))return{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}}),this).toArray().filter((function(t){return t}))},g.prototype.dumpLru=function(){return this[d]},g.prototype.inspect=function(t,e){var r="LRUCache {",n=!1;this[h]&&(r+="\n  allowStale: true",n=!0);var o=this[s];o&&o!==1/0&&(n&&(r+=","),r+="\n  max: "+i.inspect(o,e),n=!0);var a=this[f];a&&(n&&(r+=","),r+="\n  maxAge: "+i.inspect(a,e),n=!0);var l=this[u];l&&l!==m&&(n&&(r+=","),r+="\n  length: "+i.inspect(this[c],e),n=!0);var p=!1;return this[d].forEach((function(t){p?r+=",\n  ":(n&&(r+=",\n"),p=!0,r+="\n  ");var o=i.inspect(t.key).split("\n").join("\n  "),s={value:t.value};t.maxAge!==a&&(s.maxAge=t.maxAge),l!==m&&(s.length=t.length),b(this,t)&&(s.stale=!0),s=i.inspect(s,e).split("\n").join("\n  "),r+=o+" => "+s})),(p||n)&&(r+="\n"),r+="}"},g.prototype.set=function(t,e,r){var n=(r=r||this[f])?Date.now():0,o=this[u](e,t);if(this[v].has(t)){if(o>this[s])return E(this,this[v].get(t)),!1;var i=this[v].get(t).value;return this[l]&&(this[p]||this[l](t,i.value)),i.now=n,i.maxAge=r,i.value=e,this[c]+=o-i.length,i.length=o,this.get(t),O(this),!0}var a=new S(t,e,o,n,r);return a.length>this[s]?(this[l]&&this[l](t,e),!1):(this[c]+=a.length,this[d].unshift(a),this[v].set(t,this[d].head),O(this),!0)},g.prototype.has=function(t){return!!this[v].has(t)&&!b(this,this[v].get(t).value)},g.prototype.get=function(t){return _(this,t,!0)},g.prototype.peek=function(t){return _(this,t,!1)},g.prototype.pop=function(){var t=this[d].tail;return t?(E(this,t),t.value):null},g.prototype.del=function(t){E(this,this[v].get(t))},g.prototype.load=function(t){this.reset();for(var e=Date.now(),r=t.length-1;r>=0;r--){var n=t[r],o=n.e||0;if(0===o)this.set(n.k,n.v);else{var i=o-e;i>0&&this.set(n.k,n.v,i)}}},g.prototype.prune=function(){var t=this;this[v].forEach((function(e,r){_(t,r,!1)}))}}).call(this,r(114))},function(t,e,r){"use strict";var n;r.r(e),r.d(e,"PresenceStatus",(function(){return n})),function(t){t.OFFLINE="OFFLINE",t.ONLINE="ONLINE"}(n||(n={}))},function(t,e,r){var n=r(160),o=r(94),i=Object.prototype.hasOwnProperty;t.exports=function(t,e,r){var a=t[e];i.call(t,e)&&o(a,r)&&(void 0!==r||e in t)||n(t,e,r)}},function(t,e,r){var n=r(217),o=r(272),i=r(161);t.exports=function(t){return n(t,i,o)}},function(t,e,r){"use strict";e.__esModule=!0;var n,o=r(652),i=(n=o)&&n.__esModule?n:{default:n};e.default=i.default},function(t,e){t.exports=function(t,e){var r=-1,n=t.length;for(e||(e=Array(n));++r<n;)e[r]=t[r];return e}},function(t,e){t.exports=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0}},function(t,e,r){var n=r(64),o=r(209),i=r(45),a=Function.prototype,s=Object.prototype,c=a.toString,u=s.hasOwnProperty,h=c.call(Object);t.exports=function(t){if(!i(t)||"[object Object]"!=n(t))return!1;var e=o(t);if(null===e)return!0;var r=u.call(e,"constructor")&&e.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==h}},,function(t,e,r){var n=r(43),o=r(662),i=r(437),a=Math.max,s=Math.min;t.exports=function(t,e,r){var c,u,h,f,l,p,d=0,v=!1,m=!1,g=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function y(e){var r=c,n=u;return c=u=void 0,d=e,f=t.apply(n,r)}function _(t){return d=t,l=setTimeout(O,e),v?y(t):f}function b(t){var r=t-p;return void 0===p||r>=e||r<0||m&&t-d>=h}function O(){var t=o();if(b(t))return E(t);l=setTimeout(O,function(t){var r=e-(t-p);return m?s(r,h-(t-d)):r}(t))}function E(t){return l=void 0,g&&c?y(t):(c=u=void 0,f)}function S(){var t=o(),r=b(t);if(c=arguments,u=this,p=t,r){if(void 0===l)return _(p);if(m)return clearTimeout(l),l=setTimeout(O,e),y(p)}return void 0===l&&(l=setTimeout(O,e)),f}return e=i(e)||0,n(r)&&(v=!!r.leading,h=(m="maxWait"in r)?a(i(r.maxWait)||0,e):h,g="trailing"in r?!!r.trailing:g),S.cancel=function(){void 0!==l&&clearTimeout(l),d=0,c=p=u=l=void 0},S.flush=function(){return void 0===l?f:E(o())},S}},,,,,,,,,,function(t,e,r){"use strict";var n=r(1),o=function(t){function e(r,n){var o,i,a,s,c=t.call(this,n)||this;Object.setPrototypeOf(c,e.prototype),c._error=r,c.cause=r,c._type=n;var u=(null===(o=r.config)||void 0===o?void 0:o.url)||(null===(i=r.request)||void 0===i?void 0:i.url)||(null===(s=null===(a=null==r?void 0:r.response)||void 0===a?void 0:a.config)||void 0===s?void 0:s.url),h=u&&u.split("?")[0],f=h?h.replace(/([0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})/,"{id}"):"General";return c.message="Chat SDK Error of name '"+f+"'",c._fingerprint=c.message,c}return Object(n.__extends)(e,t),Object.defineProperty(e.prototype,"isHttpError",{get:function(){return this._type===e.TYPES.HTTP_REQUEST},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fingerprint",{get:function(){return this._fingerprint},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"httpError",{get:function(){if(this.isHttpError){if(this._error.response){var t=this._error.response,e=t.config,r=t.data,n=t.status;return{method:e&&e.method.toUpperCase(),url:null==e?void 0:e.url,status:n,data:r,error:this._error}}if(this._error.request){var o=this._error,i=(e=o.config,o.request);return{method:(null==e?void 0:e.method)&&e.method.toUpperCase(),url:null==e?void 0:e.url,status:0,data:i,error:this._error}}return{method:(null==(e=this._error.config)?void 0:e.method)&&e.method.toUpperCase(),url:null==e?void 0:e.url,status:0,data:"no response/request",error:this._error}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is401Error",{get:function(){return this.isHttpError&&401===this.httpError.status},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPES",{get:function(){return{HTTP_REQUEST:"http-error"}},enumerable:!0,configurable:!0}),e}(Error);e.a=o},function(t,e,r){var n=r(131),o=r(79),i=r(650),a=r(251);t.exports=function(t,e){if(null==t)return{};var r=n(a(t),(function(t){return[t]}));return e=o(e),i(t,r,(function(t,r){return e(t,r[0])}))}},function(t,e,r){var n=r(62),o=function(){try{var t=n(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();t.exports=o},function(t,e,r){var n=r(474),o=Math.max;t.exports=function(t,e,r){return e=o(void 0===e?t.length-1:e,0),function(){for(var i=arguments,a=-1,s=o(i.length-e,0),c=Array(s);++a<s;)c[a]=i[e+a];a=-1;for(var u=Array(e+1);++a<e;)u[a]=i[a];return u[e]=r(c),n(t,this,u)}}},function(t,e,r){var n=r(475),o=r(477)(n);t.exports=o},function(t,e,r){var n=r(152),o=r(209),i=r(163),a=r(218),s=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)n(e,i(t)),t=o(t);return e}:a;t.exports=s},function(t,e,r){(function(t){var n=r(40),o=e&&!e.nodeType&&e,i=o&&"object"==typeof t&&t&&!t.nodeType&&t,a=i&&i.exports===o?n.Buffer:void 0,s=a?a.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var r=t.length,n=s?s(r):new t.constructor(r);return t.copy(n),n}}).call(this,r(109)(t))},function(t,e,r){var n=r(210);t.exports=function(t,e){var r=e?n(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.length)}},function(t,e,r){var n=r(490),o=r(209),i=r(117);t.exports=function(t){return"function"!=typeof t.constructor||i(t)?{}:n(o(t))}},function(t,e,r){var n=r(160),o=r(94);t.exports=function(t,e,r){(void 0!==r&&!o(t[e],r)||void 0===r&&!(e in t))&&n(t,e,r)}},function(t,e){t.exports=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}},,function(t,e,r){(function(t,n){var o;!function(i){var a=e,s=(t&&t.exports,"object"==typeof n&&n);s.global!==s&&s.window;var c=function(t){this.message=t};(c.prototype=new Error).name="InvalidCharacterError";var u=function(t){throw new c(t)},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=/[\t\n\f\r ]/g,l={encode:function(t){t=String(t),/[^\0-\xFF]/.test(t)&&u("The string to be encoded contains characters outside of the Latin1 range.");for(var e,r,n,o,i=t.length%3,a="",s=-1,c=t.length-i;++s<c;)e=t.charCodeAt(s)<<16,r=t.charCodeAt(++s)<<8,n=t.charCodeAt(++s),a+=h.charAt((o=e+r+n)>>18&63)+h.charAt(o>>12&63)+h.charAt(o>>6&63)+h.charAt(63&o);return 2==i?(e=t.charCodeAt(s)<<8,r=t.charCodeAt(++s),a+=h.charAt((o=e+r)>>10)+h.charAt(o>>4&63)+h.charAt(o<<2&63)+"="):1==i&&(o=t.charCodeAt(s),a+=h.charAt(o>>2)+h.charAt(o<<4&63)+"=="),a},decode:function(t){var e=(t=String(t).replace(f,"")).length;e%4==0&&(e=(t=t.replace(/==?$/,"")).length),(e%4==1||/[^+a-zA-Z0-9/]/.test(t))&&u("Invalid character: the string to be decoded is not correctly encoded.");for(var r,n,o=0,i="",a=-1;++a<e;)n=h.indexOf(t.charAt(a)),r=o%4?64*r+n:n,o++%4&&(i+=String.fromCharCode(255&r>>(-2*o&6)));return i},version:"0.1.0"};void 0===(o=function(){return l}.call(e,r,e,t))||(t.exports=o)}()}).call(this,r(109)(t),r(74))},function(t,e,r){var n=r(152),o=r(205),i=r(253),a=r(30);t.exports=function(){var t=arguments.length;if(!t)return[];for(var e=Array(t-1),r=arguments[0],s=t;s--;)e[s-1]=arguments[s];return n(a(r)?i(r):[r],o(e,1))}},function(t,e,r){var n=r(257),o=r(43);t.exports=function(t,e,r){var i=!0,a=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return o(r)&&(i="leading"in r?!!r.leading:i,a="trailing"in r?!!r.trailing:a),n(t,e,{leading:i,maxWait:e,trailing:a})}},function(t,e){t.exports=function(t,e,r){var n=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(r=r>o?o:r)<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+e];return i}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";var n=Object.prototype.hasOwnProperty,o="~";function i(){}function a(t,e,r){this.fn=t,this.context=e,this.once=r||!1}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(o=!1)),s.prototype.eventNames=function(){var t,e,r=[];if(0===this._eventsCount)return r;for(e in t=this._events)n.call(t,e)&&r.push(o?e.slice(1):e);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(t)):r},s.prototype.listeners=function(t,e){var r=o?o+t:t,n=this._events[r];if(e)return!!n;if(!n)return[];if(n.fn)return[n.fn];for(var i=0,a=n.length,s=new Array(a);i<a;i++)s[i]=n[i].fn;return s},s.prototype.emit=function(t,e,r,n,i,a){var s=o?o+t:t;if(!this._events[s])return!1;var c,u,h=this._events[s],f=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),f){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,n),!0;case 5:return h.fn.call(h.context,e,r,n,i),!0;case 6:return h.fn.call(h.context,e,r,n,i,a),!0}for(u=1,c=new Array(f-1);u<f;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var l,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(t,h[u].fn,void 0,!0),f){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,e);break;case 3:h[u].fn.call(h[u].context,e,r);break;case 4:h[u].fn.call(h[u].context,e,r,n);break;default:if(!c)for(l=1,c=new Array(f-1);l<f;l++)c[l-1]=arguments[l];h[u].fn.apply(h[u].context,c)}}return!0},s.prototype.on=function(t,e,r){var n=new a(e,r||this),i=o?o+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],n]:this._events[i].push(n):(this._events[i]=n,this._eventsCount++),this},s.prototype.once=function(t,e,r){var n=new a(e,r||this,!0),i=o?o+t:t;return this._events[i]?this._events[i].fn?this._events[i]=[this._events[i],n]:this._events[i].push(n):(this._events[i]=n,this._eventsCount++),this},s.prototype.removeListener=function(t,e,r,n){var a=o?o+t:t;if(!this._events[a])return this;if(!e)return 0==--this._eventsCount?this._events=new i:delete this._events[a],this;var s=this._events[a];if(s.fn)s.fn!==e||n&&!s.once||r&&s.context!==r||(0==--this._eventsCount?this._events=new i:delete this._events[a]);else{for(var c=0,u=[],h=s.length;c<h;c++)(s[c].fn!==e||n&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:0==--this._eventsCount?this._events=new i:delete this._events[a]}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=o?o+t:t,this._events[e]&&(0==--this._eventsCount?this._events=new i:delete this._events[e])):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prototype.setMaxListeners=function(){return this},s.prefixed=o,s.EventEmitter=s,t.exports=s},,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";(function(t){var n=r(267),o=r(46),i=r.n(o),a=r(633).throttleAdapterEnhancer,s=r(640),c=function(){function e(e){var r=void 0===e?{}:e,n=r.baseUrl,o=void 0===n?"/":n,c=r.retryOnAllErrors,u=void 0!==c&&c,h=r.throttleThreshold,f=void 0===h?0:h;t.__xSessionId&&(i.a.defaults.headers.common.xsessionid=t.__xSessionId),this.baseUrl=o;var l=f?{adapter:a(i.a.defaults.adapter,{threshold:f})}:{};this.axios=i.a.create(l);var p={retries:2,retryDelay:function(){return 500},retryCondition:function(t){return s.isNetworkOrIdempotentRequestError(t)||t.code,!0}};u&&(p.retryCondition=function(){return!0}),o&&/^(http|https)/.test(o)&&s(this.axios,p)}return e.prototype.get=function(t,e){return void 0===e&&(e={}),this._request("get",t,e)},e.prototype.post=function(t,e,r){return void 0===r&&(r={}),this._request("post",t,r,{data:e})},e.prototype.zdelete=function(t,e){return this._request("delete",t,{},{data:e})},e.prototype.put=function(t,e,r){return void 0===e&&(e={}),void 0===r&&(r={}),this._request("put",t,r,{data:e})},e.prototype._request=function(e,r,o,i){var a=this;void 0===o&&(o={}),void 0===i&&(i={});var s=this._getRequestConfig(e,r,o,i);return t.debug&&console.log("%c "+e+" ","background: #222; color: #eaeaa5"," "+s.url),this.axios.request(s).then((function(t){return a._logResponse(t)})).catch((function(t){throw new n.a(t,n.a.TYPES.HTTP_REQUEST)}))},e.prototype._getRequestConfig=function(t,e,r,n){var o=this._getRelativeUrl(e,r,n),i=this.baseUrl,a=this._getHeaders(r,n);return Object.assign({url:o,method:t,baseURL:i},a?{headers:a}:void 0,n)},e.prototype._logResponse=function(e){return t.debug&&console.log("Response:",e),e},e}();e.a=c}).call(this,r(74))},function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(211),o=r.n(n);function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o.a.apply(void 0,t),n=r.split("?"),i=n[0],a=n[1];if(a){var s=a.split("&");return i+"?"+s.sort().join("&")}return r}},function(t,e,r){var n=r(43),o=r(95),i=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(o(t))return NaN;if(n(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=n(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(i,"");var r=s.test(t);return r||c.test(t)?u(t.slice(2),r?2:8):a.test(t)?NaN:+t}},function(t,e,r){var n=r(205),o=r(79),i=r(246),a=r(468),s=r(247),c=r(254),u=i((function(t){var e=c(t);return s(e)&&(e=void 0),a(n(t,1,s,!0),o(e,2))}));t.exports=u},function(t,e,r){var n=r(256),o=r(656),i=r(79),a=r(30);t.exports=function(t,e){return(a(t)?n:o)(t,i(e,3))}},function(t,e,r){var n=r(118),o=r(480),i=r(250),a=r(481),s=r(482),c=r(273),u=r(253),h=r(483),f=r(484),l=r(216),p=r(251),d=r(93),v=r(485),m=r(486),g=r(275),y=r(30),_=r(87),b=r(491),O=r(43),E=r(493),S=r(81),A={};A["[object Arguments]"]=A["[object Array]"]=A["[object ArrayBuffer]"]=A["[object DataView]"]=A["[object Boolean]"]=A["[object Date]"]=A["[object Float32Array]"]=A["[object Float64Array]"]=A["[object Int8Array]"]=A["[object Int16Array]"]=A["[object Int32Array]"]=A["[object Map]"]=A["[object Number]"]=A["[object Object]"]=A["[object RegExp]"]=A["[object Set]"]=A["[object String]"]=A["[object Symbol]"]=A["[object Uint8Array]"]=A["[object Uint8ClampedArray]"]=A["[object Uint16Array]"]=A["[object Uint32Array]"]=!0,A["[object Error]"]=A["[object Function]"]=A["[object WeakMap]"]=!1,t.exports=function t(e,r,I,C,T,R){var j,w=1&r,M=2&r,x=4&r;if(I&&(j=T?I(e,C,T,R):I(e)),void 0!==j)return j;if(!O(e))return e;var P=y(e);if(P){if(j=v(e),!w)return u(e,j)}else{var D=d(e),N="[object Function]"==D||"[object GeneratorFunction]"==D;if(_(e))return c(e,w);if("[object Object]"==D||"[object Arguments]"==D||N&&!T){if(j=M||N?{}:g(e),!w)return M?f(e,s(j,e)):h(e,a(j,e))}else{if(!A[D])return T?e:{};j=m(e,D,w)}}R||(R=new n);var U=R.get(e);if(U)return U;R.set(e,j),E(e)?e.forEach((function(n){j.add(t(n,r,I,n,e,R))})):b(e)&&e.forEach((function(n,o){j.set(o,t(n,r,I,o,e,R))}));var k=x?M?p:l:M?keysIn:S,L=P?void 0:k(e);return o(L||e,(function(n,o){L&&(n=e[o=n]),i(j,o,t(n,r,I,o,e,R))})),j}},function(t,e,r){var n=r(92),o=r(254),i=r(495),a=r(82);t.exports=function(t,e){return e=n(e,t),null==(t=i(t,e))||delete t[a(o(e))]}},function(t,e,r){var n=r(472);t.exports=function(t){var e=n(t),r=e%1;return e==e?r?e-r:e:0}},function(t,e,r){var n=r(131),o=r(79),i=r(663),a=r(30);t.exports=function(t,e){return(a(t)?n:i)(t,o(e,3))}},,,,,function(t,e,r){"use strict";r.d(e,"a",(function(){return o}));var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function o(t){return null!==t&&"object"===(void 0===t?"undefined":n(t))&&(t&&"function"==typeof t.then)}},,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(206),o=r(563),i=r(564),a=r(207),s=r(649),c=r(208);t.exports=function(t,e,r){var u=-1,h=o,f=t.length,l=!0,p=[],d=p;if(r)l=!1,h=i;else if(f>=200){var v=e?null:s(t);if(v)return c(v);l=!1,h=a,d=new n}else d=e?[]:p;t:for(;++u<f;){var m=t[u],g=e?e(m):m;if(m=r||0!==m?m:0,l&&g==g){for(var y=d.length;y--;)if(d[y]===g)continue t;e&&d.push(g),p.push(m)}else h(d,g,r)||(d!==p&&d.push(g),p.push(m))}return p}},function(t,e,r){var n=r(178),o=r(657)(n);t.exports=o},,,function(t,e,r){var n=r(437);t.exports=function(t){return t?(t=n(t))===1/0||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}},function(t,e,r){var n=r(76),o=r(86),i=r(30),a=n?n.isConcatSpreadable:void 0;t.exports=function(t){return i(t)||o(t)||!!(a&&t&&t[a])}},function(t,e){t.exports=function(t,e,r){switch(r.length){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}},function(t,e,r){var n=r(476),o=r(269),i=r(164),a=o?function(t,e){return o(t,"toString",{configurable:!0,enumerable:!1,value:n(e),writable:!0})}:i;t.exports=a},function(t,e){t.exports=function(t){return function(){return t}}},function(t,e){var r=Date.now;t.exports=function(t){var e=0,n=0;return function(){var o=r(),i=16-(o-n);if(n=o,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}},function(t,e,r){var n=r(43),o=r(117),i=r(479),a=Object.prototype.hasOwnProperty;t.exports=function(t){if(!n(t))return i(t);var e=o(t),r=[];for(var s in t)("constructor"!=s||!e&&a.call(t,s))&&r.push(s);return r}},function(t,e){t.exports=function(t){var e=[];if(null!=t)for(var r in Object(t))e.push(r);return e}},function(t,e){t.exports=function(t,e){for(var r=-1,n=null==t?0:t.length;++r<n&&!1!==e(t[r],r,t););return t}},function(t,e,r){var n=r(108),o=r(81);t.exports=function(t,e){return t&&n(e,o(e),t)}},function(t,e,r){var n=r(108),o=r(161);t.exports=function(t,e){return t&&n(e,o(e),t)}},function(t,e,r){var n=r(108),o=r(163);t.exports=function(t,e){return n(t,o(t),e)}},function(t,e,r){var n=r(108),o=r(272);t.exports=function(t,e){return n(t,o(t),e)}},function(t,e){var r=Object.prototype.hasOwnProperty;t.exports=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&r.call(t,"index")&&(n.index=t.index,n.input=t.input),n}},function(t,e,r){var n=r(210),o=r(487),i=r(488),a=r(489),s=r(274);t.exports=function(t,e,r){var c=t.constructor;switch(e){case"[object ArrayBuffer]":return n(t);case"[object Boolean]":case"[object Date]":return new c(+t);case"[object DataView]":return o(t,r);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(t,r);case"[object Map]":return new c;case"[object Number]":case"[object String]":return new c(t);case"[object RegExp]":return i(t);case"[object Set]":return new c;case"[object Symbol]":return a(t)}}},function(t,e,r){var n=r(210);t.exports=function(t,e){var r=e?n(t.buffer):t.buffer;return new t.constructor(r,t.byteOffset,t.byteLength)}},function(t,e){var r=/\w*$/;t.exports=function(t){var e=new t.constructor(t.source,r.exec(t));return e.lastIndex=t.lastIndex,e}},function(t,e,r){var n=r(76),o=n?n.prototype:void 0,i=o?o.valueOf:void 0;t.exports=function(t){return i?Object(i.call(t)):{}}},function(t,e,r){var n=r(43),o=Object.create,i=function(){function t(){}return function(e){if(!n(e))return{};if(o)return o(e);t.prototype=e;var r=new t;return t.prototype=void 0,r}}();t.exports=i},function(t,e,r){var n=r(492),o=r(116),i=r(133),a=i&&i.isMap,s=a?o(a):n;t.exports=s},function(t,e,r){var n=r(93),o=r(45);t.exports=function(t){return o(t)&&"[object Map]"==n(t)}},function(t,e,r){var n=r(494),o=r(116),i=r(133),a=i&&i.isSet,s=a?o(a):n;t.exports=s},function(t,e,r){var n=r(93),o=r(45);t.exports=function(t){return o(t)&&"[object Set]"==n(t)}},function(t,e,r){var n=r(132),o=r(282);t.exports=function(t,e){return e.length<2?t:n(t,o(e,0,-1))}},function(t,e,r){var n=r(255);t.exports=function(t){return n(t)?void 0:t}},function(t,e,r){var n=r(228),o=r(270),i=r(271);t.exports=function(t){return i(o(t,void 0,n),t+"")}},function(t,e,r){var n=r(118),o=r(276),i=r(212),a=r(499),s=r(43),c=r(161),u=r(277);t.exports=function t(e,r,h,f,l){e!==r&&i(r,(function(i,c){if(l||(l=new n),s(i))a(e,r,c,h,t,f,l);else{var p=f?f(u(e,c),i,c+"",e,r,l):void 0;void 0===p&&(p=i),o(e,c,p)}}),c)}},function(t,e,r){var n=r(276),o=r(273),i=r(274),a=r(253),s=r(275),c=r(86),u=r(30),h=r(247),f=r(87),l=r(153),p=r(43),d=r(255),v=r(110),m=r(277),g=r(500);t.exports=function(t,e,r,y,_,b,O){var E=m(t,r),S=m(e,r),A=O.get(S);if(A)n(t,r,A);else{var I=b?b(E,S,r+"",t,e,O):void 0,C=void 0===I;if(C){var T=u(S),R=!T&&f(S),j=!T&&!R&&v(S);I=S,T||R||j?u(E)?I=E:h(E)?I=a(E):R?(C=!1,I=o(S,!0)):j?(C=!1,I=i(S,!0)):I=[]:d(S)||c(S)?(I=E,c(E)?I=g(E):p(E)&&!l(E)||(I=s(S))):C=!1}C&&(O.set(S,I),_(I,S,y,b,O),O.delete(S)),n(t,r,I)}}},function(t,e,r){var n=r(108),o=r(161);t.exports=function(t){return n(t,o(t))}},function(t,e,r){var n=r(246),o=r(502);t.exports=function(t){return n((function(e,r){var n=-1,i=r.length,a=i>1?r[i-1]:void 0,s=i>2?r[2]:void 0;for(a=t.length>3&&"function"==typeof a?(i--,a):void 0,s&&o(r[0],r[1],s)&&(a=i<3?void 0:a,i=1),e=Object(e);++n<i;){var c=r[n];c&&t(e,c,n,a)}return e}))}},function(t,e,r){var n=r(94),o=r(80),i=r(115),a=r(43);t.exports=function(t,e,r){if(!a(r))return!1;var s=typeof e;return!!("number"==s?o(r)&&i(e,r.length):"string"==s&&e in r)&&n(r[e],t)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return c}));var n=r(1),o=r(248),i=r.n(o),a=r(436),s=r(573);function c(e,r){var o=this;void 0===r&&(r={});var c=r.enabledByDefault,u=void 0===c||c,h=r.cacheFlag,f=void 0===h?"cache":h,l=r.defaultCache,p=void 0===l?new i.a({maxAge:3e5,max:100}):l;return function(r){var i=r.url,c=r.method,h=r.params,l=r.paramsSerializer,d=r.forceUpdate,v=void 0!==r[f]&&null!==r[f]?r[f]:u;if("get"===c&&v){var m=Object(s.a)(v)?v:p,g=Object(a.a)(i,h,l),y=m.get(g);return!y||d?(y=n.__awaiter(o,void 0,void 0,(function(){var t;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(r)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),m.del(g),t;case 3:return[2]}}))})),m.set(g,y),y):("info"===t.env.LOGGER_LEVEL&&console.info("[axios-extensions] request cached by cache adapter --\x3e url: "+g),y)}return e(r)}}}).call(this,r(114))},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return s}));var n=r(1),o=r(248),i=r.n(o),a=r(436);function s(e,r){var o=this;void 0===r&&(r={});var s=r.threshold,c=void 0===s?1e3:s,u=r.cache,h=void 0===u?new i.a({max:10}):u;return function(r){var i=r.url,s=r.method,u=r.params,f=r.paramsSerializer,l=Object(a.a)(i,u,f),p=Date.now(),d=h.get(l)||{timestamp:p};if("get"===s){if(p-d.timestamp<=c){var v=d.value;if(v)return"info"===t.env.LOGGER_LEVEL&&console.info("[axios-extensions] request cached by throttle adapter --\x3e url: "+l),v}return function(t,r){var i=n.__awaiter(o,void 0,void 0,(function(){var o,i;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(r)];case 1:return o=n.sent(),h.set(t,{timestamp:Date.now(),value:Promise.resolve(o)}),[2,o];case 2:throw i=n.sent(),h.del(t),i;case 3:return[2]}}))}));return h.set(t,{timestamp:Date.now(),value:i}),i}(l,r)}return e(r)}}}).call(this,r(114))},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return o}));var n=r(1);function o(e,r){var o=this;void 0===r&&(r={});var i=r.times,a=void 0===i?2:i;return function(r){return n.__awaiter(o,void 0,void 0,(function(){var o,i,s,c,u=this;return n.__generator(this,(function(h){return o=r.retryTimes,i=void 0===o?a:o,!1,s=0,[2,(c=function(){return n.__awaiter(u,void 0,void 0,(function(){var o;return n.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e(r)];case 1:return[2,n.sent()];case 2:if(o=n.sent(),i===s)throw o;return s++,"info"===t.env.LOGGER_LEVEL&&console.info("[axios-extensions] request start retrying --\x3e url: "+r.url+" , time: "+s),[2,c()];case 3:return[2]}}))}))})()]}))}))}}}).call(this,r(114))},function(t,e){t.exports=function(t,e,r,n){for(var o=t.length,i=r+(n?1:-1);n?i--:++i<o;)if(e(t[i],i,t))return i;return-1}},function(t,e,r){"use strict";var n=Object.prototype.hasOwnProperty,o=Array.isArray,i=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),a=function(t,e){for(var r=e&&e.plainObjects?Object.create(null):{},n=0;n<t.length;++n)void 0!==t[n]&&(r[n]=t[n]);return r};t.exports={arrayToObject:a,assign:function(t,e){return Object.keys(e).reduce((function(t,r){return t[r]=e[r],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],r=[],n=0;n<e.length;++n)for(var i=e[n],a=i.obj[i.prop],s=Object.keys(a),c=0;c<s.length;++c){var u=s[c],h=a[u];"object"==typeof h&&null!==h&&-1===r.indexOf(h)&&(e.push({obj:a,prop:u}),r.push(h))}return function(t){for(;t.length>1;){var e=t.pop(),r=e.obj[e.prop];if(o(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);e.obj[e.prop]=n}}}(e),t},decode:function(t,e,r){var n=t.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(t){return n}},encode:function(t,e,r){if(0===t.length)return t;var n="string"==typeof t?t:String(t);if("iso-8859-1"===r)return escape(n).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var o="",a=0;a<n.length;++a){var s=n.charCodeAt(a);45===s||46===s||95===s||126===s||s>=48&&s<=57||s>=65&&s<=90||s>=97&&s<=122?o+=n.charAt(a):s<128?o+=i[s]:s<2048?o+=i[192|s>>6]+i[128|63&s]:s<55296||s>=57344?o+=i[224|s>>12]+i[128|s>>6&63]+i[128|63&s]:(a+=1,s=65536+((1023&s)<<10|1023&n.charCodeAt(a)),o+=i[240|s>>18]+i[128|s>>12&63]+i[128|s>>6&63]+i[128|63&s])}return o},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},merge:function t(e,r,i){if(!r)return e;if("object"!=typeof r){if(o(e))e.push(r);else{if(!e||"object"!=typeof e)return[e,r];(i&&(i.plainObjects||i.allowPrototypes)||!n.call(Object.prototype,r))&&(e[r]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(r);var s=e;return o(e)&&!o(r)&&(s=a(e,i)),o(e)&&o(r)?(r.forEach((function(r,o){if(n.call(e,o)){var a=e[o];a&&"object"==typeof a&&r&&"object"==typeof r?e[o]=t(a,r,i):e.push(r)}else e[o]=r})),e):Object.keys(r).reduce((function(e,o){var a=r[o];return n.call(e,o)?e[o]=t(e[o],a,i):e[o]=a,e}),s)}}},function(t,e,r){"use strict";var n=String.prototype.replace,o=/%20/g;t.exports={default:"RFC3986",formatters:{RFC1738:function(t){return n.call(t,o,"+")},RFC3986:function(t){return t}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(t,e,r){var n=r(646);t.exports=function(t,e){return!!(null==t?0:t.length)&&n(t,e,0)>-1}},function(t,e){t.exports=function(t,e,r){for(var n=-1,o=null==t?0:t.length;++n<o;)if(r(e,t[n]))return!0;return!1}},function(t,e,r){var n=r(250),o=r(92),i=r(115),a=r(43),s=r(82);t.exports=function(t,e,r,c){if(!a(t))return t;for(var u=-1,h=(e=o(e,t)).length,f=h-1,l=t;null!=l&&++u<h;){var p=s(e[u]),d=r;if(u!=f){var v=l[p];void 0===(d=c?c(v,p,l):void 0)&&(d=a(v)?v:i(e[u+1])?[]:{})}n(l,p,d),l=l[p]}return t}},function(t,e){},function(t,e,r){"use strict";var n=r(8),o=function(){function t(t){var e=t.title,r=t.lines,o=t.buttons,i=t.imageUrl,a=t.orientation,s=void 0===a?n.MessageOrientation.Landscape:a;this._dto={title:e,lines:r,buttons:o,imageUrl:i,orientation:s}}return Object.defineProperty(t.prototype,"title",{get:function(){return this._dto.title},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lines",{get:function(){return this._dto.lines},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"buttons",{get:function(){return this._dto.buttons},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"imageUrl",{get:function(){return this._dto.imageUrl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"orientation",{get:function(){return this._dto.orientation},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{title:this.title,image:this.imageUrl,lines:this.lines,buttons:this.buttons,orientation:this.orientation}},t}();e.a=o},function(t,e,r){"use strict";var n=function(){function t(t){var e=t.appName,r=t.appData;this._appName=e,this._appData=r}return Object.defineProperty(t.prototype,"appName",{get:function(){return this._appName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"appData",{get:function(){return this._appData},enumerable:!0,configurable:!0}),t.prototype.toJSON=function(){return{appName:this.appName,appData:this.appData}},t}();e.a=n},function(t,e,r){"use strict";r.d(e,"a",(function(){return u}));var n=r(8),o=r(252),i=r.n(o),a=r(66),s=r(165),c=function(t){var e=t.message,r=t.groupPosition,n=t.showSentTime,o=Object.assign({},e.dto),i=Object.assign({},e.transit);return new a.a(o,i,r,n)};c=i()(500,(function(t,e){return t.message===e.message&&t.groupPosition===e.groupPosition&&t.showSentTime===e.showSentTime}))(c);var u=function(){function t(t){var e=s.a.isExperimentOn(n.experiments.MessageGroupingNewTime)?180:60;this._thresholdMillis=60*(t||e)*1e3}return t.prototype.addGroups=function(t){var e=this;return t.map((function(r,n){var o=e._strategy(t[n-1],r,t[n+1]),i=o.groupPosition,a=o.showSentTime;return c({message:r,groupPosition:i,showSentTime:a})}))},t.prototype.getPartsGrouping=function(t){var e=this,r=t.messageParts.length,n=t.groupPosition,o=t.showSentTime;return t.messageParts.map((function(t,i){return{groupPosition:e._classifyPart(n,i,r),showSentTime:e._showPartSentTime(o,i)}}))},t.prototype.isFirstMessage=function(t){return t.groupPosition===n.MessagePositionInGroup.SINGLE||t.groupPosition===n.MessagePositionInGroup.START},t.prototype._classifyPart=function(t,e,r){return 1===r?t:this._isFirstPartOfStartingMessage(e,t)?n.MessagePositionInGroup.START:this._isLastPartOfClosingMessage(e,r,t)?n.MessagePositionInGroup.END:n.MessagePositionInGroup.MIDDLE},t.prototype._isLastPartOfClosingMessage=function(t,e,r){return t===e-1&&(r===n.MessagePositionInGroup.END||r===n.MessagePositionInGroup.SINGLE)},t.prototype._isFirstPartOfStartingMessage=function(t,e){return 0===t&&(e===n.MessagePositionInGroup.START||e===n.MessagePositionInGroup.SINGLE)},t.prototype._strategy=function(t,e,r){return{groupPosition:this._position({olderMessage:t,currentMessage:e,newerMessage:r}),showSentTime:this._showSentTime(t,e)}},t.prototype._isSameTimeWindow=function(t,e){var r=new Date(t.createdAt),n=new Date(e.createdAt);return Math.abs(n.getTime()-r.getTime())<this._thresholdMillis},t.prototype._isSameSender=function(t,e){var r,n;return(null===(r=t.sender)||void 0===r?void 0:r.userId)===(null===(n=e.sender)||void 0===n?void 0:n.userId)},t.prototype._isGroupBreakingType=function(t,e){if(s.a.isExperimentOn(n.experiments.MessageGroupingNewTime))return!1;var r=[n.MessageTypes.Templates.Standard,n.MessageTypes.Templates.Minimal];return-1!==r.indexOf(t.type)||-1!==r.indexOf(e.type)},t.prototype._position=function(t){var e=t.olderMessage,r=t.currentMessage,o=t.newerMessage,i=!this._isInSameGroup(r,e),a=!this._isInSameGroup(r,o),s=n.MessagePositionInGroup.MIDDLE;return i&&a?s=n.MessagePositionInGroup.SINGLE:a?s=n.MessagePositionInGroup.END:i&&(s=n.MessagePositionInGroup.START),s},t.prototype._isInSameGroup=function(t,e){if(!t||!e)return!1;var r=this._isSameSender(t,e),n=this._isSameTimeWindow(t,e),o=this._isGroupBreakingType(t,e);return r&&n&&!o},t.prototype._showSentTime=function(t,e){return t&&e&&!this._alwaysShowTimestampTypes(e)&&this._isSameTimeWindow(t,e)?"on-click":"always"},t.prototype._alwaysShowTimestampTypes=function(t){return!s.a.isExperimentOn(n.experiments.MessageGroupingNewTime)&&t.type===n.MessageTypes.Templates.Minimal},t.prototype._showPartSentTime=function(t,e){return 0===e?t:"on-click"},t}()},function(t,e,r){var n=r(643)(r(626));t.exports=n},,function(t,e,r){t.exports=r(630)},function(t,e,r){"use strict";function n(t){return!!(t.set&&t.get&&t.del&&"function"==typeof t.get&&"function"==typeof t.set&&"function"==typeof t.del)}r.d(e,"a",(function(){return n}))},function(t,e,r){"use strict";var n=r(644),o=r(645),i=r(562);t.exports={formats:i,parse:o,stringify:n}},function(t,e,r){"use strict";(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.a=r}).call(this,r(74))},function(t,e,r){var n=r(651),o=r(81);t.exports=function(t){return null==t?[]:n(t,o(t))}},function(t,e,r){var n=r(468);t.exports=function(t,e){return e="function"==typeof e?e:void 0,t&&t.length?n(t,void 0,e):[]}},function(t,e,r){var n=r(205),o=r(246),i=r(468),a=r(247),s=o((function(t){return i(n(t,1,a,!0))}));t.exports=s},function(t,e,r){var n=r(660),o=r(661),i=r(79);t.exports=function(t,e){return t&&t.length?n(t,i(e,2),o):void 0}},function(t,e,r){var n=r(628),o=r(205),i=r(246),a=r(247),s=i((function(t,e){return a(t)?n(t,o(e,1,a,!0)):[]}));t.exports=s},function(t,e,r){"use strict";function n(t){return function(e){var r=e.dispatch,n=e.getState;return function(e){return function(o){return"function"==typeof o?o(r,n,t):e(o)}}}}e.__esModule=!0;var o=n();o.withExtraArgument=n,e.default=o},function(t,e,r){"use strict";(function(t){r.d(e,"a",(function(){return h}));var n=r(448),o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,o=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){o=!0,i=t}finally{try{!n&&s.return&&s.return()}finally{if(o)throw i}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},a="PENDING",s="FULFILLED",c="REJECTED";function u(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=[a,s,c],r=t.promiseTypeSuffixes||e,u=t.promiseTypeDelimiter||"_";return function(t){var e=t.dispatch;return function(t){return function(a){var s=void 0,c=void 0;if(!a.payload)return t(a);var h=a.payload;if(Object(n.a)(h))s=h;else if(Object(n.a)(h.promise))s=h.promise,c=h.data;else{if("function"!=typeof h&&"function"!=typeof h.promise)return t(a);if(s=h.promise?h.promise():h(),c=h.promise?h.data:void 0,!Object(n.a)(s))return t(i({},a,{payload:s}))}var f=a.type,l=a.meta,p=o(r,3),d=p[0],v=p[1],m=p[2],g=function(t,e){return i({type:[f,e?m:v].join(u)},null==t?{}:{payload:t},void 0!==l?{meta:l}:{},e?{error:!0}:{})};return t(i({type:[f,d].join(u)},void 0!==c?{payload:c}:{},void 0!==l?{meta:l}:{})),s.then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=g(t,!1);return e(r),{value:t,action:r}}),(function(t){var r=g(t,!0);throw e(r),t}))}}}}function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.dispatch;return"function"==typeof r?u()({dispatch:r}):(t&&t.env,null)}}).call(this,r(114))},function(t,e,r){var n=r(440);t.exports=function(t){return n(t,5)}},function(t,e,r){var n=r(565);t.exports=function(t,e,r){return null==t?t:n(t,e,r)}},function(t,e,r){t.exports=r(664)},function(t,e,r){var n=r(79),o=r(665);t.exports=function(t,e){var r=[];if(!t||!t.length)return r;var i=-1,a=[],s=t.length;for(e=n(e,3);++i<s;){var c=t[i];e(c,i,t)&&(r.push(c),a.push(i))}return o(t,a),r}},function(t,e,r){var n=r(79),o=r(666),i=r(268);t.exports=function(t,e){return i(t,o(n(e)))}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,r){var n=r(560),o=r(79),i=r(442),a=Math.max;t.exports=function(t,e,r){var s=null==t?0:t.length;if(!s)return-1;var c=null==r?0:i(r);return c<0&&(c=a(s+c,0)),n(t,o(e,3),c)}},function(t,e){t.exports=function(){}},function(t,e,r){var n=r(206),o=r(563),i=r(564),a=r(131),s=r(116),c=r(207);t.exports=function(t,e,r,u){var h=-1,f=o,l=!0,p=t.length,d=[],v=e.length;if(!p)return d;r&&(e=a(e,s(r))),u?(f=i,l=!1):e.length>=200&&(f=c,l=!1,e=new n(e));t:for(;++h<p;){var m=t[h],g=null==r?m:r(m);if(m=u||0!==m?m:0,l&&g==g){for(var y=v;y--;)if(e[y]===g)continue t;d.push(m)}else f(e,g,u)||d.push(m)}return d}},,function(t,e,r){"use strict";var n,o,i,a=(n=r(631))&&n.__esModule?n:{default:n};function s(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}var c=function(){function t(t,e){var n=(void 0===e?{}:e).atomicServerTime,a=void 0!==n&&n;!function(t,e,r){e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r}(this,"atomicServerTime",!1),i=r(31),t=t||i(),o=r(119),r(260),r(259),this.name=t,this.listeningOnRefs=[],this.db=null,this.terminated=!1,this._initializationInProgress=Promise.resolve(),this.atomicServerTime=a}var e=t.prototype;return e.connect=function(){var t,e=(t=a.default.mark((function t(e,r){var n=this;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._assertInstanceAlive(),t.next=3,this._initializationInProgress;case 3:return this._initializationInProgress=new Promise((function(t){return n._initializationCompleted=t})),t.abrupt("return",Promise.resolve().then((function(){return n.db?(n._initializationCompleted(),n.db.goOnline()):Promise.resolve().then((function(){return o.initializeApp(e,n.name)})).then((function(t){return t.auth().signInWithCustomToken(r).then((function(){if(n._initializationCompleted(),n.terminated)return t.delete();n.db=t.database()}))}))})).catch((function(t){throw n._initializationCompleted(),t})));case 5:case"end":return t.stop()}}),t,this)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){s(i,n,o,a,c,"next",t)}function c(t){s(i,n,o,a,c,"throw",t)}a(void 0)}))});return function(t,r){return e.apply(this,arguments)}}(),e.disconnect=function(){this.db&&(this.listeningOnRefs.forEach((function(t){return t.off()})),this.listeningOnRefs.length=0,this.db.goOffline())},e.terminate=function(){if(this.terminated=!0,this.disconnect(),this.db)try{return this.db.app.delete()}finally{this.db=null}},e.getFirebaseServerTime=function(t){if(!this.db)throw new Error("FirebaseService.getFirebaseServerTime: not connected! (path="+u(t)+")");if(this.atomicServerTime)return this.db.ref("/.info/serverTimeOffset").once("value").then((function(t){return t.val()+Date.now()}));var e=this.db.ref(t);return e.set(o.database.ServerValue.TIMESTAMP).then((function(){return e.once("value").then((function(t){return t.val()}))}))},e.getValuesAtPath=function(t){var e=t.path;if(!this.db)throw new Error("FirebaseService.getValuesAsPath: not connected! (path="+u(e)+")");return this.db.ref(e).once("value").then((function(t){return t.val()}))},e.listenOnRef=function(t,e){return this._listenOnRefWithQuery(t,e)},e.listenOnPath=function(t,e){if(!this.db)throw new Error("FirebaseService.listenOnPath: not connected! (path="+u(t)+")");var r=this.db.ref(t);return this._listenOnRefWithQuery(r,e)},e._listenOnRefWithQuery=function(t,e){var r=this,n=void 0===e?{}:e,o=n.orderBy,i=n.startAt;return o&&(t=t.orderByChild(o)),i&&(t=t.startAt(i)),{when:function(e){return{call:function(n){t.on(e,(function(t){try{var e=n({key:t.key,value:t.val(),ref:t.ref});e&&"function"==typeof e.catch&&e.catch(console.error)}catch(t){console.error(t)}})),r.listeningOnRefs.push(t)}}}}},e._assertInstanceAlive=function(){if(this.terminated)throw new Error("Can't connect a firebase service after termination, please use a different instance (name="+this.name+")")},t}();function u(t){var e=(t||"").split("/");return e[e.length-1]}t.exports=c},function(t,e,r){t.exports=r(632)},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},o=n.iterator||"@@iterator",i=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r,n){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new E(n||[]);return i._invoke=function(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return A()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var s=_(a,r);if(s){if(s===u)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var h=c(t,e,r);if("normal"===h.type){if(n=r.done?"completed":"suspendedYield",h.arg===u)continue;return{value:h.arg,done:r.done}}"throw"===h.type&&(n="completed",r.method="throw",r.arg=h.arg)}}}(t,r,a),i}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=s;var u={};function h(){}function f(){}function l(){}var p={};p[o]=function(){return this};var d=Object.getPrototypeOf,v=d&&d(d(S([])));v&&v!==e&&r.call(v,o)&&(p=v);var m=l.prototype=h.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function y(t,e){var n;this._invoke=function(o,i){function a(){return new e((function(n,a){!function n(o,i,a,s){var u=c(t[o],t,i);if("throw"!==u.type){var h=u.arg,f=h.value;return f&&"object"==typeof f&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(f).then((function(t){h.value=t,a(h)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}(o,i,n,a)}))}return n=n?n.then(a,a):a()}}function _(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,_(t,e),"throw"===e.method))return u;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,u;var o=n.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,u):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,u)}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,i=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:A}}function A(){return{value:void 0,done:!0}}return f.prototype=m.constructor=l,l.constructor=f,l[a]=f.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(y.prototype),y.prototype[i]=function(){return this},t.AsyncIterator=y,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new y(s(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),m[a]="Generator",m[o]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=r.call(i,"catchLoc"),c=r.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,u):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),u},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),u}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;O(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),u}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e,r){"use strict";r.r(e);var n=r(248),o=r.n(n);r.d(e,"Cache",(function(){return o.a}));var i=r(557);r.d(e,"cacheAdapterEnhancer",(function(){return i.a}));var a=r(559);r.d(e,"retryAdapterEnhancer",(function(){return a.a}));var s=r(558);r.d(e,"throttleAdapterEnhancer",(function(){return s.a}))},function(t,e,r){(function(e){"pseudomap"===e.env.npm_package_name&&"test"===e.env.npm_lifecycle_script&&(e.env.TEST_PSEUDOMAP="true"),"function"!=typeof Map||e.env.TEST_PSEUDOMAP?t.exports=r(635):t.exports=Map}).call(this,r(114))},function(t,e){var r=Object.prototype.hasOwnProperty;function n(t){if(!(this instanceof n))throw new TypeError("Constructor PseudoMap requires 'new'");if(this.clear(),t)if(t instanceof n||"function"==typeof Map&&t instanceof Map)t.forEach((function(t,e){this.set(e,t)}),this);else{if(!Array.isArray(t))throw new TypeError("invalid argument");t.forEach((function(t){this.set(t[0],t[1])}),this)}}function o(t,e){return t===e||t!=t&&e!=e}function i(t,e,r){this.key=t,this.value=e,this._index=r}function a(t,e){for(var n=0,i="_"+e,a=i;r.call(t,a);a=i+n++)if(o(t[a].key,e))return t[a]}t.exports=n,n.prototype.forEach=function(t,e){e=e||this,Object.keys(this._data).forEach((function(r){"size"!==r&&t.call(e,this._data[r].value,this._data[r].key)}),this)},n.prototype.has=function(t){return!!a(this._data,t)},n.prototype.get=function(t){var e=a(this._data,t);return e&&e.value},n.prototype.set=function(t,e){!function(t,e,n){for(var a=0,s="_"+e,c=s;r.call(t,c);c=s+a++)if(o(t[c].key,e))return void(t[c].value=n);t.size++,t[c]=new i(e,n,c)}(this._data,t,e)},n.prototype.delete=function(t){var e=a(this._data,t);e&&(delete this._data[e._index],this._data.size--)},n.prototype.clear=function(){var t=Object.create(null);t.size=0,Object.defineProperty(this,"_data",{value:t,enumerable:!1,configurable:!0,writable:!1})},Object.defineProperty(n.prototype,"size",{get:function(){return this._data.size},set:function(t){},enumerable:!0,configurable:!0}),n.prototype.values=n.prototype.keys=n.prototype.entries=function(){throw new Error("iterators are not implemented in this version")}},function(t,e,r){(function(t){var n=Object.getOwnPropertyDescriptors||function(t){for(var e=Object.keys(t),r={},n=0;n<e.length;n++)r[e[n]]=Object.getOwnPropertyDescriptor(t,e[n]);return r},o=/%[sdj%]/g;e.format=function(t){if(!g(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(s(arguments[r]));return e.join(" ")}r=1;for(var n=arguments,i=n.length,a=String(t).replace(o,(function(t){if("%%"===t)return"%";if(r>=i)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}})),c=n[r];r<i;c=n[++r])v(c)||!b(c)?a+=" "+c:a+=" "+s(c);return a},e.deprecate=function(r,n){if(void 0!==t&&!0===t.noDeprecation)return r;if(void 0===t)return function(){return e.deprecate(r,n).apply(this,arguments)};var o=!1;return function(){if(!o){if(t.throwDeprecation)throw new Error(n);t.traceDeprecation?console.trace(n):console.error(n),o=!0}return r.apply(this,arguments)}};var i,a={};function s(t,r){var n={seen:[],stylize:u};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),d(r)?n.showHidden=r:r&&e._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=c),h(n,t,n.depth)}function c(t,e){var r=s.styles[e];return r?"\x1b["+s.colors[r][0]+"m"+t+"\x1b["+s.colors[r][1]+"m":t}function u(t,e){return t}function h(t,r,n){if(t.customInspect&&r&&S(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var o=r.inspect(n,t);return g(o)||(o=h(t,o,n)),o}var i=function(t,e){if(y(e))return t.stylize("undefined","undefined");if(g(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}if(m(e))return t.stylize(""+e,"number");if(d(e))return t.stylize(""+e,"boolean");if(v(e))return t.stylize("null","null")}(t,r);if(i)return i;var a=Object.keys(r),s=function(t){var e={};return t.forEach((function(t,r){e[t]=!0})),e}(a);if(t.showHidden&&(a=Object.getOwnPropertyNames(r)),E(r)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return f(r);if(0===a.length){if(S(r)){var c=r.name?": "+r.name:"";return t.stylize("[Function"+c+"]","special")}if(_(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(O(r))return t.stylize(Date.prototype.toString.call(r),"date");if(E(r))return f(r)}var u,b="",A=!1,I=["{","}"];(p(r)&&(A=!0,I=["[","]"]),S(r))&&(b=" [Function"+(r.name?": "+r.name:"")+"]");return _(r)&&(b=" "+RegExp.prototype.toString.call(r)),O(r)&&(b=" "+Date.prototype.toUTCString.call(r)),E(r)&&(b=" "+f(r)),0!==a.length||A&&0!=r.length?n<0?_(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special"):(t.seen.push(r),u=A?function(t,e,r,n,o){for(var i=[],a=0,s=e.length;a<s;++a)R(e,String(a))?i.push(l(t,e,r,n,String(a),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(l(t,e,r,n,o,!0))})),i}(t,r,n,s,a):a.map((function(e){return l(t,r,n,s,e,A)})),t.seen.pop(),function(t,e,r){if(t.reduce((function(t,e){return e.indexOf("\n")>=0&&0,t+e.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60)return r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1];return r[0]+e+" "+t.join(", ")+" "+r[1]}(u,b,I)):I[0]+b+I[1]}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function l(t,e,r,n,o,i){var a,s,c;if((c=Object.getOwnPropertyDescriptor(e,o)||{value:e[o]}).get?s=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(s=t.stylize("[Setter]","special")),R(n,o)||(a="["+o+"]"),s||(t.seen.indexOf(c.value)<0?(s=v(r)?h(t,c.value,null):h(t,c.value,r-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+s.split("\n").map((function(t){return"   "+t})).join("\n")):s=t.stylize("[Circular]","special")),y(a)){if(i&&o.match(/^\d+$/))return s;(a=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=t.stylize(a,"string"))}return a+": "+s}function p(t){return Array.isArray(t)}function d(t){return"boolean"==typeof t}function v(t){return null===t}function m(t){return"number"==typeof t}function g(t){return"string"==typeof t}function y(t){return void 0===t}function _(t){return b(t)&&"[object RegExp]"===A(t)}function b(t){return"object"==typeof t&&null!==t}function O(t){return b(t)&&"[object Date]"===A(t)}function E(t){return b(t)&&("[object Error]"===A(t)||t instanceof Error)}function S(t){return"function"==typeof t}function A(t){return Object.prototype.toString.call(t)}function I(t){return t<10?"0"+t.toString(10):t.toString(10)}e.debuglog=function(r){if(y(i)&&(i=t.env.NODE_DEBUG||""),r=r.toUpperCase(),!a[r])if(new RegExp("\\b"+r+"\\b","i").test(i)){var n=t.pid;a[r]=function(){var t=e.format.apply(e,arguments);console.error("%s %d: %s",r,n,t)}}else a[r]=function(){};return a[r]},e.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=p,e.isBoolean=d,e.isNull=v,e.isNullOrUndefined=function(t){return null==t},e.isNumber=m,e.isString=g,e.isSymbol=function(t){return"symbol"==typeof t},e.isUndefined=y,e.isRegExp=_,e.isObject=b,e.isDate=O,e.isError=E,e.isFunction=S,e.isPrimitive=function(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=r(637);var C=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function T(){var t=new Date,e=[I(t.getHours()),I(t.getMinutes()),I(t.getSeconds())].join(":");return[t.getDate(),C[t.getMonth()],e].join(" ")}function R(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.log=function(){console.log("%s - %s",T(),e.format.apply(e,arguments))},e.inherits=r(638),e._extend=function(t,e){if(!e||!b(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t};var j="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function w(t,e){if(!t){var r=new Error("Promise was rejected with a falsy value");r.reason=t,t=r}return e(t)}e.promisify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');if(j&&t[j]){var e;if("function"!=typeof(e=t[j]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(e,j,{value:e,enumerable:!1,writable:!1,configurable:!0}),e}function e(){for(var e,r,n=new Promise((function(t,n){e=t,r=n})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(t,n){t?r(t):e(n)}));try{t.apply(this,o)}catch(t){r(t)}return n}return Object.setPrototypeOf(e,Object.getPrototypeOf(t)),j&&Object.defineProperty(e,j,{value:e,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(e,n(t))},e.promisify.custom=j,e.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function r(){for(var r=[],n=0;n<arguments.length;n++)r.push(arguments[n]);var o=r.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,a=function(){return o.apply(i,arguments)};e.apply(this,r).then((function(e){t.nextTick(a,null,e)}),(function(e){t.nextTick(w,e,a)}))}return Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.defineProperties(r,n(e)),r}}).call(this,r(114))},function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e){function r(t){var e=this;if(e instanceof r||(e=new r),e.tail=null,e.head=null,e.length=0,t&&"function"==typeof t.forEach)t.forEach((function(t){e.push(t)}));else if(arguments.length>0)for(var n=0,o=arguments.length;n<o;n++)e.push(arguments[n]);return e}function n(t,e){t.tail=new i(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function o(t,e){t.head=new i(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function i(t,e,r,n){if(!(this instanceof i))return new i(t,e,r,n);this.list=n,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}t.exports=r,r.Node=i,r.create=r,r.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,r=t.prev;e&&(e.prev=r),r&&(r.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=r),t.list.length--,t.next=null,t.prev=null,t.list=null},r.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},r.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},r.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)n(this,arguments[t]);return this.length},r.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)o(this,arguments[t]);return this.length},r.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},r.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},r.prototype.forEach=function(t,e){e=e||this;for(var r=this.head,n=0;null!==r;n++)t.call(e,r.value,n,this),r=r.next},r.prototype.forEachReverse=function(t,e){e=e||this;for(var r=this.tail,n=this.length-1;null!==r;n--)t.call(e,r.value,n,this),r=r.prev},r.prototype.get=function(t){for(var e=0,r=this.head;null!==r&&e<t;e++)r=r.next;if(e===t&&null!==r)return r.value},r.prototype.getReverse=function(t){for(var e=0,r=this.tail;null!==r&&e<t;e++)r=r.prev;if(e===t&&null!==r)return r.value},r.prototype.map=function(t,e){e=e||this;for(var n=new r,o=this.head;null!==o;)n.push(t.call(e,o.value,this)),o=o.next;return n},r.prototype.mapReverse=function(t,e){e=e||this;for(var n=new r,o=this.tail;null!==o;)n.push(t.call(e,o.value,this)),o=o.prev;return n},r.prototype.reduce=function(t,e){var r,n=this.head;if(arguments.length>1)r=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");n=this.head.next,r=this.head.value}for(var o=0;null!==n;o++)r=t(r,n.value,o),n=n.next;return r},r.prototype.reduceReverse=function(t,e){var r,n=this.tail;if(arguments.length>1)r=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");n=this.tail.prev,r=this.tail.value}for(var o=this.length-1;null!==n;o--)r=t(r,n.value,o),n=n.prev;return r},r.prototype.toArray=function(){for(var t=new Array(this.length),e=0,r=this.head;null!==r;e++)t[e]=r.value,r=r.next;return t},r.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,r=this.tail;null!==r;e++)t[e]=r.value,r=r.prev;return t},r.prototype.slice=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var o=0,i=this.head;null!==i&&o<t;o++)i=i.next;for(;null!==i&&o<e;o++,i=i.next)n.push(i.value);return n},r.prototype.sliceReverse=function(t,e){(e=e||this.length)<0&&(e+=this.length),(t=t||0)<0&&(t+=this.length);var n=new r;if(e<t||e<0)return n;t<0&&(t=0),e>this.length&&(e=this.length);for(var o=this.length,i=this.tail;null!==i&&o>e;o--)i=i.prev;for(;null!==i&&o>t;o--,i=i.prev)n.push(i.value);return n},r.prototype.reverse=function(){for(var t=this.head,e=this.tail,r=t;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=e,this.tail=t,this}},function(t,e,r){t.exports=r(641).default},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.isNetworkError=a,e.isRetryableError=u,e.isSafeRequestError=h,e.isIdempotentRequestError=f,e.isNetworkOrIdempotentRequestError=l,e.exponentialDelay=d,e.default=m;var n,o=r(642),i=(n=o)&&n.__esModule?n:{default:n};function a(t){return!t.response&&Boolean(t.code)&&"ECONNABORTED"!==t.code&&(0,i.default)(t)}var s=["get","head","options"],c=s.concat(["put","delete"]);function u(t){return"ECONNABORTED"!==t.code&&(!t.response||t.response.status>=500&&t.response.status<=599)}function h(t){return!!t.config&&(u(t)&&-1!==s.indexOf(t.config.method))}function f(t){return!!t.config&&(u(t)&&-1!==c.indexOf(t.config.method))}function l(t){return a(t)||f(t)}function p(){return 0}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=100*Math.pow(2,t),r=.2*e*Math.random();return e+r}function v(t){var e=t["axios-retry"]||{};return e.retryCount=e.retryCount||0,t["axios-retry"]=e,e}function m(t,e){t.interceptors.request.use((function(t){return v(t).lastRequestTime=Date.now(),t})),t.interceptors.response.use(null,(function(r){var n=r.config;if(!n)return Promise.reject(r);var o=function(t,e){return Object.assign({},e,t["axios-retry"])}(n,e),i=o.retries,a=void 0===i?3:i,s=o.retryCondition,c=void 0===s?l:s,u=o.retryDelay,h=void 0===u?p:u,f=o.shouldResetTimeout,d=void 0!==f&&f,m=v(n);if(c(r)&&m.retryCount<a){m.retryCount+=1;var g=h(m.retryCount,r);if(function(t,e){t.defaults.agent===e.agent&&delete e.agent,t.defaults.httpAgent===e.httpAgent&&delete e.httpAgent,t.defaults.httpsAgent===e.httpsAgent&&delete e.httpsAgent}(t,n),!d&&n.timeout&&m.lastRequestTime){var y=Date.now()-m.lastRequestTime;n.timeout=Math.max(n.timeout-y-g,1)}return n.transformRequest=[function(t){return t}],new Promise((function(e){return setTimeout((function(){return e(t(n))}),g)}))}return Promise.reject(r)}))}m.isNetworkError=a,m.isSafeRequestError=h,m.isIdempotentRequestError=f,m.isNetworkOrIdempotentRequestError=l,m.exponentialDelay=d,m.isRetryableError=u},function(t,e,r){"use strict";var n=["ETIMEDOUT","ECONNRESET","EADDRINUSE","ESOCKETTIMEDOUT","ECONNREFUSED","EPIPE","EHOSTUNREACH","EAI_AGAIN"],o=["ENOTFOUND","ENETUNREACH","UNABLE_TO_GET_ISSUER_CERT","UNABLE_TO_GET_CRL","UNABLE_TO_DECRYPT_CERT_SIGNATURE","UNABLE_TO_DECRYPT_CRL_SIGNATURE","UNABLE_TO_DECODE_ISSUER_PUBLIC_KEY","CERT_SIGNATURE_FAILURE","CRL_SIGNATURE_FAILURE","CERT_NOT_YET_VALID","CERT_HAS_EXPIRED","CRL_NOT_YET_VALID","CRL_HAS_EXPIRED","ERROR_IN_CERT_NOT_BEFORE_FIELD","ERROR_IN_CERT_NOT_AFTER_FIELD","ERROR_IN_CRL_LAST_UPDATE_FIELD","ERROR_IN_CRL_NEXT_UPDATE_FIELD","OUT_OF_MEM","DEPTH_ZERO_SELF_SIGNED_CERT","SELF_SIGNED_CERT_IN_CHAIN","UNABLE_TO_GET_ISSUER_CERT_LOCALLY","UNABLE_TO_VERIFY_LEAF_SIGNATURE","CERT_CHAIN_TOO_LONG","CERT_REVOKED","INVALID_CA","PATH_LENGTH_EXCEEDED","INVALID_PURPOSE","CERT_UNTRUSTED","CERT_REJECTED"];t.exports=function(t){return!t||!t.code||(-1!==n.indexOf(t.code)||-1===o.indexOf(t.code))}},function(t,e,r){var n=r(79),o=r(80),i=r(81);t.exports=function(t){return function(e,r,a){var s=Object(e);if(!o(e)){var c=n(r,3);e=i(e),r=function(t){return c(s[t],t,s)}}var u=t(e,r,a);return u>-1?s[c?e[u]:u]:void 0}}},function(t,e,r){"use strict";var n=r(561),o=r(562),i=Object.prototype.hasOwnProperty,a={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},s=Array.isArray,c=Array.prototype.push,u=function(t,e){c.apply(t,s(e)?e:[e])},h=Date.prototype.toISOString,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,formatter:o.formatters[o.default],indices:!1,serializeDate:function(t){return h.call(t)},skipNulls:!1,strictNullHandling:!1},l=function t(e,r,o,i,a,c,h,l,p,d,v,m,g){var y=e;if("function"==typeof h?y=h(r,y):y instanceof Date?y=d(y):"comma"===o&&s(y)&&(y=y.join(",")),null===y){if(i)return c&&!m?c(r,f.encoder,g):r;y=""}if("string"==typeof y||"number"==typeof y||"boolean"==typeof y||n.isBuffer(y))return c?[v(m?r:c(r,f.encoder,g))+"="+v(c(y,f.encoder,g))]:[v(r)+"="+v(String(y))];var _,b=[];if(void 0===y)return b;if(s(h))_=h;else{var O=Object.keys(y);_=l?O.sort(l):O}for(var E=0;E<_.length;++E){var S=_[E];a&&null===y[S]||(s(y)?u(b,t(y[S],"function"==typeof o?o(r,S):r,o,i,a,c,h,l,p,d,v,m,g)):u(b,t(y[S],r+(p?"."+S:"["+S+"]"),o,i,a,c,h,l,p,d,v,m,g)))}return b};t.exports=function(t,e){var r,n=t,c=function(t){if(!t)return f;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||f.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=o.default;if(void 0!==t.format){if(!i.call(o.formatters,t.format))throw new TypeError("Unknown format option provided.");r=t.format}var n=o.formatters[r],a=f.filter;return("function"==typeof t.filter||s(t.filter))&&(a=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===t.allowDots?f.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:f.charsetSentinel,delimiter:void 0===t.delimiter?f.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:f.encode,encoder:"function"==typeof t.encoder?t.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:f.encodeValuesOnly,filter:a,formatter:n,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:f.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:f.strictNullHandling}}(e);"function"==typeof c.filter?n=(0,c.filter)("",n):s(c.filter)&&(r=c.filter);var h,p=[];if("object"!=typeof n||null===n)return"";h=e&&e.arrayFormat in a?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var d=a[h];r||(r=Object.keys(n)),c.sort&&r.sort(c.sort);for(var v=0;v<r.length;++v){var m=r[v];c.skipNulls&&null===n[m]||u(p,l(n[m],m,d,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var g=p.join(c.delimiter),y=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),g.length>0?y+g:""}},function(t,e,r){"use strict";var n=r(561),o=Object.prototype.hasOwnProperty,i={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},s=function(t,e,r){if(t){var n=r.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,i=/(\[[^[\]]*])/g,a=/(\[[^[\]]*])/.exec(n),s=a?n.slice(0,a.index):n,c=[];if(s){if(!r.plainObjects&&o.call(Object.prototype,s)&&!r.allowPrototypes)return;c.push(s)}for(var u=0;null!==(a=i.exec(n))&&u<r.depth;){if(u+=1,!r.plainObjects&&o.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;c.push(a[1])}return a&&c.push("["+n.slice(a.index)+"]"),function(t,e,r){for(var n=e,o=t.length-1;o>=0;--o){var i,a=t[o];if("[]"===a&&r.parseArrays)i=[].concat(n);else{i=r.plainObjects?Object.create(null):{};var s="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(s,10);r.parseArrays||""!==s?!isNaN(c)&&a!==s&&String(c)===s&&c>=0&&r.parseArrays&&c<=r.arrayLimit?(i=[])[c]=n:i[s]=n:i={0:n}}n=i}return n}(c,e,r)}};t.exports=function(t,e){var r=function(t){if(!t)return i;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?i.charset:t.charset;return{allowDots:void 0===t.allowDots?i.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:i.allowPrototypes,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:i.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:i.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:i.comma,decoder:"function"==typeof t.decoder?t.decoder:i.decoder,delimiter:"string"==typeof t.delimiter||n.isRegExp(t.delimiter)?t.delimiter:i.delimiter,depth:"number"==typeof t.depth?t.depth:i.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:i.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:i.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:i.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:i.strictNullHandling}}(e);if(""===t||null==t)return r.plainObjects?Object.create(null):{};for(var c="string"==typeof t?function(t,e){var r,s={},c=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,u=e.parameterLimit===1/0?void 0:e.parameterLimit,h=c.split(e.delimiter,u),f=-1,l=e.charset;if(e.charsetSentinel)for(r=0;r<h.length;++r)0===h[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[r]?l="utf-8":"utf8=%26%2310003%3B"===h[r]&&(l="iso-8859-1"),f=r,r=h.length);for(r=0;r<h.length;++r)if(r!==f){var p,d,v=h[r],m=v.indexOf("]="),g=-1===m?v.indexOf("="):m+1;-1===g?(p=e.decoder(v,i.decoder,l),d=e.strictNullHandling?null:""):(p=e.decoder(v.slice(0,g),i.decoder,l),d=e.decoder(v.slice(g+1),i.decoder,l)),d&&e.interpretNumericEntities&&"iso-8859-1"===l&&(d=a(d)),d&&e.comma&&d.indexOf(",")>-1&&(d=d.split(",")),o.call(s,p)?s[p]=n.combine(s[p],d):s[p]=d}return s}(t,r):t,u=r.plainObjects?Object.create(null):{},h=Object.keys(c),f=0;f<h.length;++f){var l=h[f],p=s(l,c[l],r);u=n.merge(u,p,r)}return n.compact(u)}},function(t,e,r){var n=r(560),o=r(647),i=r(648);t.exports=function(t,e,r){return e==e?i(t,e,r):n(t,o,r)}},function(t,e){t.exports=function(t){return t!=t}},function(t,e){t.exports=function(t,e,r){for(var n=r-1,o=t.length;++n<o;)if(t[n]===e)return n;return-1}},function(t,e,r){var n=r(258),o=r(627),i=r(208),a=n&&1/i(new n([,-0]))[1]==1/0?function(t){return new n(t)}:o;t.exports=a},function(t,e,r){var n=r(132),o=r(565),i=r(92);t.exports=function(t,e,r){for(var a=-1,s=e.length,c={};++a<s;){var u=e[a],h=n(t,u);r(h,u)&&o(c,i(u,t),h)}return c}},function(t,e,r){var n=r(131);t.exports=function(t,e){return n(e,(function(e){return t[e]}))}},function(t,e,r){"use strict";e.__esModule=!0,e.default=function(){for(var t=1,e=function(t,e){return t===e},r=!1,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];"number"==typeof o[0]&&(t=o.shift());"function"==typeof o[0]?e=o.shift():void 0===o[0]&&o.shift();"boolean"==typeof o[0]&&(r=o[0]);var a=s(t,c(e,r));return function(t){return function(){for(var e=arguments.length,r=Array(e),n=0;n<e;n++)r[n]=arguments[n];var o=a.get(r);return void 0===o&&(o=t.apply(t,r),a.put(r,o)),o}}};var n=a(r(653)),o=a(r(654)),i=a(r(655));function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return 1===t?(0,i.default)(e):(0,o.default)(t,e)}function c(t,e){var r=e?(0,n.default)(t,e):t;return function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n+=1)if(!r(t[n],e[n]))return!1;return!0}}},function(t,e,r){"use strict";e.__esModule=!0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(t,e){return function r(i,a){if(t(i,a))return!0;if(Array.isArray(i))return!(!Array.isArray(a)||i.length!==a.length)&&!!i.every((function(t,e){return r(t,a[e])}));if(Array.isArray(a))return!1;if("object"===(void 0===i?"undefined":n(i))){if("object"!==(void 0===a?"undefined":n(a)))return!1;var s=null===i,c=null===a;if(s||c)return s===c;var u=Object.keys(i),h=Object.keys(a);if(u.length!==h.length)return!1;var f=e?r:t;return!!u.every((function(t){return o(i,t)&&o(a,t)&&f(i[t],a[t])}))}return!1}};var o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t,e){var r=[];function n(t){var n=r.findIndex((function(r){return e(t,r.key)}));if(n>-1){var o=r[n];return n>0&&(r.slice(n,1),r.unshift(o)),o.value}}return{get:n,put:function(e,o){n(e)||(r.unshift({key:e,value:o}),r.length>t&&r.pop())}}}},function(t,e,r){"use strict";e.__esModule=!0,e.default=function(t){var e=void 0;return{get:function(r){if(e&&t(r,e.key))return e.value},put:function(t,r){e={key:t,value:r}}}}},function(t,e,r){var n=r(469);t.exports=function(t,e){var r=[];return n(t,(function(t,n,o){e(t,n,o)&&r.push(t)})),r}},function(t,e,r){var n=r(80);t.exports=function(t,e){return function(r,o){if(null==r)return r;if(!n(r))return t(r,o);for(var i=r.length,a=e?i:-1,s=Object(r);(e?a--:++a<i)&&!1!==o(s[a],a,s););return r}}},function(t,e){t.exports=function(t,e,r,n){var o=-1,i=null==t?0:t.length;for(n&&i&&(r=t[++o]);++o<i;)r=e(r,t[o],o,t);return r}},function(t,e){t.exports=function(t,e,r,n,o){return o(t,(function(t,o,i){r=n?(n=!1,t):e(r,t,o,i)})),r}},function(t,e,r){var n=r(95);t.exports=function(t,e,r){for(var o=-1,i=t.length;++o<i;){var a=t[o],s=e(a);if(null!=s&&(void 0===c?s==s&&!n(s):r(s,c)))var c=s,u=a}return u}},function(t,e){t.exports=function(t,e){return t>e}},function(t,e,r){var n=r(40);t.exports=function(){return n.Date.now()}},function(t,e,r){var n=r(469),o=r(80);t.exports=function(t,e){var r=-1,i=o(t)?Array(t.length):[];return n(t,(function(t,n,o){i[++r]=e(t,n,o)})),i}},function(t,e){t.exports=function(t){return t&&t.length?t[0]:void 0}},function(t,e,r){var n=r(441),o=r(115),i=Array.prototype.splice;t.exports=function(t,e){for(var r=t?e.length:0,a=r-1;r--;){var s=e[r];if(r==a||s!==c){var c=s;o(s)?i.call(t,s,1):n(t,s)}}return t}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw new TypeError("Expected a function");return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}}]]);
//# sourceMappingURL=chat-connectivity.chunk.min.js.map